---
title: The effect of dominance rank on female reproductive success in social mammals
author: 
- 'Shivani^1,2^' 
- 'Elise Huchard^3^'
- 'Dieter Lukas^2^*'
date: '`r Sys.Date()`'
mainfont: Verdana
output:
  pdf_document:
    keep_tex: yes
    latex_engine: xelatex
  md_document: 
    toc: true
  html_document: 
    toc: TRUE
    toc_depth: 4
    toc_float: 
      collapsed: false
    code_folding: hide 
  github_document: 
    toc: true
bibliography: /Users/dieterlukas/ownCloud/Documents/GitHub/FemaleDominanceReproduction_MetaAnalysis/MyLibrary.bib
---
##### Affiliations: 
1. Indian Institute of Science Education and Research Kolkata 
2. Department of Human Behavior, Ecology & Culture; Max Planck Institute for Evolutionary Anthropology Leipzig
3. Institut des Sciences de l’Evolution de Montpellier, Centre National de la Recherche Scientifique, Université de Montpellier  

Correspondence: * dieter_lukas@eva.mpg.de

```{r setup, include=FALSE}
options(width=60)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60), tidy=TRUE)
```


<img width="50%" src="logoPCIecology.png">



<img width="5%" src="logoOpenAccess.png"> <img width="5%" src="logoOpenData.png"> <img width="5%" src="logoOpenCode.png"> <img width="5%" src="logoOpenPeerReview.png">

**The reregistration for this article has been pre-study peer reviewed and received an In Principle Recommendation by:**

Matthieu Paquet (2020) The effect of dominance rank on female reproductive success in social mammals. *Peer Community in Ecology*, 100056. [10.24072/pci.ecology.100056] (https://doi.org/10.24072/pci.ecology.100056)

 - Reviewers: Bonaventura Majolo and one anonymous reviewer

**The preregistration for this article can be found here:** Shivani, Huchard E., Lukas D. 2020. [Preregistration - The effect of dominance rank on female reproductive success in social mammals](https://dieterlukas.github.io/Preregistration_MetaAnalysis_RankSuccess.html) In principle acceptance by *PCI Ecology* of the version 1.2 on 07 July 2020 [https://github.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/blob/trunk/Preregistration_MetaAnalysis_RankSuccess.Rmd](https://github.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/blob/trunk/Preregistration_MetaAnalysis_RankSuccess.Rmd).
   
&nbsp; 

  
### ABSTRACT

Life in social groups, while potentially providing social benefits, inevitably leads to conflict among group members. In many social mammals, such conflicts lead to the formation of dominance hierarchies, where high-ranking individuals consistently outcompete other group members. Given that competition is a fundamental tenet of the theory of natural selection, it is generally assumed that high-ranking individuals have higher reproductive success than lower-ranking individuals. Previous reviews have indicated large variation across populations on the potential effect of dominance rank on reproductive success in female mammals. Here, we propose to perform a meta-analysis based on 444 effect sizes from 187 studies on 86 mammal species to determine whether (1) dominance rank is generally positively associated with reproductive success and whether the approach different studies have taken to answer this question influences the strength of the effect, (2) whether life-history mechanisms might mediate the relationship between rank and reproductive success, (3) whether high-ranking females are more likely to have higher success when resources are limited, and (4) whether the social environment might mitigate rank differences on reproductive success. This preregistration lays out the background, objective, predictions we will test, and proposed methods for our study.

   
  
  
 &nbsp; 
   
### B. BACKGROUND

In order for social groups to persist, group members need to find strategies to deal with the conflicts that inevitably occur (@ward2016sociality). In many female social mammals, conflicts and aggressive interactions are associated with the formation of different types of hierarchies. In singular cooperative breeders, a single dominant breeding female  suppresses reproduction in subordinate group members, who rarely fight amongst each other until an opportunity to become dominant opens (@solomon1997cooperative). In many species where multiple breeding females form stable groups, females can be arranged in stable linear hierarchies, where mothers help their daughters to inherit their rank in their matriline (@holekamp1991dominance). In another set of species, hierarchies are more flexible as a female’s rank depends on her body size, condition, or availability of coalition partners (@pusey2012magnitude). Given that, in species in which dominance hierarchies structure social groups, females can always be attributed either a low or a high rank, it has remained unclear whether and when there is selection on females to compete for a high rank or whether selection is on finding a place in the hierarchy.  

The prevailing assumption is that high ranking females benefit from their dominant status because outcompeting other females is expected to provide them with priority of access to resources (@ellis1995dominance, @pusey2012magnitude). Subordinates are expected to accept their status, because despite having lower reproductive success than dominants, they have few outside options and would presumably face high costs, or have even lower success if they tried to challenge for the dominant status or to reproduce independently (@alexander1974evolution, @vehrencamp1983model). An alternative assumption however is that both dominants and subordinates gain from arranging themselves in a hierarchy to avoid the overt fighting that occurs whenever differentially aggressive individuals repeatedly interact (@west1967foundress). All individuals make a compromise, such that they all balance the potential benefits of their respective positions with the potential costs (@williams1966adaptation). 

Previous reviews have found that while high ranking female mammals frequently appear to have higher reproductive success, there are many populations where such an association has not been found (@pusey2012magnitude, @clutton2013social). Most studies that brought together the evidence have focused on primates and generally only provided qualitative summaries of the evidence (@fedigan1983dominance, @ellis1995dominance, @stockley2011female). One meta-analysis across primates investigated whether life history might mediate the strength of the association between dominance and reproductive success and found that high-ranking females had higher fecundity benefits in species with a longer lifespan (@majolo2012fitness). However, there is no systematic assessment of the many potential factors that have been suggested to mitigate the relationship between rank and reproductive success when high rank might not be associated with higher reproductive success.


&nbsp; 
  
  
### C. OBJECTIVE

In this study, we will perform a quantitative assessment of the strength of the relationship between dominance rank and reproductive success in female social mammals and explore factors that might mediate this relationship. Our objective is to identify the sources and ranges of variation in the relationship between rank and reproductive success and predict that the relationship will be influenced by differences in life-history, ecology, and sociality. We address our objective through the following questions, by testing the corresponding predictions: 

#### **1) Does high rank generally lead to higher reproductive success for females in social mammals?**

We expect that, overall, high dominance rank has a positive effect on reproductive success.

#### **2) What are the life history traits that mediate the benefits of rank on reproductive success?**

We expect that dominants have higher reproductive success predominantly in species in which females have the ability to quickly produce large numbers of offspring.


#### **3) What are the ecological conditions that mediate the benefits of rank on reproductive success?**

We expect that differences in reproductive potential will be particularly marked if resources are limited and monopolizable.


#### **4) What are the social circumstances that mediate the benefits of rank?**

We expect that the association between dominance rank and reproduction is stronger in species living in more stable and structured social groups.

  
  &nbsp; 
  


  
### D. PREDICTIONS

To answer these questions, we assessed the following predictions. All our predictions consider the potential direct influence of a specific variable on the size of the effect of dominance rank on reproductive success. The predictions present the direction of the influence we consider a-priori most likely. We will report all results, but in instances where influences are opposite to what we predict further studies will be necessary to place these results in context. In addition, several of the variables we will include are likely to influence each other. Accordingly, analyses with single variables might not necessarily show the predicted direct influence even if it is present (e.g. there might not be a positive relationship between a social system and the size of the effects if species with this particular social system primarily occur in environments where the size of the effect is expected to be smaller). While deciphering all the potential relationships among the variables we include is beyond the scope of this study, we will also perform analyses accounting for these potential interactions among variables by performing path analyses. We focus on instances where we expect that one variable might remove or change the direction of the influence of another variable, and present these at the end of the predictions.

&nbsp; 
  

#### **1) Does high rank generally lead to higher reproductive success for females in social mammals?**

*P1.1: Publication bias does not influence our sample of effect sizes.*

We do not predict a publication bias but that our sample will include studies showing small effect sizes with small sample sizes. Most studies set out to test if high dominance might lead to both benefits and costs, and previous meta-analyses did not detect signals of publication bias (e.g. @majolo2012fitness).

*P1.2: Overall, high dominance rank will be associated with higher reproductive success.*

We predict that, taking into account the power of the different studies, the combined effect of high rank on reproductive success will be positive. Previous studies that summarized existing evidence (e.g. @majolo2012fitness, @pusey2012magnitude) found support for the consensual framework in socio-ecology which argues that high ranking females generally have higher reproductive success than low ranking females.

*P1.3 Effect sizes from the same population and the same species will be similar.*

We predict that studies that have been conducted on the same species, and in particular at the same site, will report similar effects of dominance rank on reproductive success. For some long-term studies, multiple studies have been performed using slightly different methods and/or data from different years which might include the same set of individuals leading to very similar effect size estimates. For studies of the same species from different sites, we expect similarities because many aspects of the life-history and social system that will shape the relationship between rank and reproductive success will be conserved.

*P1.4: Closely related species will show similar effects of dominance rank on reproductive success.*

We predict that effect sizes of the relationship between dominance rank and reproductive success will be more similar among closely related species (@chamberlain2012does) because methodological approaches can be specific to specific Orders (e.g. ungulates are studied differently than primates) and because closely related species share life history, social and ecological traits that might shape the influence of rank on reproductive success.

*P1.5: Effect sizes depend on the approach used.*

We expect that some of the variation in effect size across studies arises from methodological differences: 

(i) we predict lower effect sizes for studies of captive populations compared to wild populations: while the absence of stochastic events in captivity might mean that dominance is more consistently associated with certain benefits, the effects of high dominance rank on reproductive success will be reduced because of lower competition over resources; 
(ii) we predict lower effect sizes for studies where rank was measured based on agonistic interactions rather than on size or age because size and age are frequently directly associated with differences in female reproduction and clear differences between dominants and subordinates may indicate the existence of castes that tend to be associated with strong reproductive monopolization (@lukas2018social); and 
(iii) we predict different effect sizes for studies classifying individuals into two or three rank categories compared to linear ranking depending on the social system. In cases where there is usually a single dominant female (singular cooperative breeders, such as meerkats), using a linear regression between each individuals' rank and its reproductive success will likely estimate a lower effect size because such an approach assumes differences in rank or reproductive success among the subordinates when there are none. In contrast, grouping individuals into categories to compare dominants to subordinates will capture actual differences more accurately. In cases where several females breed (plural breeders, such as hyenas) and are ordered in a linear hierarchy, a linear regression will exploit the full information available on individual differences in rank and reproductive success, whereas grouping individuals will lead to a loss of resolution, at a risk of underestimating the differences between highest and lowest ranking individuals. We performed simulations to determine the extent to which this choice of approach skews the effect sizes and found that it can lead to differences of more than 35% between the true and the estimated effect sizes. For illustration, we include this simulation in our code.  

&nbsp; 
    

#### **2) What are the life history traits that mediate the benefits of rank on reproductive success?**

*P2.1: High dominance rank will benefit females more than their offspring.*

We predict that high rank is more likely to be associated with higher reproductive success in studies that measured female age at first reproduction, number of offspring born per year or across a lifetime, or female survival rather than the survival of their offspring. While in cooperatively breeding species reproductive suppression might impact offspring survival, in plural breeders offspring survival is more likely to be influenced by factors that are outside of the control of females, such as infanticide by new males (@cheney2004factors). 

*P2.2: Dominance will have stronger effects on immediate reproductive success in species in which females produce many offspring over a short time period.*

One key mechanism that has been proposed is that females with high dominance rank have priority of access to resources during periods when these resources are limited, which in turn can increase their reproductive success. Accordingly, we predict stronger effects of rank on measures of immediate reproductive success (offspring production, offspring survival) in species in which females have higher energetic investment into reproduction, with larger litter sizes and shorter interbirth intervals (@lukas2019evolution). In contrast, in long-lived species in which females produce only single offspring at long intervals, high-ranking females are expected to have less opportunity to translate short-term resource access into immediate reproductive success but might store energy to potentially increase their own survival or lifetime reproductive success. 

&nbsp; 
  

#### **3) What are the ecological conditions that mediate the benefits of rank on reproductive success?**

*P3.1: Positive effects of high dominance rank on reproductive success will be stronger in populations in which females feed on resources that are more monopolizable.*

We predict that high rank will have stronger effects on reproductive success in fruit- and meat-eaters compared to herbivores or omnivores. One of the main expected benefits of high rank is priority of access to resources, which should be more relevant in populations in which resources can be monopolized (@fedigan1983dominance).

*P3.2: Effects of dominance rank on reproductive success will be more pronounced in populations living in harsh environments.*

We predict that the effect of rank on reproductive success will be stronger in populations in which resources are limited because they live in harsh and unpredictable environments. Previous studies have shown that cooperatively breeding species are more likely to occur in such environments (@lukas2017climate), but we also expect stronger effects among plural breeding populations living in harsh environments. 

*P3.3: Effects of dominance rank on reproductive success will be more pronounced in populations with high densities of individuals.*

We predict that the effect of rank on reproductive success will be stronger in populations in which more individuals share a limited amount of space. At higher population densities, social groupings and interactions are more likely and competition over resources is expected to be stronger.

&nbsp; 
  

#### **4) What are the social circumstances that mediate the benefits of rank?**

*P4.1: Benefits of rank will be most pronounced in cooperatively breeding species.*

We predict that rank effects on reproduction will be higher in cooperative breeders, where the dominant female is often the only breeding female because she suppresses the reproduction of subordinate females (@digby2006role), compared to plural breeders, where aggressive behaviour is more targeted and limited to access over specific resources. 

*P4.2: For plural-breeders, the time-scales at which the reproductive benefits of dominance accrue depend on how individuals achieve high rank.*

We predict that in populations of plural breeders in which groups contain multiple breeding females, the way in which these females compete over dominance will influence the potential benefits of high rank. In populations in which female rank depends primarily on age, high ranking females will have higher reproductive success for short periods of time because changes in rank are expected to occur regularly, and because high rank may only be reached towards the end of their reproductive life (@thouless1986conflict). In societies in which female rank depends primarily on size or condition, rank effects on reproductive success are expected to be expressed on intermediate time frames, as individuals may not be able to maintain a larger relative size or condition over lifetime but they are expected to acquire rank relatively early in their reproductive life   (@giles2015dominance, @huchard2016competitive). In societies in which female rank primarily depends on nepotism, and ranks are often inherited and stable across a female’s lifetime, we predict that effects of rank on reproductive success will be strongest when measured over long periods because small benefits might add up to substantial differences among females (@frank1986social) whereas stochastic events might reduce differences between females on shorter time scales (@cheney2004factors). 

*P4.3: Dominance rank will have stronger effects on reproductive success in populations in which females are philopatric in comparison to populations where females disperse to breed.*

We predict that effects of rank on reproductive success will be lower in populations in which adult females are able to leave their group and join other groups compared to populations in which females cannot breed outside their natal group. In populations in which females are philopatric, they are likely to have support from female kin which can strengthen dominance differences (@lukas2018social). In addition, in species where females can change group membership easily, females are expected to join those groups where they have the best breeding option available to them (@vehrencamp1983model). 

*P4.4: In plural breeding species, dominance will have stronger effects on reproductive success when the number of females in the group is smaller.*

We predict that the effect of rank on reproductive success will be stronger in plural breeding populations in which there are fewer females per group, because dominant females will be more likely to interfere in reproductive attempts when there are fewer subordinates (@clutton2010adaptive and because increased competition in larger groups is expected to reduce reproductive success even among dominants (@van1988scramble). 

*P4.5 Dominance rank will be more strongly associated with reproductive success in populations in which average relatedness among female group members is high.*

We predict that the relationship between dominance rank and reproductive success will be more pronounced in species in which social groups primarily consist of close kin compared to groups composed of unrelated females. Groups with high levels of average kinship among females are those where groups are small, females remain philopatric (@lukas2005extent), and females have support to establish their positions (@lukas2018social), which all are expected to lead to higher benefits of high rank.

*P4.6 Dominance rank will be more strongly associated with reproductive success in populations in which variance in relatedness among female group members is high.*

In addition to levels of average relatedness among group females, we also predict that the relationship between dominance rank and reproductive success will be more pronounced in species in which there is high variance in relatedness, with females being closely related to some group members but not to others, as compared to species in which group females are either all related or all unrelated. In several species with female philopatry, groups are structured into matrilines (@fortunato2019lineal). Members of the same matriline tend to support each other in interactions with unrelated females, likely reinforcing differences among females. 

*P4.7 The effect of dominance on reproductive success will be less pronounced in populations in which females regularly form coalitions.*

We predict that high ranking females will have less pronounced reproductive benefits in species in which females form strategic coalitions with others (@bercovitch1991social). Individuals have been suggested to form strategic coalitions to level the reproduction of others (@pandit2003model) and these coalitions are less likely in cooperatively breeding species (@lukas2018social). 

*P4.8 Dominance rank will have less effect on reproductive success in populations in which there is intense inter-sexual conflict.*

We predict that the association between high dominance rank and increased reproductive success of females will be lower in populations in which males compete intensively over reproductive opportunites because this leads to intersexual conflict that harms females. In such populations, males tend to be aggressive towards females and males taking up tenure in a group tend to kill offspring indiscriminately or might even target offspring of high-ranking females (@fedigan2013sexual), reducing any potential differences between high- and low-ranking females. We will assess whether high ranking females benefit less from their positions in populations in which groups show strong female-biased sex composition, or in which males regularly commit infanticide, or with strong sexual size dimorphism with males being much larger than females.

  
  &nbsp; 


#### **Potential interactions among predictor variables**

*Studies performed on wild versus captive individuals and using different measures of reproductive success might not only differ in the overall strength of the effect of rank on reproductive success, but also in how other variables influence this effect.*

*Higher population density [predicted to lead to larger effect sizes] might be associated with larger group sizes [smaller effect sizes predicted], leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Smaller group sizes [larger effect sizes predicted) might be associated with more intense intersexual conflict [smaller effect sizes predicted], leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Monopolizable resources [larger effect sizes predicted] might be associated with reduced population density [smaller effect sizes predicted]), leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Environmental harshness [larger effect sizes predicted] might be associated with reduced population density [smaller effect sizes predicted]), leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Female philopatry [larger effect sizes predicted] might be associated with increased group sizes [smaller effect sizes predicted]), leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*



  
  &nbsp; 
    
    
### E. METHODS

#### **Preregistration**

We preregistered our hypotheses, methods, and analysis plans: https://dieterlukas.github.io/Preregistration_MetaAnalysis_RankSuccess.html

The literature search was completed before the first submission of the preregistration. All variables that were coded directly from the source publications (Z transformed effect size, variance, sample size, species identity, aspect of reproductive success, classification of rank, duration of study, population type, and social group size) were also entered prior to the first submission. In July 2019, S worked with a preliminary subset of the data (143 effect sizes), and investigated publication bias, the overall mean and variance in effect sizes, and whether effect sizes differed according to which reproductive output was measured. We added the data on the explanatory variables and started analyses in July 2020 after the preregistration passed pre-study peer review at *Peer Community In Ecology*: Paquet (2020) Peer Community in Ecology, 100056. [10.24072/pci.ecology.100056] (https://doi.org/10.24072/pci.ecology.100056)


#### **Literature search**

The literature search was performed by S & DL. We started with the references in the previous major reviews and meta-analyses on the association between dominance and reproduction in female mammals (see below for inclusion criteria): @fedigan1983dominance (8 studies on female primates entered), @ellis1995dominance (16 studies entered / 5 studies not entered on female non-primates, 38 studies entered / 22 studies not entered on female primates), @brown2002reconsidering (28 studies entered / 7 studies not entered on female primates), @stockley2011female (12 studies entered / 2 studies not entered on female non-primates, 11 studies entered / 1 study not entered on female primates), @majolo2012fitness (26 studies entered / 2 studies not entered on female primates), @pusey2012magnitude (45 studies entered / 2 studies not entered on female primates), and @clutton2013social (8 studies entered / 1 study not entered on female primates, 6 studies entered / 1 study not entered on female non-primates). Next, we performed database searches in Google Scholar and Pubmed, first by identifying articles citing these major reviews and next by searching with the terms “dominance, reproductive success/reproduction, female, mammal”, and “rank, reproductive success/reproduction, female, mammal”, “sex ratio, dominance, female, mammal” (searches performed July 2019-January 2020). We limited our checks to the first 1000 results for all searches. 

We checked the titles and abstracts to identify studies that observed dominance interactions and reproductive success in social groups of interacting female non-human mammals. We selected studies that measured the association between dominance rank and at least one aspect of female reproductive success and reported the data or a test-statistic. For both dominance and reproductive success, we only included studies that had direct measures, not secondary indicators. For dominance, we excluded studies where authors did not explicitly determine dominance relationships and only assumed that traits such as size, presence in core areas, or reproductive success itself indicate dominance. We did however include studies where authors established dominance hierarchies, found that they are associated with some other trait such as size or condition, and subsequently used the other trait to measure dominance. For reproductive success, we excluded studies that measured traits such as mating frequency or access to food resources which were assumed but not known to influence reproductive success (excluding studies that: measured the size of individuals to argue about dominance; assumed that females in core areas are dominant; assigned dominance to females based on how successful they are; recorded mating success not reproductive success; linked dominance to behaviour assumed to potentially link to reproductive success). We included all kinds of academic publications, from primary articles published in peer-reviewed journals through reviews, books and book chapters, and unpublished PhD theses.


#### **Variables, their definitions, and their sources**

**Variables coded directly from the relevant publications:**
All data from the literature search on publications reporting the effect of dominance rank on reproductive success has been entered prior to the first submission of the preregistration. S and DL performed the data extraction. We initially coded eight papers independently, for which we both extracted the same values and classified the approaches in the same way. We extracted the relevant information to calculate the effect size and its associated variance. In addition, we coded a set of variables to characterize the methodological approach. The dataset contains 444 effect sizes from 187 studies on 86 mammalian species. A copy of the [datafile is available here](https://github.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis)

**Z-transformed effect size**: we converted all effect sizes to Z-transformed correlation coefficients (Zr). In cases where articles reported a pairwise correlation coefficient, we directly use this value. In cases where authors had used alternative statistical approaches (e.g. t-test comparison between two groups of individuals), the test statistics were converted to the statistic ‘r’ using formulas provided by @lakens2013calculating, @lajeunesse2013recovering, and @wilson2019calculator. In cases where authors reported individual-level data reflecting dominance rank and reproductive success (for example in the form of a table that listed for groups of dominants and subordinates their mean and deviation of reproductive success or for every individual their rank and reproductive success), we calculated correlation coefficients directly from a 2-by-2 frequency table (when comparing classes of high- to low-ranking individuals) or from linear regressions (when individuals had continuous ranks). In cases where studies simply stated that “all dominants bred but none of the subordinates” we assumed an error of 0.5% for both dominants not breeding and subordinates breeding to obtain the sampling variance estimates. We extracted separate effect sizes for each reported analysis: for example, if authors reported separately associations between dominance rank and mortality of offspring to 1 year and to independence, we obtained two effect sizes from this population reflecting infant survival. We Z-transformed all correlation coefficients to control for the asymptotic distribution of these values. We changed the sign of the effect sizes to make them consistent across studies. This was necessary because dominance rank was coded differently across studies, for example sometimes studies assigned dominant individuals the lowest value by starting a count from 1, whereas in other cases they were assigned the highest value to reflect the proportion of other females they are dominant over. We set the sign of effect sizes such that positive values mean that higher ranking individuals have shorter interbirth intervals, higher survival as adults and of their infants, higher infant production (e.g. larger litter sizes, higher probability of breeding), and higher lifetime reproductive success (e.g. higher total number of offspring weaned).

**Sample size**: we recorded the sample size for the relevant statistical comparison (number of females, number of offspring, number of matrilines etc.).

**Sampling variance**: we calculated the sampling variance of the effect sizes based on the correlation coefficient r and the sample size, using the formulas provided by @wilson2019calculator. The standard error, which is alternatively used in some approaches, is the square root of the sampling variance (@viechtbauer2010conducting).

**Species identity**: we recorded the common name and the latin species name as listed by the authors. We referred to the Mammal Diversity Database (@burgin2018many) to resolve instances where species attributions had been changed since the publication of the original study.  

**Study site**: we recorded the name of the study site as listed by the authors in the method section. The focus of this variable is to determine whether multiple observations are from the same species from the same study population, and we accordingly assigned different names for the study site label in case two or more different species had been studied at the same site. 
 
**Measure of reproductive success**: we recorded which aspect of reproduction dominance rank was associated with. We classified reproductive traits into six classes: 
- age at first reproduction (includes age at first birth, age at first conception, age at first menstrual cycle); 
- infant survival (includes rates of mortality of offspring prior to their independence; proportion of pregnancies carried to birth);
- survival (includes rates of mortality of females per year, age at death); 
- infant production (includes litter size, offspring weight, litter mass, number of offspring per year, probability of birth in a given year, number of surviving infants per year); 
- interbirth interval (includes time between life births, number of cycles to conception, number of litters per year); 
- lifetime reproductive success (includes total number of offspring born or surviving to independence for females who had been observed from first reproduction to death).

**Classification of rank**: we recorded the approach the authors had used to assign dominance positions to individuals, distinguishing between those based on aggressive/submissive interactions between pairs of individuals and those based on other traits such as age, size, or which female was the first to reproduce.

**Scoring of rank**: we recorded whether in the analyses individuals were assigned a specific, continuous rank position or whether individuals were classified into rank categories (dominant versus subordinates, high- versus middle- versus low-ranking).

**Duration of study**: we recorded the number of years that authors had observed the individuals (anything less than one year was assigned a value of 1).

**Population type**: we recorded whether the population was free-living, provisioned, or captive based on the authors descriptions.

**Social group size**: we recorded the average number of adult females per group in the study population, based on the information provided in the manuscripts. We relied on the definition of a social group as used by the respective authors, which might include associations of females in: singular-breeder cooperative groups (as in wolves or meerkats); stable groups of multiple breeding females (as in baboons or hyenas); or breeding associations defined by physical proximity (as in bighorn sheep or antelopes). We will have a separate coding of the social system (see below). Where available, we also coded the average number of adult males associated with each group of females to determine the sex ratio in social groups as a proxy for intersexual conflict.


**Variables extracted from the broader literature for each species/population:**
This data will be added prior to the analyses, depending on which  specific prediction(s) we will test. For most of these, we will extract information from the relevant papers or publications reporting on the same population. For some of these, we will use previously published species’ averages, because records from each population for each specific period during which the effect of dominance rank on reproductive success were measured are unlikely to be available for a large enough sample. We list the likely sources we will use to obtain these data.

**Litter size**: the number of offspring per birth; data available for each population, we will use the average as reported by the authors.

**Interbirth interval**: the time in months between consecutive births; data available for a limited set of populations, we will use the average as reported by the authors. Depending on the availability of population specific data, we will alternatively use averages as reported for each species (based on the data in @jones2009pantheria).

**Cooperative breeding group**: whether social groups usually contain a single breeding female and additional non-breeding adult females that help to raise the offspring of the breeding female. Group membership is usually closed and changes occur through birth and death or fissioning of existing groups. This classification is in contrast to plural breeding groups and breeding associations (see below); data available for each population, we will use the description of the social system in the population as reported by the authors.

**Plural breeding group**: whether social groups usually contain multiple breeding females that remain together for extended periods of time. It includes both groups in which females are philopatric or disperse. Females form differentiated relationships with other group members. This classification is in contrast to cooperative breeding groups and breeding associations (see above/below); data available for each population, we will use the description of the social system in the population as reported by the authors.

**Breeding association**: whether social groups consist of multiple breeding females that associate either in space or by mutual attraction. Group membership is fluid and associations among individuals can rapidly change. This classification is in contrast to cooperative breeding groups and plural breeding groups (see above); data available for each population, we will use the description of the social system in the population as reported by the authors.

**Dominance system**: whether dominance rank of females appears to depend primarily on (i) their age, (ii) their physical attributes such as body size, (iii) support from their mother, or (iv) coalitionary support from same-aged group members. Data available from a subset of populations, to which we will add from primary reports of species-level classifications from other populations assuming that this trait is usually stable across populations within species.

**Philopatry**: whether females have the majority of their offspring in the same social groups or in the same location in which they have been born or whether females disperse to other groups or locations to reproduce; data from species-level descriptions of female behaviour (based on the data in @barsbai2021local).

**Monopolizable resources**: whether the gross dietary category of a species is based on monopolizable resources (carnivory, frugivory), or non-monopolizable resources (herbivory, or omnivory) (based on the data in @wilman2014eltontraits). 

**Environmental harshness**: whether the average climatic conditions experienced by the species are characterized by cold temperatures, low rainfall, and unpredictability (based on the data in @botero2014environmental).

**Population density**: the average number of individuals per square kilometer for the species (based on the data in @jones2009pantheria).

**Average and variance in relatedness among group females**: the average and variance in relatedness measured using genetic approaches among adult females within the same group as reported for this species; data available from a subset of the populations.

**Coalition formation**: whether adult females form coalitions with other female group members to support each other during within-group aggressive interactions; data from species-level descriptions of female behaviour (based on the data in @lukas2018social).


#### **Phylogeny**
We will generate a single consensus phylogeny for the mammalian species in our sample from the most recent complete mammalian time-calibrated phylogeny (@upham2019inferring). We will download a credible set of 1000 trees of mammalian phylogenetic history from vertlife.org/phylosubsets/ and use TreeAnnotator (version 1.8.2 in BEAST: @drummond2012bayesian) to generate a maximum clade credibility (MCC) tree (median node heights and a burn in of 250 trees). We will trim the tree to match the species in our sample and convert branch lengths using functions of the package ape (@paradis2019ape).

    
#### **Analyses**

We performed all analyses in the statistical software R (R Software Consortium 2019). We will build separate models for each prediction. To assess the robustness of the findings and whether modeling decisions might have an influence on our results, we will use a frequentist and a Bayesian approach to build the statistical models. We first estimate all models using functions in the package metafor (@viechtbauer2010conducting). We fit meta-analytic multilevel mixed-effects models with moderators via linear models, including models that account for the potential correlations among effect sizes due to shared phylogenetic history among species (@nakagawa2012methodological). Second, we estimate a subset of models using Bayesian approaches in the package rethinking (@mcelreath2020statistical). We fit multilevel models that include the sampling variance as measurement error (@kurz2019rethinking) and shared phylogenetic history as a covariance matrix. Weakly regularizing priors are used for all parameters. The models are implemented in Stan. We draw 8000 samples from four chains, checking that for each the R-hat values will be less than 1.01. Visual inspection of trace plots and rank histograms are performed to ensure that they indicated no evidence of divergent transitions or biased posterior exploration. Posteriors from the model are used to generate estimates of the overall effect size and the influence of potential moderators. We detail model construction in the following: we first assess whether species and population identity create dependencies amongst the measured effect sizes. If so, we include these factors through covariance matrices reflecting the dependence across measurements. We provide code showing the setup of the various models, together with a simulated dataset with the same structure as the actual data to [assess the code here](https://github.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis)

&nbsp; 


&nbsp; 
  
### F. CHANGES FROM THE PREREGISTRATION

We collected data on the additional explanatory variables:
- litter size, litters per year, and population density for the respective species from @jones2009pantheria
- cooperative vs plural vs associate breeding from the descriptions in the respective population from the articles from which we obtained the effect sizes 
- dominance system from additional references on the species (listed in the data file)
- philopatry of the respective species from @barsbai2021local
- diet category of the respective species from @wilman2014eltontraits
- environmental harshness across the range of the respective species from @botero2014environmental
- coalition formation in the respective species from @lukas2018social
- average relatedness from the articles from which we obtained the effect sizes or additional references matching the exact population (listed in data file)
- we did not collect data on variance in relatedness because it was not possible to extract this information from most studies reporting relatedness levels 
- some missing data was detected after starting the analysis script and are added as part of the code below

Outlier check:
Before running the analyses, we made a funnel plot of the standard error over the effect size, where we noticed three outlier data points. We realized that for these three entries (EffectRefs 425, 427, and 428) we had used the wrong formula to calculate the effect size and variance. All of these are studies of multiple groups of Callithrix jacchus, each with a small number of females. For these three studies, we had erroneously used the 2-by-2 frequency tables to calculate the standardized mean difference, not the correlation coefficient. We corrected the values for these three entries before performing any of the analyses.

Sampling bias:
The funnel plot of the complete dataset showed a strong asymmetry, indicating that our sample is biased towards including many studies with low precision and high positive effect sizes. We added further analyses, both based on functions in the packages 'metafor' (following @nakagawa2021methods) and 'rethinking' (following @mcelreath2020statistical), to determine the potential causes of the bias in our sample and the influence on what effects should be expected. 




&nbsp; 
  
### G. RESULTS

We extracted 444 effect sizes of the relationship between dominance rank and reproductive success of female mammals from 187 studies on 86 species during our literature search. More than half of the effect sizes are from primate species (253 effect sizes), with macaques (109) and baboons (76) a particular focus for this research. About two thirds (283) of the reports are from wild populations; rank was predominantly determined on the basis of aggressive interactions (407) rather than on other measures such as age or size; and it was about equally frequent that researchers classified rank categorically as dominant versus subordinant (251) than continuously from highest to lowest (193). Most of the reported effects link dominance rank to infant production (198) followed by infant survival (113), with fewer effects reported on interbirth intervals (46), lifetime reproductive success (34), survival (30), or age at first reproduction (23).

```{r ranksuccess_loaddata, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}
options(width=60)

# Meta analysis of effect of rank on reproductive success in female social mammals

# Load necessary libraries. Some of these libraries have specific installation requirements (orchaRd and rethinking), please check their respective websites.

library(metafor)
library(ape)
library(geiger)
library(dplyr)
library(readr)
library(orchaRd)
library(patchwork)
library(ggplot2)
library(rethinking)


# Loading the data
# all data are obtained from online sources

# Load input data from GitHub
inputdata<-read_csv(url("https://raw.githubusercontent.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/trunk/InputData_MetaAnalysis_FemaleDominanceReproduction.csv"))
inputdata<-data.frame(inputdata)
dat<-inputdata
 

# The following variables are part of the dataset
# [1] "EffectRef"                   "StudyRef"                    "Latin"                      
# [4] "SpeciesRef"                  "MeasureType_Category"        "SampleSize"                 
# [7] "R_value"                     "Fishers_Z_r"                 "Variance"                   
#[10] "No_of_years"                 "Populationtype"              "GroupSize"                  
#[13] "StudyPopulation"             "Rank_Cont_Cat"               "RankDetermined"             
#[16] "LitterSize"                  "LittersPerYear"              "CooperativeBreeding"        
#[19] "PluralBreeding"              "AssociatedBreeding"          "DominanceSystem"            
#[22] "Philopatry"                  "DietCategory"                "EnvironmentalHarshness"     
#[25] "PopulationDensity"           "AverageRelatedness"          "CoalitionFormation"         
#[28] "Reference_DominanceSucccess" "Reference_DominanceSystem"   "Reference_Relatedness" 

# Load the consensus tree for the 86 species in the actual dataset
mammaltree<-read.nexus(url("https://raw.githubusercontent.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/trunk/CombinedTree_MetaAnalysis_RankSuccess.nex"))

# Some of the Latin species names in the input file do not match the species name that were used for the phylogenetic tree. We can adapt these here
#Instead of Canis familiaris we use Canis lupus
dat[dat$Latin=="Canis_familiaris",]$Latin<-"Canis_lupus"
#Fukomys mechowii is spelled Fukomys mechowi
dat[dat$Latin=="Fukomys_mechowii",]$Latin<-"Fukomys_mechowi"
#Bos bison is now Bison bison
dat[dat$Latin=="Bos_bison",]$Latin<-"Bison_bison"

# For linking the phylogeny to the data, we create covariance matrices reflecting the shared phylogenetic history of pairs of species in a distance matrix
phylo_branch <- compute.brlen(mammaltree, method = "Grafen", power = 1)
phylo_cor <- vcv(phylo_branch, cor = T)
Dmat<-cophenetic(mammaltree)


# Setting up the data for the phylogenetic models in rethinking
spp_obs<-unique(dat$Latin)
spp_obs<-matrix(nrow=length(spp_obs))
rownames(spp_obs)<-unique(dat$Latin)
dat$SpeciesIncluded<-dat$Latin




# The dataset was cleaned during the preparation, which led to the exclusion of an entry for one of the species. For some analyses, the species identities need to be numbered consecutively, so we are changing the identities of species 88 to the missing identity 34 (to have identities 1-87)
dat[dat$SpeciesRef==88,]$SpeciesRef<-34


# Filling in a missing value for litters per year for Macaca assamensis (based on doi.org/10.1007/s10764-010-9409-3)
dat[dat$Latin=="Macaca_assamensis",]$LittersPerYear<-0.6



# There are 11 species for which we did not classify the breeding system
dat[dat$Latin=="Apodemus_sylvaticus",]$CooperativeBreeding<-1
dat[dat$Latin=="Canis_rufus",]$CooperativeBreeding<-1
dat[dat$Latin=="Ceratotherium_simum",]$AssociatedBreeding<-1
dat[dat$Latin=="Marmota_marmota",]$CooperativeBreeding<-1
dat[dat$Latin=="Mesocricetus_auratus",]$PluralBreeding<-1
dat[dat$Latin=="Microtus_ochrogaster",]$CooperativeBreeding<-1
dat[dat$Latin=="Microtus_pinetorum",]$CooperativeBreeding<-1
dat[dat$Latin=="Odocoileus_virginianus",]$PluralBreeding<-1
dat[dat$Latin=="Oryctolagus_cuniculus",]$PluralBreeding<-1
dat[dat$Latin=="Ozotoceros_bezoarticus",]$AssociatedBreeding<-1
dat[dat$Latin=="Vulpes_vulpes",]$CooperativeBreeding<-1

# Create a new variable that has a categorical classification of the breeding system 
# 1=cooperative breeder, 2=plural breeder, 3=associated breeder
dat$BreedingSystem <-dat$CooperativeBreeding*1+dat$PluralBreeding*2+dat$AssociatedBreeding*3



# How many effect sizes are there for macaques and baboons?
table(dat$Latin)[grep("Macaca",names(table(dat$Latin)))]
table(dat$Latin)[grep("Papio",names(table(dat$Latin)))]
table(dat$Latin)[grep("Theropithecus",names(table(dat$Latin)))]

# How many effect sizes are there for each of the different methodological approaches?
table(dat$Populationtype)
table(dat$RankDetermined)
table(dat$Rank_Cont_Cat)
table(dat$MeasureType_Category)

```




#### **1) Does high rank generally lead to higher reproductive success for females in social mammals?**

**Overall effect**: 
We constructed a intercept-only meta-analytic base model to test for a general effect of dominance rank on reproductive success. Across our sample, there is a strong effect that females with higher dominance rank have higher reproductive success (metafor estimate 0.22-0.27, rethinking estimate 0.26-0.30; the metafor estimate here and in the additional models is lower than the rethinking estimate because the statistical approach of the former expects the data to be more symmetrical than they are). This overall effect means, for example, that in groups with two individuals dominants would have between 0-6 offspring while subordinates have between 0-4 offspring. There is large variation though in our sample, with effect sizes ranging from -0.89 to +1.33 (Figure 1).

```{r ranksuccess_overalleffect, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}
options(width=60)

#base model in metafor: determine the overall effect size, accounting for the measurement error as reflected by the sampling variance
meta_simple <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat)
meta_simple



#base model in rethinking: determine the overall effect size
#We create the structured data file for the model 
dat_list_simple <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance
)

#We run the model assuming that the sampling variance (Z_sd) reflects an error in the measurements of the true effect sizes (Z_true) giving the effect sizes in the sample (Z_obs). The inferred values for mu reflect the overall estimates for the effect size and the values for sigma the associated variance in the sample.
rethinking_simple <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu ~ normal(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list_simple)
precis(rethinking_simple)

```




**Publication bias**: 
A visual inspection of the range of effect sizes at different sample sizes in a funnel plot (Supplemental Figure) showed that there might be an underrepresentation of studies with small or negative effect sizes and small sample sizes (@egger1997bias). This sample bias is clearer to see in an orchard plot, which shows that extreme effect sizes tend to be of low precision and that there is an overrepresentation of positive effect sizes (Figure 1). 

```{r ranksuccess_publicationbias, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}
options(width=60)

# We build the funnel plot based on the estimation of the overall effect size from the base model in metafor
meta_simple <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat)
funnel(meta_simple, level=c(90, 95, 99), shade=c("white", "gray", "darkgray"), 
       yaxis="seinv",xlab="effect size (Zr)",ylab="precision (1/SE)",digits=c(1,0),xlim=c(-2,2),ylim=c(1,30))

#We buid the orchard plot based on the same base model
orchard_plot(meta_simple, mod="Int", xlab = "Fisher's Z r", 
  transfm = "none") 
```



There are potentially (at least) three sources of sample bias, the first being 'publication bias' with studies with low effect sizes not ending up in the published literature, the second being 'study system bias' with research focusing on populations with small groups where it is easy to detect effects (e.g. cooperative breeders), and the third being 'study time bias' with studies performed over shorter time frames generally being more imprecise. We added further post-hoc analyses to investigate these patterns individually here, and in a combined model after identifying which study systems might show different effect sizes.

Simple tests for "publication bias' (@preston2004adjusting) suggest that effect sizes with a p-value smaller than 0.05 are about four times more likely to be reported than effect sizes with a p-value larger than 0.50. However, given the diversity of studies in our sample, we did not expect that the effect sizes represent a sample from a single distribution: for example, studies of offspring mortality tend to have larger sample sizes (because each mother can have multiple offspring) and we predicted different effect sizes for these studies. The base analysis indicates high heterogeneity in our sample (total heterogeneity / total variability: 73.37%) and suggesting that our sample might also show 'study system bias'.

```{r ranksuccess_effectsizeselection, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}
options(width=60)

# The estimation of whether non-significant effect sizes are missing from our sample is based on the full dataset.
meta_basic <- rma(yi=Fishers_Z_r, vi=Variance, data=dat)

# We use two different selection processes to reflect whether studies with specific p-values are more or less likely to be represented in our sample - a halfnormal curve and a stepwise function
plot(selmodel(meta_basic,type="halfnorm"))
plot(selmodel(meta_basic,type="stepfun",steps=c(0.005,0.01,0.025,0.05,0.1,0.9,0.95,1)))


```

Finally, including the number of years a study had been conducted for as a predictor of the effect sizes also indicates that our sample shows "study system bias". Effect sizes are lower when studies have been conducted for longer (metafor estimate -0.01 - 0.00, rethinking estimate -0.05 - 0.00), but in particular the variance is reduced once a study has been running for 10 ore more years (Supplemental figure). 


```{r ranksuccess_numberofyears, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}
options(width=60)

#Determine whether the duration of the study population influences effect sizes, assuming that measurements from the same population and the same species are not independent and that each measurement might have a unique approach (confound with same study means that model does not converge when including 1|StudyRef as additional random variable).
meta_numberofyears <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ No_of_years, random=list(~Populationtype|SpeciesRef))
meta_numberofyears


# Setting up the data for the stan model
dat_list_noyears <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  NoYears = standardize(dat$No_of_years)
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_noyears <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+y*NoYears + p[Pop] + b[Species] + c[Study],
        a~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_noyears , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_noyears,depth=2)[445:447,]

```






**Influence of locality/species**: 
To the base model, we added random effects to account for non-independence due to effect sizes originating from within the same study, from studies performed on the same population and on the same species. The estimate of the overall effect size did not change in this model (metafor estimate 0.22-0.31, rethinking estimate 0.26-0.35). Effect sizes from the same species and the same study, but not the same population, tend to be similar to each other.

```{r ranksuccess_samesource, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#Determine the overall effect size in a model that assumes that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_randomfactors <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, method="REML", random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_randomfactors

#Check potential dependence from each of the random factors separately
#model with species as random term
meta_species <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, slab=StudyRef, random=~1|SpeciesRef)
meta_species 

#model with study as random term
meta_study <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, slab=EffectRef, random=~ 1|StudyRef)
meta_study 

#model with population as random term
meta_population <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, slab=EffectRef, random=~ 1|StudyPopulation)
meta_population 


# Setting up the data for the stan model
dat_list_moderators <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_moderators_hyperprior <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + p[Pop] + b[Species] + c[Study],
        a~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_moderators , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_moderators_hyperprior)

```



**Influence of approach**:
To the base model, we add random effects reflecting the differences in approaches across studies (dominance ranks classified continuous/categorical; dominance determined through agonism/correlate; population type wild/provisioned/captive; number of years of the study).

Studies which measured dominance rank categorically by classifying individuals as either dominants or subordinates report higher effect sizes (metafor estimate 0.29-0.35, rethinking estimate 0.31-0.41) than studies assigning individuals continuous ranks (metafor estimate 0.16-0.22, rethinking estimate 0.17-0.28). In essentially all studies of cooperative breeders (31 of 32 effect sizes), comparisons were between the single dominant female and a class of the remaining subordinate females.

Studies which determined the rank of females based on agonistic interactions have lower effect sizes (metafor estimate 0.22-0.26, rethinking estimate 0.24-0.32) than studies which used other correlates (body size, age, etc.) to assign dominance ranks (metafor estimate 0.43-0.55, rethinking estimate 0.41-0.63). The 37 effect sizes where rank was assigned based on correlates are from cooperative breeders and/or studies in which groups consisted of mothers and their daughters.

Effect sizes did not vary between studies conducted with captive (metafor estimate 0.24-0.30, rethinking estimate 0.27-0.37), provisioned (metafor estimate 0.21-0.33, rethinking estimate 0.14-0.41), or wild (metafor estimate 0.22-0.0.34) individuals, and this does not change when we nest the population type within species (indicating that effect sizes do not differ between captive, provisioned, and wild populations of the same species).



```{r ranksuccess_approach, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#Determine whether how rank was classified (continuous or categorical) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_rankmeasurement <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ Rank_Cont_Cat, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_rankmeasurement

#Determine whether how rank was determined (agonism or another correlate) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_rankdetermined <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ RankDetermined, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_rankdetermined

#Determine whether the type of study population (wild, provisioned, captive) influences effect sizes, assuming that measurements from the same population and the same species are not independent and that each measurement might have a unique approach (confound with same study means that model does not converge when including 1|StudyRef as additional random variable).
meta_populationtype <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ Populationtype, random=list(~1|StudyPopulation,~1|SpeciesRef))
meta_populationtype



#Determine whether the type of study population (wild, provisioned, captive) influences effect sizes, assuming that measurements from the same population and the same species are not independent and that each measurement might have a unique approach (confound with same study means that model does not converge when including 1|StudyRef as additional random variable).
meta_populationtype <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ Populationtype, random=list(~Populationtype|SpeciesRef))
meta_populationtype








# Setting up the data for the stan model
dat_list_rankmeasured <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Rankmeasured = as.integer(as.factor(dat$Rank_Cont_Cat))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_rankmeasured <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Rankmeasured] + p[Pop] + b[Species] + c[Study],
        a[Rankmeasured]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_rankmeasured , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_rankmeasured,depth=2)[445:447,]



# Setting up the data for the stan model
dat_list_rankdetermined <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Rankdetermined = as.integer(as.factor(dat$RankDetermined))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_rankdetermined <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Rankdetermined] + p[Pop] + b[Species] + c[Study],
        a[Rankdetermined]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_rankdetermined , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_rankdetermined,depth=2)[445:447,]



# Setting up the data for the stan model
dat_list_populationtype <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Populationtype = as.integer(as.factor(dat$Populationtype))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_populationtype <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Populationtype] + p[Pop] + b[Species] + c[Study],
        a[Populationtype]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_populationtype , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_populationtype,depth=2)[445:447,]


rethinking_populationtype_nested <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- g[Populationtype] + alpha[Species,Populationtype],
        transpars> matrix[Species,3]:alpha <-
            compose_noncentered( sigma_species , L_Rho_species , z_species ),
        matrix[3,Species]:z_species~normal(0,1),
        g[Populationtype]~normal(0,1),
        vector[3]:sigma_species~dexp(1),
        cholesky_factor_corr[3]:L_Rho_species ~ lkj_corr_cholesky( 2 ),
        gq> matrix[3,3]:Rho_species <<- Chol_to_Corr(L_Rho_species),
        sigma_sq~dexp(1)
    ) , data=dat_list_populationtype , chains=4 , cores=4 , log_lik=TRUE ,iter=18000)
precis(rethinking_populationtype_nested,depth=2)[445:451,]




# Setting up the data for the stan model
dat_list_noyears <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  NoYears = standardize(dat$No_of_years)
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_noyears <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+y*NoYears + p[Pop] + b[Species] + c[Study],
        a~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_noyears , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_noyears,depth=2)[445:447,]



```









**Influence of phylogeny**: 
To the random effects model, we added a covariance structure to reflect potential similarities in effect sizes arising from closely related species showing similar effects due to their shared phylogenetic history. Both statistical approaches indicate that closely related species tend to have effect sizes that are more similar than those of distantly related species. The metafor approach suggests that about 20% of the variation in effect sizes is associated with covariation among species. The rethinking approach shows high uncertainty in the estimates (Figure), reflecting the high heterogeneity in the underlying data with high variation within species and different measures taken among closely related species, but suggests that high similarity is primarily among species of the same genus and some similarity for species in the same Order (e.g. maximum standardized distance among primate species in our sample is 0.42, where estimates of similarity drop to zero).


```{r ranksuccess_phylogeny, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#Determine whether how rank was classified (continuous or categorical) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.

metafor_phylogenetic <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~1,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic




#Next, we convert the phylogeny into a covariance matrix that reflects the shared phylogenetic history among all pairs of species in the sample
#There are two approaches: first assuming a Brownian Motion model of evolution, and next a model that includes the parameter Pagel's lambda to account for potential changes in the rate of evolution

dat_list_phylogenetic <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  G = runif(n=nrow(dat),0,1)
)

Rbm<-corBrownian( phy = mammaltree )
Rlambda<-corPagel(0.75,phy=mammaltree,fixed=FALSE)
VCV_bm <- vcv(Rbm)
VCV_pagel<-vcv(Rlambda)
dat_list_phylogenetic$V <- VCV_bm[ dat$Latin,dat$Latin ]
dat_list_phylogenetic$R <-dat_list_phylogenetic$V / max(VCV_bm)
dat_list_phylogenetic$R<-dat_list_phylogenetic$R*0.99
diag(dat_list_phylogenetic$R)<-1
dat_list_phylogenetic$V_pagel <- VCV_pagel[ dat$Latin,dat$Latin ]
dat_list_phylogenetic$R_pagel <-dat_list_phylogenetic$V_pagel / max(VCV_pagel)
dat_list_phylogenetic$R_pagel <-dat_list_phylogenetic$R_pagel*0.99
diag(dat_list_phylogenetic$R_pagel)<-1

rethinking_phylogenetic_brownian <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- R * sigma_sq,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~exponential(1)
  ),data=dat_list_phylogenetic,cmdstan=T)
precis(rethinking_phylogenetic_brownian)


rethinking_phylogenetic_pagel <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- R_pagel * sigma_sq,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~exponential(1)
  ),data=dat_list_phylogenetic,cmdstan=T)
precis(rethinking_phylogenetic_pagel)


Dmat<-cophenetic(mammaltree)
dat_list_phylogenetic$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bG~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian)


#To check the phylogenetic signal, we plot the estimate covariance(similarity) in effect sizes as species are more distantly related
#A phylogenetic signal in the plot would be shown by high covariances among species that have small phylogenetic distances and declining covariances as phylogenetic distance increases
#For the simulated dataset, most of the estimates show a covariance of 0, and no change as phylogenetic distance increases
post<-extract.samples(rethinking_phylogenetic_gaussian)
plot(NULL,xlim=c(0,max(dat_list$Dmat)),ylim=c(0,1.5),xlab="phylogenetic distance",ylab="covariance")
for (i in 1:50) curve(post$etasq[i]*exp(-post$rhosq[i]*x^2),add=TRUE,col=grau())



```








#### **2) What are the life history traits that mediate the benefits of rank on reproductive success?**


**Influence of measure of reproductive success**:
To the base model, we add a predictor variable reflecting the six classes of measures of reproductive success.

Dominance rank appears to have the highest effect on age of first conception (metafor estimate 0.32-0.43, rethinking estimate 0.33-0.52), life time reproductive success (metafor estimate 0.27-0.40, rethinking estimate 0.31-0.47), interbirth interval (metafor estimate 0.25-0.37, rethinking estimate 0.28-0.37), infant production (metafor estimate 0.21-0.33, rethinking estimate 0.23-0.38), adult survival (metafor estimate 0.18-0.31, rethinking estimate 0.18-0.34), infant survival (metafor estimate 0.14-0.25, rethinking estimate 0.15-0.26). Effects of dominance rank on survival are lower than on other measures of female fitness. In addition, females themselves appear to benefit more than their offspring (adult survival > infant survival). While effect sizes for life time reproductive success are higher than those for the values from which it is usually calculated (adult survival, interbirth interval, infant production), there does not appear to be a straightforward additive (or multiplicative) combination of the individual effects. 

```{r ranksuccess_measure, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#Determine whether how rank was classified (continuous or categorical) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_measuretype <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ MeasureType_Category, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_measuretype



# Setting up the data for the stan model
dat_list_measuretype <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Measuretype = as.integer(as.factor(dat$MeasureType_Category))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_rankmeasured <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Measuretype] + b[Species] + c[Study],
        a[Measuretype]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_measuretype , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_rankmeasured,depth=2)[445:451,]

plot(precis( rethinking_rankmeasured , depth=2 , pars="a" ))


```






**Litter Size and Litters Per Year**
Effects of dominance on reproductive success are higher in species with larger litter sizes (metafor estimate of litter size 0.03 - 0.05, rethinking estimate 0.05 - 0.09) and with more litters per year (metafor estimate of litters per year 0.04 - 0.08, rethinking estimate 0.06 - 0.11). Effect sizes in species where females produce single offspring are on average 0.25 while effect sizes in species where females produce litters are on average 0.34, and effect sizes in species where females produce one or fewer litters per year are on average 0.25 while effect sizes in species where females produce multiple litters each year are on average 0.45. The association of the effect sizes with the number of litters per year remained when accounting for the phylogenetic relatedness among species, but the association with litter size is not, suggesting that it might be influenced by other characteristics among which species with different litter sizes vary.



```{r ranksuccess_litters, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_littersize <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ LitterSize, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_littersize

metafor_phylogenetic_littersize <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~LitterSize,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_littersize



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_groupsize <- list(
  N_spp = nrow(dat),
  Fishers_Z_r = dat$Fishers_Z_r,
  Variance = dat$Variance, 
  LitterSize_s = standardize(dat$LitterSize)
)

dat$LitterSize_s<-standardize(dat$LitterSize)

#We run the model
rethinking_groupsize <- ulam(
  alist(
    Fishers_Z_r ~dnorm ( Z_true , Variance),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+bG*LitterSize_s,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_groupsize)
precis(rethinking_groupsize)


#calculate and plot values at the minimum group size, 2,10,50,100 females, and the maximum group size
groupsize.seq <-  c(-1,-0.84895,-0.415,1.753,4.4635,8)
pred_dat <- list( LitterSize_s = groupsize.seq)
mu <- link( rethinking_groupsize , data=pred_dat )
mu.mean <- apply( mu , 2 , mean )
mu.PI <- apply( mu , 2 , PI , prob=0.89 )
plot( Fishers_Z_r ~ G , dat , col=col.alpha(rangi2,0.5) ,xaxt="n")
at <- c(-0.84895,-0.415,1.753,4.4635)
labels <- at*sd(dat$LitterSize) + mean(dat$LitterSize)
axis( side=1 , at=at , labels=round(labels,1) )
lines( groupsize.seq , mu.mean )
shade( mu.PI , groupsize.seq )


dat_list_phylogenetic_littersize <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  L = standardize(standardize(log(dat$LitterSize)))
)

dat_list_phylogenetic_littersize$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_littersize <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bL*L,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bL~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_littersize)
precis(rethinking_phylogenetic_gaussian_littersize)




#model assessing the influence of different litters per year on the measured effect sizes, with study reference as random term


meta_littersperyear <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ LittersPerYear, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_littersperyear

metafor_phylogenetic_littersperyear <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~LittersPerYear,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_littersperyear



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_littersperyear <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  L = standardize(dat$LittersPerYear)
)

#We run the model
rethinking_littersperyear <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+bL*L,
    a~normal(0,1),
    bL~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_littersperyear)
precis(rethinking_littersperyear)




dat_list_phylogenetic_littersperyear <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  L = standardize(standardize(log(dat$LittersPerYear)))
)

dat_list_phylogenetic_littersperyear$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_littersperyear <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bL*L,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bL~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_littersperyear)
precis(rethinking_phylogenetic_gaussian_littersperyear)


```









#### **3) What are the ecological conditions that mediate the benefits of rank on reproductive success?**

**Diet Category**

Effect sizes are larger in carnivores (0.36) than in omnivores (0.29),  herbivores (0.27), or frugivores (0.22) (estimated differences c-o metafor -0.36 - -0.17 rethinking -0.24 - -0.04, c-h metafor -0.29 - -0.13 rethinking -0.16 - -0.03, c-f metafor -0.27 - -0.11 rethinking -0.14 - -0.02; estimates for all other comparisons cross 0). Carnivores are no longer estimated to have different effect sizes when the phylogenetic relatedness among species is taken into account.



```{r ranksuccess_diet, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_diet <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ DietCategory, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_diet

metafor_phylogenetic_diet <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~DietCategory,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_diet



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

dietdat<-dat[is.na(dat$DietCategory)==F,]

dat_list_diet <- list(
  N_spp = nrow(dietdat),
  Z_obs = dietdat$Fishers_Z_r,
  Z_sd = dietdat$Variance, 
  D = as.integer(as.factor(dietdat$DietCategory))
)

#We run the model
rethinking_diet <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_diet)
precis(rethinking_diet,depth=2)[444:450,]
posterior<-extract.samples(rethinking_diet)
difference_diet<-posterior$b[,2]-posterior$b[,1]
precis(difference_diet)


dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


```





**Environmental Harshness**

Our data shows no association between environmental harshness and the effect of dominance rank on reproductive success (metafor estimate -0.3 - +0.4, rethinking -0.6 - +0.1).

```{r ranksuccess_harshness, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_harshness <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ EnvironmentalHarshness, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_harshness

metafor_phylogenetic_harshness <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~EnvironmentalHarshness,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_harshness



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

harshnessdat<-dat[is.na(dat$EnvironmentalHarshness)==F,]

dat_list_harshness <- list(
  N_spp = nrow(harshnessdat),
  Z_obs = harshnessdat$Fishers_Z_r,
  Z_sd = harshnessdat$Variance, 
  H = standardize(harshnessdat$EnvironmentalHarshness)
)

#We run the model
rethinking_harshness <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*H,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_harshness)
precis(rethinking_harshness,depth=2)[260:262,]



dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


```




**Population Density**

Effect sizes are larger in species with higher population densities (metafor 0.04 - 0.08, rethinking 0.05 - 0.10), even when including phylogenetic relatedness.


```{r ranksuccess_density, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

densitydat<-dat[is.na(dat$PopulationDensity)==F,]
densitydat$PopulationDensity<-standardize(densitydat$PopulationDensity)


meta_density <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ PopulationDensity, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_density

metafor_phylogenetic_density <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~PopulationDensity,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_density



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

densitydat<-dat[is.na(dat$PopulationDensity)==F,]

dat_list_density <- list(
  N_spp = nrow(densitydat),
  Z_obs = densitydat$Fishers_Z_r,
  Z_sd = densitydat$Variance, 
  P = standardize(densitydat$PopulationDensity)
)

#We run the model
rethinking_density <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*P,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_density)
precis(rethinking_density,depth=2)[346:348,]



dat_list_phylogenetic_density <- list(
  N_spp = nrow(densitydat),
  Z_obs = densitydat$Fishers_Z_r,
  Z_sd = densitydat$Variance, 
  P = standardize(densitydat$PopulationDensity)
)

dat_list_phylogenetic_density$Dmat<-Dmat[ densitydat$Latin,densitydat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_density <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b*P,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_density)
precis(rethinking_phylogenetic_gaussian_density)


```






#### **4) What are the social circumstances that mediate the benefits of rank?**

**Group size**
Both approaches detect a negative association between the effect sizes and group sizes (metafor estimate of log group size -0.099 - -0.678, rethinking estimate of standardized group size -0.10 - -0.05). Compared to groups of 2 females, groups of 10 females show ~10% lower effect sizes and groups of ~50 females show 50% lower effect sizes. The negative association between group size and the effect sizes remains when accounting for similarity among closely related species.


```{r ranksuccess_groupsize, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_groupsize <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ GroupSize, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_groupsize

metafor_phylogenetic_groupsize <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~GroupSize,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_groupsize



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_groupsize <- list(
  N_spp = nrow(dat),
  Fishers_Z_r = dat$Fishers_Z_r,
  Variance = dat$Variance, 
  GroupSize_s = standardize(dat$GroupSize)
)

dat$GroupSize_s<-standardize(dat$GroupSize)

#We run the model
rethinking_groupsize <- ulam(
  alist(
    Fishers_Z_r ~dnorm ( Z_true , Variance),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+bG*GroupSize_s,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_groupsize)
precis(rethinking_groupsize)


#calculate and plot values at the minimum group size, 2,10,50,100 females, and the maximum group size
groupsize.seq <-  c(-1,-0.84895,-0.415,1.753,4.4635,8)
pred_dat <- list( GroupSize_s = groupsize.seq)
mu <- link( rethinking_groupsize , data=pred_dat )
mu.mean <- apply( mu , 2 , mean )
mu.PI <- apply( mu , 2 , PI , prob=0.89 )
plot( Fishers_Z_r ~ G , dat , col=col.alpha(rangi2,0.5) ,xaxt="n")
at <- c(-0.84895,-0.415,1.753,4.4635)
labels <- at*sd(dat$GroupSize) + mean(dat$GroupSize)
axis( side=1 , at=at , labels=round(labels,1) )
lines( groupsize.seq , mu.mean )
shade( mu.PI , groupsize.seq )







dat_list_phylogenetic_groupsize <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  G = standardize(standardize(log(dat$GroupSize)))
)

dat_list_phylogenetic_groupsize$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_groupsize <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bG~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_groupsize)
precis(rethinking_phylogenetic_gaussian_groupsize)

#To check the phylogenetic signal, we plot the estimate covariance(similarity) in effect sizes as species are more distantly related
#A phylogenetic signal in the plot would be shown by high covariances among species that have small phylogenetic distances and declining covariances as phylogenetic distance increases
#For the simulated dataset, most of the estimates show a covariance of 0, and no change as phylogenetic distance increases
post<-extract.samples(rethinking_phylogenetic_gaussian)
plot(NULL,xlim=c(0,max(dat_list$Dmat)),ylim=c(0,1.5),xlab="phylogenetic distance",ylab="covariance")
for (i in 1:50) curve(post$etasq[i]*exp(-post$rhosq[i]*x^2),add=TRUE,col=grau())


```






**Breeding system**

Effect sizes of cooperative breeders (average 0.58) are higher than those observed in plural (average 0.25) or associated breeders (average 0.23) (estimates for difference cooperative breeder vs plural breeder metafor -0.40 - -0.30, rethinking -0.41 - 0.27; cooperative breeder vs associated breeder metafor -0.47 - -0.35, rethinking -0.45 - -0.26; plural breeder vs associated breeder metafor -0.07 - +0.05, rethinking -0.07 - +0.05). Cooperative breeders are still estimated to have higher effect sizes than species with other breeding systems when accounting for phylogenetic relatedness, but the differences are slightly reduced.


```{r ranksuccess_breedingsystem, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_breedingsystem <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ as.factor(BreedingSystem), data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_breedingsystem

metafor_phylogenetic_breedingsystem <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~BreedingSystem,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_breedingsystem



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_breedingsystem <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  B = dat$BreedingSystem
)

#We run the model
rethinking_breedingsystem <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[B],
    a~normal(0,1),
    b[B]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_breedingsystem)
precis(rethinking_breedingsystem,depth=2)[445:448,]
posterior<-extract.samples(rethinking_breedingsystem)
difference_breedingsystem<-posterior$b[,2]-posterior$b[,1]
precis(difference_breedingsystem)


dat_list_phylogenetic_breedingsystem <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  B = dat$BreedingSystem
)

dat_list_phylogenetic_breedingsystem$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_breedingsystem <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[B],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[B]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_breedingsystem)
precis(rethinking_phylogenetic_gaussian_breedingsystem,depth=2)[445:448,]
posterior<-extract.samples(rethinking_phylogenetic_gaussian_breedingsystem)
difference_breedingsystem<-posterior$b[,2]-posterior$b[,1]
precis(difference_breedingsystem)


```






**Dominance System**

Effect sizes are higher in species in which condition plays a major role in determining which females are dominant rather than subordinant (average effect size 0.38), compared to species in which age (average effect size 0.31) or nepotism (average effect size 0.24) influence dominance rank (estimates for difference condition vs age: metafor 0.05 - 0.17, rethinking 0.01 - 0.16; condition vs nepotism: metafor 0.07 - 0.20, rethinking 0.08 - 0.20; age vs nepotism: metafor -0.07 - +0.03, rethinking -0.01 - +0.12). Species with different dominance system are no longer estimated to be different when including the phylogenetic similarity.


```{r ranksuccess_dominancesystem, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_associatedbreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ DominanceSystem, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_associatedbreeding

metafor_phylogenetic_associatedbreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~DominanceSystem,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_associatedbreeding



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

dominancedat<-dat[is.na(dat$DominanceSystem)==F,]

dat_list_dominance <- list(
  N_spp = nrow(dominancedat),
  Z_obs = dominancedat$Fishers_Z_r,
  Z_sd = dominancedat$Variance, 
  D = as.integer(as.factor(dominancedat$DominanceSystem))
)

#We run the model
rethinking_dominance <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_dominance)
precis(rethinking_dominance,depth=2)[438:442,]
posterior<-extract.samples(rethinking_dominance)
difference_dominance<-posterior$b[,2]-posterior$b[,1]
precis(difference_dominance)


dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


```







**Philopatry**

The effects of dominance rank on reproductive success are higher in species in which females disperse and join new groups (average effect size 0.46) compared to species in which most females were born in the same group they breed (average effect size 0.26) (metafor estimate of difference -0.24 - -0.12, rethinking estimate -0.25 - -0.11), also when accounting for phylogenetic covariance.


```{r ranksuccess_philopatry, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_philopatry <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ Philopatry, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_philopatry

metafor_phylogenetic_philopatry <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~Philopatry,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_philopatry



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

philopatrydat<-dat[is.na(dat$Philopatry)==F,]

dat_list_philopatry <- list(
  N_spp = nrow(philopatrydat),
  Z_obs = philopatrydat$Fishers_Z_r,
  Z_sd = philopatrydat$Variance, 
  D = as.integer(as.factor(philopatrydat$Philopatry))
)

#We run the model
rethinking_philopatry <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_philopatry)
precis(rethinking_philopatry,depth=2)[416:419,]
posterior<-extract.samples(rethinking_philopatry)
difference_philopatry<-posterior$b[,2]-posterior$b[,1]
precis(difference_philopatry)


dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


```



**Average Relatedness**

Effect sizes of dominance rank on reproductive success increase with increasing levels of average relatedness among female group members (metafor estimate 0.31 - 0.59, rethinking estimate 0.31 - 0.71), though the association is no longer detected when including the shared phylogenetic history among species.


```{r ranksuccess_relatedness, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_relatedness <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ AverageRelatedness, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_relatedness

metafor_phylogenetic_relatedness <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~AverageRelatedness,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_relatedness



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

relatednessdat<-dat[is.na(dat$AverageRelatedness)==F,]

dat_list_relatedness <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness)
)

#We run the model
rethinking_relatedness <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*R,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_relatedness)
precis(rethinking_relatedness)


dat_list_phylogenetic_relatedness <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness)
)

dat_list_phylogenetic_relatedness$Dmat<-Dmat[relatednessdat$Latin,relatednessdat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_relatedness <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b*R,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_relatedness)
precis(rethinking_phylogenetic_gaussian_relatedness)


```



**Coalition formation**

Species in which females form coalitions show only slightly lower effects of dominance rank on reproductive success (average 0.27) than species in which females do not have support during aggressive interactions (average 0.32) (estimate of difference metafor: -0.11 - -0.01, rethinking -0.09 - +0.01, no difference in models accounting for similarity due to phylogenetic relatedness)


```{r ranksuccess_coalition, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_coalition <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CoalitionFormation, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_coalition

metafor_phylogenetic_coalition <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CoalitionFormation,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_coalition



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

coalitiondat<-dat[is.na(dat$CoalitionFormation)==F,]

dat_list_coalition <- list(
  N_spp = nrow(coalitiondat),
  Z_obs = coalitiondat$Fishers_Z_r,
  Z_sd = coalitiondat$Variance, 
  C = as.integer(as.factor(coalitiondat$CoalitionFormation))
)

#We run the model
rethinking_coalition <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[C],
    a~normal(0,1),
    b[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_coalition)
precis(rethinking_coalition,depth=2)[427:430,]
posterior<-extract.samples(rethinking_coalition)
difference_coalition<-posterior$b[,2]-posterior$b[,1]
precis(difference_coalition)

dat_list_phylogenetic_coalition <- list(
  N_spp = nrow(coalitiondat),
  Z_obs = coalitiondat$Fishers_Z_r,
  Z_sd = coalitiondat$Variance, 
  C = as.integer(as.factor(coalitiondat$CoalitionFormation))
)

dat_list_phylogenetic_coalition$Dmat<-Dmat[coalitiondat$Latin,coalitiondat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_coalition <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[C],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_coalition)
precis(rethinking_phylogenetic_gaussian_coalition)


```






#### **Summary of univariate analyses**

Overall, our data indicate that females of higher rank generally have higher reproductive success than females of lower rank. In terms of the approach, effect sizes of dominance rank on reproductive success were higher
- when individuals were assigned a rank category rather than a continuous position
- when rank was determined using indirect measures rather than aggressive interactions
- in some studies, species, and families of species than in others.
We find no differences in effect sizes
- when studies were conducted in a captive rather than a wild setting.

-Effect sizes of dominance rank were higher for higher for measures of reproductive output than for measures of survival, and higher for measures of maternal than for offspring fitness.

Across our predictor variables, we find higher effect sizes of dominance rank on reproductive success in populations with
- more litters per year
- higher population densities
- smaller group sizes
- cooperative breeding
- and female dispersal.

We find no differences in effect sizes (after accounting for shared phylogenetic history) across populations differing in
- litter size
- which trait determines which females become dominant
- diet
- environmental harshness
- average relatedness among female group members
- and female coalition formation.




#### **Combined analyses**




after including factors associated with heterogeneity, still signal of publication bias? Yes.

research has focused on systems and approaches where effects are more likely to detect.

```{r ranksuccess_metapublicationbias, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

dat$sei <- sqrt(dat$Variance)


publication.bias.model.sei <- rma.mv(Fishers_Z_r, Variance,
                            mod=~MeasureType_Category+LittersPerYear+CooperativeBreeding+CooperativeBreeding*GroupSize+No_of_years+sei,
                                      random=list(~ 1 | SpeciesIncluded, # phylo effect
                                                  ~ 1 | Latin, # non-phylo effect
                                                  ~ 1 | StudyRef), 
                                      R = list(SpeciesIncluded = phylo_cor), #phylogenetic relatedness
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model.sei



publication.bias.model <- rma.mv(Fishers_Z_r, Variance,
                            mod=~MeasureType_Category+LittersPerYear+CooperativeBreeding+CooperativeBreeding*GroupSize+No_of_years,
                                      random=list(~ 1 | SpeciesIncluded, # phylo effect
                                                  ~ 1 | Latin, # non-phylo effect
                                                  ~ 1 | StudyRef), 
                                      R = list(SpeciesIncluded = phylo_cor), #phylogenetic relatedness
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model


funnel(publication.bias.model, level=c(90, 95, 99), shade=c("white", "gray", "darkgray"), 
       yaxis="seinv",xlab="effect size (Zr)",ylab="precision (1/SE)",digits=c(1,0),xlim=c(-2,2),ylim=c(1,10))

```






In our preregistration, we had decided to first construct univariate models as reported above, testing the influence of a single variable at a time to assess support for the specific predictions. One of the main factors that we found to be associated with higher effect sizes is if species are cooperative breeders. Cooperative breeders differ in many additional aspects, so we first check whether any of the other associations we detect occur because they covary with cooperative breeding.


**Differences in approach to study cooperative breeders**
Approaches of assigning rank depend on the breeding system of the study species, with many studies of cooperative breeders assigning rank into categories (98% categorical, 2% continuous) based on other measures (50% agonism, 50% other) while studies of plural and associated breeders often assign continuous ranks (51% categorical, 49% continuous) based on agonistic interactions (97% agonism, 3% other). Combining the variables for the approaches with the classification as cooperative breeder or not into single models indicates that the difference in effect sizes is primarily due to the stronger dominance effects in cooperative breeders (estimate of difference metafor 0.23 -  0.34, rethinking 0.23 - 0.37) and only very little due to the approaches the authors chose (other measure vs agonisms estimate of difference metafor 0.02 - 0.15, rethinking -0.02 - 0.16; rank categorical vs continuous estimate of difference metafor -0.02 - -0.09, rethinking -0.07 - 0.03). 


```{r ranksuccess_rankdetermined_cooperativebreeding, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

# Percentage of plural/associated breeders in which rank is classified categorical rather than continuous
(dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] / ( (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] + (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [2,2] )
# Percentage of cooperative breeders in which rank is classified categorical rather than continuous
(dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(CooperativeBreeding)) ) [1,2] / ( (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(CooperativeBreeding)) ) [1,2] + (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(CooperativeBreeding)) ) [2,2] )

# Percentage of plural/associated breeders in which rank is classified through agonism rather than another measure
(dat %>% group_by(RankDetermined) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] / ( (dat %>% group_by(RankDetermined) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] + (dat %>% group_by(RankDetermined) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [2,2] )
# Percentage of cooperative breeders in which rank is classified through agonism rather than another measure
(dat %>% group_by(RankDetermined) %>% summarize(sum(CooperativeBreeding)) ) [1,2] / ( (dat %>% group_by(RankDetermined) %>% summarize(sum(CooperativeBreeding)) ) [1,2] + (dat %>% group_by(RankDetermined) %>% summarize(sum(CooperativeBreeding)) ) [2,2] )


# Assessing whether how rank is determined (agonism vs other) remains associated with different
# effect sizes after accounting that rank is determined differently in cooperative breeders

meta_rankdetermined_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding+RankDetermined, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_rankdetermined_cooperativebreeding

metafor_phylogenetic_rankdetermined_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+RankDetermined,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_rankdetermined_cooperativebreeding






#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  C = dat$CooperativeBreeding+1,
  M = as.integer(as.factor(dat$RankDetermined))
)


rethinking_rankdetermined_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + c[C]+m[M],
    m[M] ~ dnorm(0,1),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_rankdetermined_cooperativebreeding,depth=2)[445:450,]
posterior<-extract.samples(rethinking_rankdetermined_cooperativebreeding)
difference_rankdetermined_cooperativebreeding<-posterior$m[,2]-posterior$m[,1]
precis(difference_rankdetermined_cooperativebreeding)



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+m[M],
    m[M] ~ dnorm(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding)







# Assessing whether how rank is assigned (categorical vs continuous) remains associated with different
# effect sizes after accounting that rank is assigned categorically in cooperative breeders


meta_rankcategory_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding+Rank_Cont_Cat, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_rankcategory_cooperativebreeding

metafor_phylogenetic_rankcategory_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+Rank_Cont_Cat,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_rankcategory_cooperativebreeding






#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  C = dat$CooperativeBreeding+1,
  R = as.integer(as.factor(dat$Rank_Cont_Cat))
)


rethinking_rankcategory_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + c[C]+r[R],
    r[R] ~ dnorm(0,1),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_rankcategory_cooperativebreeding,depth=2)[445:450,]
posterior<-extract.samples(rethinking_rankcategory_cooperativebreeding)
difference_rankcategory_cooperativebreeding<-posterior$r[,2]-posterior$r[,1]
precis(difference_rankcategory_cooperativebreeding)



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+m[M],
    m[M] ~ dnorm(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding)




```




**Different life history measures and cooperative breeding**

In cooperative breeders, effects of dominance rank were only assessed on three of the of the six life history traits. We therefore performed separate analyses for cooperative and for plural/associated breeders to assess where high ranking females particularly show increased reproduction.

In cooperative breeders, effect sizes are higher for infant production (0.55-0.69), and lower for infant survival (0.20-0.61) and adult survival (0.12-0.73).

In plural/associated breeders, effect sizes are highest for life time reproductive success (0.33-0.47), followed by age at first conception (0.25-0.43) and interbirth interval (0.25-0.38), infant production (0.19-0.27) and adult survival (0.15-0.30), and are lowest for infant survival (0.11-0.20)


```{r ranksuccess_measure_interactions, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  G = standardize(standardize(log(dat$GroupSize))),
  M = as.integer(as.factor(dat$MeasureType_Category))
)


rethinking_groupsize_measures <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + G*r[M]+m[M],
    r[M] ~ dnorm(0,1),
    m[M] ~ dnorm(0,1),
    a~normal(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_groupsize_measures,depth=2)[445:454,]


cooperative<-dat[dat$CooperativeBreeding==1,]

dat_list <- list(
  N_spp = nrow(cooperative),
  Z_obs = cooperative$Fishers_Z_r,
  Z_sd = cooperative$Variance, 
  M = as.integer(as.factor(cooperative$MeasureType_Category))
)


rethinking_cooperation_measures <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <-  m[M],
    m[M] ~ dnorm(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_cooperation_measures,depth=2)[53:57,]

plot(precis( rethinking_cooperation_measures , depth=2 , pars="m" ))



notcooperative<-dat[dat$CooperativeBreeding==0,]

dat_list <- list(
  N_spp = nrow(notcooperative),
  Z_obs = notcooperative$Fishers_Z_r,
  Z_sd = notcooperative$Variance, 
  M = as.integer(as.factor(notcooperative$MeasureType_Category))
)


rethinking_notcooperation_measures <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <-  m[M],
    m[M] ~ dnorm(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_notcooperation_measures,depth=2)[393:399,]


plot(precis( rethinking_cooperation_measures , depth=2 , pars="m" ),xlim=c(0,1))

plot(precis( rethinking_notcooperation_measures , depth=2 , pars="m" ),xlim=c(0,1))



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_groupsize <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + bG*G*r[M],
    r[M] ~ dnorm(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bG~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_groupsize)
```












**Litters per year and cooperative breeding**

Cooperative breeders tend to have higher reproductive rates than species with other breeding systems. However, the association between life history and effect sizes of dominance rank on reproductive success remains across all breeding systems, with larger effect sizes in species producing more litters per year in cooperative (estimate 0.10 - 0.17), plural (0.02 - 0.07), and associated breeders (0.02 - 0.16).


```{r ranksuccess_littersperyear_cooperativebreeding, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

# Assessing whether how rank is determined (agonism vs other) remains associated with different
# effect sizes after accounting that rank is determined differently in cooperative breeders


meta_littersperyear_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding+LittersPerYear, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_littersperyear_cooperativebreeding

metafor_phylogenetic_littersperyear_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+LittersPerYear,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_littersperyear_cooperativebreeding






#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  B = dat$BreedingSystem,
  L = standardize(dat$LittersPerYear)
)


rethinking_littersperyear_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + b[B]*L,
    a~normal(0,1),
    b[B]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_littersperyear_cooperativebreeding,depth=2)[445:450,]



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_littersperyear_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+g*G,
    g~normal(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_littersperyear_cooperativebreeding)



```




**Interactions among social traits**
Cooperative breeders tend to differ in some of the social traits that we investigated separately.

In mammals, groups of cooperative breeders never grow to the same size (in our data, median 2 females per group) as groups of plural/associated breeders (in our data, median 14 females per group), potentially introducing an interaction effect. In our data, both group size and cooperative breeding remain independently associated with the effect sizes of dominance rank on reproductive success. The analyses suggest an interaction, with effect sizes increasing with group size in cooperative breeders (estimate 0.01 - 0.02), where a single dominant continues to monopolize reproduction as groups get larger, and declining with group sizes in other breeding systems (estimate -0.01 - 0.00), where dominants might be less able to control reproduction of other group members as groups grow larger.

Similarly, there appears to be an interaction between average relatedness and breeding systems, with effect sizes increasing with higher levels of average relatedness in cooperative breeders (estimate 0.00 - 0.12) and decreasing with higher levels of average relatedness in plural/associate breeders (estimate -0.06 - 0.00)

Female dispersal is more common in cooperative breeders (46%) than in plural/associated breeders (9%), however, effect sizes are larger in species with female dispersal also just among the plural/associated breeders (estimate -0.19 - -0.02), though differences between philopatry and dispersal are not associated with effect sizes in cooperative breeders (estimate -0.10 - 0.12). 

Among plural/associated breeders, average relatedness is lower in species in which females disperse (mean r 0.03) than in species in which females are philopatric (mean r 0.10), and among these species, differences in effect sizes are mainly associated with whether females disperse or are philopatric (estimate -0.22 - -0.02) rather than levels of average relatedness (estimate -0.04 - 0.01).

Coalition formation does not occur in cooperative breeders, leading to a potential confound. Among plural/associated breeders, effect sizes are higher in species in which females do form coalitions than in species where they do not (estimate of difference 0.01 - 0.11).



```{r ranksuccess_social_cooperativebreeding, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}

# Assessing whether there is an interaction between group size and cooperative breeding on the effect sizes

meta_groupsize_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding*GroupSize, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_groupsize_cooperativebreeding

metafor_phylogenetic_groupsize_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+GroupSize,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_groupsize_cooperativebreeding



dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  C = dat$CooperativeBreeding+1,
  G = standardize(dat$GroupSize)
)


rethinking_groupsize_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + c[C]+g*G+cg[C]*G,
    a~normal(0,1),
    c[C]~normal(0,0.5),
    g~normal(0,1),
    cg[C]~normal(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_groupsize_cooperativebreeding,depth=2)[445:450,]
posterior<-extract.samples(rethinking_groupsize_cooperativebreeding)
difference_groupsize_cooperativebreeding<-posterior$m[,2]-posterior$m[,1]
precis(difference_groupsize_cooperativebreeding)



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_groupsize_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+g*G+cg[C]*G,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    g~normal(0,1),
    cg[C]~normal(0,1),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_groupsize_cooperativebreeding)



# Assessing whether female dispersal is independently associated with higher effect sizes in addition to cooperative breeding


meta_dispersal_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~Philopatry+CooperativeBreeding , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_dispersal_notcooperativebreeding

metafor_phylogenetic_dispersal_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~Philopatry+CooperativeBreeding,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_dispersal_cooperativebreeding



philopatry<-dat[is.na(dat$Philopatry)==F,]

dat_list <- list(
  N_spp = nrow(philopatry),
  Z_obs = philopatry$Fishers_Z_r,
  Z_sd = philopatry$Variance, 
  P = as.integer(as.factor(philopatry$Philopatry)),
  C = philopatry$CooperativeBreeding+1
)


rethinking_philopatry_cooperativebreeding <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + p[C]*P + c[C],
        a~normal(0,1),
        p[C]~normal(0,0.5),
        c[C]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_cooperativebreeding,depth=2)[416:421,]



dat_list$Dmat<-Dmat[ philopatry$Latin,philopatry$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_philoptray_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + p[C]*P+c[C],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    p[C]~normal(0,0.5),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_philoptray_cooperativebreeding,depth=2)[416:421,]




# Assessing whether there is an interaction between average relatedness and cooperative breeding


meta_relatedness_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~AverageRelatedness*CooperativeBreeding , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_relatedness_cooperativebreeding

metafor_phylogenetic_relatedness_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~AverageRelatedness*CooperativeBreeding,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_relatedness_cooperativebreeding



relatednessdat<-dat[is.na(dat$AverageRelatedness)==F,]

dat_list <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness),
  C = relatednessdat$CooperativeBreeding+1
)


rethinking_philopatry_cooperativebreeding <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + r[C]*R + c[C],
        a~normal(0,1),
        r[C]~normal(0,0.5),
        c[C]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_cooperativebreeding,depth=2)[289:294,]


# Dispersal & relatedness
relatednessdat<-dat[is.na(dat$AverageRelatedness)==F,]
relatednessdat<-relatednessdat[is.na(relatednessdat$Philopatry)==F,]
relatednessdat<-relatednessdat[relatednessdat$CooperativeBreeding==0,]

dat_list <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness),
  P = as.integer(as.factor(relatednessdat$Philopatry))
)


rethinking_philopatry_relatedness <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + r*R + p[P],
        a~normal(0,1),
        r~normal(0,0.5),
        p[P]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_relatedness,depth=2)[281:285,]
posterior<-extract.samples(rethinking_philopatry_relatedness)
difference_philopatry_relatedness<-posterior$p[,2]-posterior$p[,1]
precis(difference_philopatry_relatedness)








#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_coalition <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CoalitionFormation, data=dat[dat$CooperativeBreeding==0,], method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_coalition

metafor_phylogenetic_coalition <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CoalitionFormation,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat[dat$CooperativeBreeding==0,])
metafor_phylogenetic_coalition



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

coalitiondat<-dat[is.na(dat$CoalitionFormation)==F,]
coalitiondat<-coalitiondat[coalitiondat$CooperativeBreeding==0,]

dat_list_coalition <- list(
  N_spp = nrow(coalitiondat),
  Z_obs = coalitiondat$Fishers_Z_r,
  Z_sd = coalitiondat$Variance, 
  C = as.integer(as.factor(coalitiondat$CoalitionFormation))
)

#We run the model
rethinking_coalition <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[C],
    a~normal(0,1),
    b[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_coalition)
precis(rethinking_coalition,depth=2)[374:378,]
posterior<-extract.samples(rethinking_coalition)
difference_coalition<-posterior$b[,2]-posterior$b[,1]
precis(difference_coalition)




```



**Different influences in captive and wild populations**
Models in which both the intercept and the slopes can vary according to whether studies were performed in the wild or in captivity also showed that there are no systematic differences of the effects of dominance rank on reproductive success between populations in these settings (for the different life history measurements and for cooperative breeding). 

```{r ranksuccess_captivity_interactions, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}




meta_captivity_measurement <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~MeasureType_Category*Populationtype , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_captivity_measurement

metafor_phylogenetic_captivity_measurement <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~MeasureType_Category*Populationtype,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_captivity_measurement




meta_captivity_cooperation <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~Populationtype*CooperativeBreeding , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_captivity_cooperation

metafor_phylogenetic_captivity_measurement <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding*Populationtype,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_captivity_measurement





dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  M = as.integer(as.factor(dat$CooperativeBreeding)),
  P = as.integer(as.factor(dat$Populationtype))
)


dat_list$P[dat_list$P==3]<-2

rethinking_philopatry_cooperativebreeding <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + p[M]*P + c[M],
        a~normal(0,1),
        p[M]~normal(0,0.5),
        c[M]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_cooperativebreeding,depth=2)[445:458,]

```



  
  &nbsp; 
    


### G. DISCUSSION

Our study finds that, in social mammals, dominant females have higher reproductive success than lower-ranking females. Positive effects of dominance rank are present for all our measures of life history and highest for life-time reproductive success, suggesting that even if dominants might face some trade-offs (e.g. higher stress levels @cavigelli2003female), obtaining a high ranking position in a social group leads to fitness benefits. While there is a consistent positive relationship between higher dominance rank and higher reproductive success, the data we were able to bring together for this study also indicates that studies have primarily focused on systems where strong effects can be detected and that reports of weak or absent relationships between rank and reproductive success might be missing in the published literature. In particular, effects were less extreme in studies that had been conducted across longer time-frames. Studies conducted for longer time spans likely have larger sample sizes to estimates effects. Alternatively, or in addition, natural changes in dominance rank and events that affect all females equally (e.g. infanticide @cheney2004factors) occur only rarely, so that short-term studies will be strongly influenced by current conditions whereas long-term measures might balance across conditions. Our meta-analysis also highlights several factors associated with variation in the strength of the effect of dominance rank on reproductive success, where social factors in particular appear to have a modulating influence while variation in life history and ecological factors appears of less importance.    

Overall, we estimated an average effect of 0.28 of rank on reproductive success. What does this mean? First, it is important to highlight that this effect size reflects how well rank predicts reproductive success, but not directly indicates how different the reproductive success of high-ranking females is from that of low-ranking females. While the effect of dominance has to be zero in groups where all females have exactly the same reproductive success, an effect of zero is also found in a group where there are large differences in reproduction success across females which though does not align with the females' dominance rank. Just by chance, we would expect differences in reproductive success among females in a social group and we could also expect that these differences are associated with traits that we might use to classify social rank. To assess whether the effects we detect are higher than such random variation, we performed simulations. For this, we simulated artificial groups of females reflecting macaques, the genus most common in our sample. We assumed that each female in each group might have between 0 to 8 offspring, with an average 2 (following a Poisson distribution, so most females have 1 or 2 offspring). We performed 10,000 simulations of six groups of twelve females each (the median group size in our data). When we set no association between rank and reproductive success, less than 0.1% of simulations showed an effect size as high or higher than the 0.28 we observe in the data. Effect sizes for a perfect association between each female's rank and her reproductive success ranged from 0.75-0.95 (mean 0.88). Simulations in which the two highest ranking females always have the highest reproductive success while rank among lower ranking females no longer is associated with success produces effect sizes close to what we observe (mean 0.32), whereas values tend to be lower if only the highest ranking female consistently has the highest success (mean 0.18). While these simulations cannot resolve whether high ranking females have higher reproductive success because they obtained this position or whether there are some traits that lead to both higher rank and higher reproductive success, they indicate that social rank has a particular association with reproductive success beyond the random variation we expect in social groups.


```{r ranksuccess_expectationsimulations, eval=FALSE, warning=FALSE, results='asis', echo=TRUE}




# Perfect association
emptylist<-c()
for (i in 1:10000) {
success<-c(sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)))
dominants<-rep(c(1,2,3,4,5,6,7,8,9,10,11,12),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)


# average 0.88


# Highest ranking one best, thereafter no association
emptylist<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)))
dominants<-rep(c(1,sample(c(2,3,4,5,6,7,8,9,10,11,12),11)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)

# average 0.18


# Highest two ranking best, thereafter no association
emptylist<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)))
dominants<-rep(c(1,2,sample(c(3,4,5,6,7,8,9,10,11,12),10)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)

#Average 0.33


# No association
emptylist<-c()
for (i in 1:10000) {
success<-c((rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)))
dominants<-rep(c(1,sample(c(2,3,4,5,6,7,8,9,10,11,12),11)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,-1*sqrt(summary(lm(success~dominants))$r.squared), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)

# 84/10000 higher than 0.28




# Highest ranking one best thereafter no association - in smaller group
emptylist<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)))
dominants<-rep(c(1,sample(c(2,3,4,5,6),5)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)


emptylist<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(4,2,0.2)),sort(rgampois(4,2,0.2)),sort(rgampois(4,2,0.2)),sort(rgampois(4,2,0.2)),sort(rgampois(4,2,0.2)),sort(rgampois(4,2,0.2)))
dominants<-rep(c(1,sample(c(2,3,4),3)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)




# Highest two ranking best thereafter no association - in smaller group
emptylist<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)),sort(rgampois(6,2,0.2)))
dominants<-rep(c(1,2,sample(c(3,4,5,6),4)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)





# Highest two ranking best, thereafter no association; normal distribution
emptylist<-c()
for (i in 1:10000) {
success<-c(sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)))
dominants<-rep(c(1,2,sample(c(3,4,5,6,7,8,9,10,11,12),10)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
emptylist<-c(emptylist,effectsize)
}
hist(emptylist)

```



Among the social traits we investigated, the highest difference in the effect of rank on reproductive success was between cooperative breeders and plural/associated breeders. This results was expected given the higher reproductive skew that has been found among females in cooperative breeders (@lukas2012cooperative). The difference in reproductive control of dominant females in cooperative breeders compared to plural/associated breeders are also reflected in the different relationships of the effect sizes with group size in the different breeding systems. While among cooperative breeders there usually is only a single breeding dominant female and large groups occur when her reproductive output is higher, dominant females in plural/associated breeders likely face reduced opportunities to control reproduction in larger groups (@rubenstein2016discrete). In this context, it is again important to note that we only look at the association between rank and the variation in reproductive success within groups. Even though the relative difference between dominant and subordinate females might be lower in larger group sizes, in terms of overall fitness it might still be better to be the dominant in a larger group if mean fitness increases with group size (e.g. small group where dominant has 3 versus subordinate has 2 offspring (50% higher fitness) compared to large group where dominant has 4 while all other females have 3 offspring (33% higher fitness)).

Of the ecological variables we investigated, only population density was associated with differences in effect sizes of dominance rank on reproductive success. This might indicate dominants have higher reproductive success because they are consistently able to outcompete other females in the group rather than dominant individuals having better abilities to cope with challenging conditions. This is also supported by our observation that dominance rank has a lower effect on survival, which generally responds less to differential resource availability than fertility. Most of the social mammals in our sample are long-lived, so it also fits with expectations that they would invest additional resources into their own increased fertility rather than any offspring they already have. 

Our findings highlight that social factors can have important influences on demography and genetic evolution. The effect of high dominance rank on reproductive success can influence the growth and composition of social groups across generations. In particular when social rank is heritable, strong long-term changes are visible in the few studies which have been able to track reproductive success across multiple generations. For example, among spotted hyenas, the highest ranking female in 1979 is the ancestor of more than half of the females in the clan in 2009. For future studies, such detailed long-term investigations are not only relevant to understand the long-term consequences of the effect of dominance rank on reproduction, but also to infer the specific mechanisms that link rank to reproductive output. On the flip side, there were many studies in our sample that indicate that higher dominance rank does is not associated with increased reproductive output, raising the question why a dominance structure exists in these groups.






  
### G. ETHICS
Our study relies on previously published data.


### H. AUTHOR CONTRIBUTIONS

**Shivani:** Hypothesis development, data collection, data analysis and interpretation, revising/editing.

**Huchard:** Hypothesis development, data analysis and interpretation, write up, revising/editing.

**Lukas:** Hypothesis development, data collection, data analysis and interpretation, write up, revising/editing, materials/funding.

### I. FUNDING

Shivani received funding from the INSPIRE programme of the Department of Science & Technology of the Government of India. This research was supported by the Department of Human Behavior, Ecology and Culture at the Max Planck Institute for Evolutionary Anthropology.

### J. CONFLICT OF INTEREST DISCLOSURE

We, the authors, declare that we have no financial conflicts of interest with the content of this article. Elise Huchard and Dieter Lukas are Recommenders at PCI Ecology.
  
  &nbsp; 

### K.  Acknowledgements

We thank our PCI Ecology Recommender, Matthieu Paquet, and our reviewers, Bonaventura Majolo and one anonymous reviewer, for their valuable feedback that greatly improved this piece of research. We are grateful to the members of the Department of Human Behavior, Ecology and Culture at the Max Planck Institute for Evolutionary Anthropology for feedback during the early stages of this project.
    
      &nbsp; 
    
### L. [REFERENCES](MyLibrary.bib)
