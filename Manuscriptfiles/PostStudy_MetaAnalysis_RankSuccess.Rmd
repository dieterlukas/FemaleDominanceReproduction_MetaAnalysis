---
title: The effect of dominance rank on female reproductive success in social mammals
author: 
- 'Shivani^1,2^' 
- 'Elise Huchard^3^'
- 'Dieter Lukas^2^*'
date: '`r Sys.Date()`'
mainfont: Arial
linestretch: 1.2
output:
  pdf_document:
    keep_tex: no
    latex_engine: xelatex
    includes:
      in_header: "ranksuccessheader.tex"
  md_document: 
    toc: true
  html_document: 
    toc: TRUE
    toc_depth: 4
    toc_float: 
      collapsed: false
    code_folding: hide 
  github_document: 
    toc: true
bibliography: MyLibrary.bib
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
---
##### Affiliations 
1. Indian Institute of Science Education and Research Kolkata 
2. Department of Human Behavior, Ecology & Culture; Max Planck Institute for Evolutionary Anthropology Leipzig
3. Institut des Sciences de l’Evolution de Montpellier, Centre National de la Recherche Scientifique, Université de Montpellier  

Correspondence: * dieter_lukas@eva.mpg.de

```{r setup, include=FALSE}
options(width=60)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60), tidy=TRUE)
```


\ 
  &nbsp;
\   

Open... ![](logoOpenAccess.png){width=2.5%} access; ![](logoOpenCode.png){width=2.5%}   [code; ](https://github.com/corinalogan/grackles/blob/master/Files/Preregistrations/gdispersal_manuscript.Rmd) ![](logoOpenPeerReview.png){width=2.5%}   peer review;  ![](logoOpenData.png){width=2.5%}    [data](https://doi.org/10.5063/F1W66J48)
\ 
  &nbsp;
\   
  &nbsp;
  
  &nbsp;
  
**The background, objectives, predictions, and methods are unchanged from the preregistration that has been pre-study peer reviewed and received an In Principle Recommendation by:** 

![](logoPCIecology.png){width=25%}
\
Matthieu Paquet (2020) The effect of dominance rank on female reproductive success in social mammals. *Peer Community in Ecology*, 100056. [10.24072/pci.ecology.100056] (https://doi.org/10.24072/pci.ecology.100056) (Reviewers: Bonaventura Majolo and one anonymous reviewer)

  &nbsp;
  
**The preregistration for this article can be found here:** Shivani, Huchard E., Lukas D. 2020. [Preregistration - The effect of dominance rank on female reproductive success in social mammals](https://dieterlukas.github.io/Preregistration_MetaAnalysis_RankSuccess.html) In principle acceptance by *PCI Ecology* of the version 1.2 on 07 July 2020 

https://github.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/blob/trunk/Preregistration_MetaAnalysis_RankSuccess.Rmd


   
&nbsp; 

  
## Abstract

Life in social groups, while potentially providing social benefits, inevitably leads to conflict among group members. In many social mammals, such conflicts lead to the formation of dominance hierarchies, where high-ranking individuals consistently outcompete other group members. Given that competition is a fundamental tenet of the theory of natural selection, it is generally assumed that high-ranking individuals have higher reproductive success than lower-ranking individuals. Previous reviews have indicated large variation across populations on the potential effect of dominance rank on reproductive success in female mammals. Here, we perform a meta-analysis based on 444 effect sizes from 187 studies on 86 mammal species to investigate how life-history, ecology and sociality modulate the relationship between female dominance rank and fitness. We show that (1) dominance rank is generally positively associated with reproductive success, independent of the approach different studies have taken to answer this question; (2) life-history mechanisms mediate the relationship between rank and reproductive success, with higher effects of dominance rank on reproductive output than on survival, particularly in species with high reproductive investment; (3) the fitness benefits to high-ranking females appear consistent across ecological conditions, and (4) instead the social environment consistently mitigates rank differences on reproductive success by modulating female competition, with dominant females showing higher reproductive success than subordinates either when societies are complex (large groups of cooperative breeders) or when relationships among females in the societies are complex (small groups of unrelated breeding females).

   
  
  
 &nbsp; 
   
## Background

In order for social groups to persist, group members need to find strategies to deal with the conflicts that inevitably occur (@ward2016sociality). In many female social mammals, conflicts and aggressive interactions are associated with the formation of different types of hierarchies. In singular cooperative breeders, a single dominant breeding female  suppresses reproduction in subordinate group members, who rarely fight amongst each other until an opportunity to become dominant opens (@solomon1997cooperative). In many species where multiple breeding females form stable groups, females can be arranged in stable linear hierarchies, where mothers help their daughters to inherit their rank in their matriline (@holekamp1991dominance). In another set of species, hierarchies are more flexible as a female’s rank depends on her body size, condition, or availability of coalition partners (@pusey2012magnitude). Given that, in species in which dominance hierarchies structure social groups, females can always be attributed either a low or a high rank, it has remained unclear whether and when there is selection on females to compete for a high rank or whether selection is on finding a place in the hierarchy.  

The prevailing assumption is that high ranking females benefit from their dominant status because outcompeting other females is expected to provide them with priority of access to resources (@ellis1995dominance, @pusey2012magnitude). Subordinates are expected to accept their status, because despite having lower reproductive success than dominants, they have few outside options and would presumably face high costs, or have even lower success if they tried to challenge for the dominant status or to reproduce independently (@alexander1974evolution, @vehrencamp1983model). An alternative assumption however is that both dominants and subordinates gain from arranging themselves in a hierarchy to avoid the overt fighting that occurs whenever differentially aggressive individuals repeatedly interact (@west1967foundress). All individuals make a compromise, such that they all balance the potential benefits of their respective positions with the potential costs (@williams1966adaptation). 

Previous reviews have found that while high ranking female mammals frequently appear to have higher reproductive success, there are many populations where such an association has not been found (@pusey2012magnitude, @clutton2013social). Most studies that brought together the evidence have focused on primates and generally only provided qualitative summaries of the evidence (@fedigan1983dominance, @ellis1995dominance, @stockley2011female). One meta-analysis across primates investigated whether life history might mediate the strength of the association between dominance and reproductive success and found that high-ranking females had higher fecundity benefits in species with a longer lifespan (@majolo2012fitness). However, there is no systematic assessment of the many potential factors that have been suggested to mitigate the relationship between rank and reproductive success when high rank might not be associated with higher reproductive success.


&nbsp; 
  
  
## Objective

In this study, we will perform a quantitative assessment of the strength of the relationship between dominance rank and reproductive success in female social mammals and explore factors that might mediate this relationship. Our objective is to identify the sources and ranges of variation in the relationship between rank and reproductive success and predict that the relationship will be influenced by differences in life-history, ecology, and sociality. We address our objective through the following questions, by testing the corresponding predictions: 

#### **1) Does high rank generally lead to higher reproductive success for females in social mammals?**

We expect that, overall, high dominance rank has a positive effect on reproductive success.

#### **2) What are the life history traits that mediate the benefits of rank on reproductive success?**

We expect that dominants have higher reproductive success predominantly in species in which females have the ability to quickly produce large numbers of offspring.


#### **3) What are the ecological conditions that mediate the benefits of rank on reproductive success?**

We expect that differences in reproductive potential will be particularly marked if resources are limited and monopolizable.


#### **4) What are the social circumstances that mediate the benefits of rank?**

We expect that the association between dominance rank and reproduction is stronger in species living in more stable and structured social groups.

  
  &nbsp; 
  


  
## Predictions

To answer these questions, we assessed the following predictions. All our predictions consider the potential direct influence of a specific variable on the size of the effect of dominance rank on reproductive success. The predictions present the direction of the influence we consider a-priori most likely. We will report all results, but in instances where influences are opposite to what we predict further studies will be necessary to place these results in context. In addition, several of the variables we will include are likely to influence each other. Accordingly, analyses with single variables might not necessarily show the predicted direct influence even if it is present (e.g. there might not be a positive relationship between a social system and the size of the effects if species with this particular social system primarily occur in environments where the size of the effect is expected to be smaller). While deciphering all the potential relationships among the variables we include is beyond the scope of this study, we will also perform analyses accounting for these potential interactions among variables by performing path analyses. We focus on instances where we expect that one variable might remove or change the direction of the influence of another variable, and present these at the end of the predictions.

&nbsp; 
  

#### **1) Does high rank generally lead to higher reproductive success for females in social mammals?**

*P1.1: Publication bias does not influence our sample of effect sizes.*

We do not predict a publication bias but that our sample will include studies showing small effect sizes with small sample sizes. Most studies set out to test if high dominance might lead to both benefits and costs, and previous meta-analyses did not detect signals of publication bias (e.g. @majolo2012fitness).

*P1.2: Overall, high dominance rank will be associated with higher reproductive success.*

We predict that, taking into account the power of the different studies, the combined effect of high rank on reproductive success will be positive. Previous studies that summarized existing evidence (e.g. @majolo2012fitness, @pusey2012magnitude) found support for the consensual framework in socio-ecology which argues that high ranking females generally have higher reproductive success than low ranking females.

*P1.3 Effect sizes from the same population and the same species will be similar.*

We predict that studies that have been conducted on the same species, and in particular at the same site, will report similar effects of dominance rank on reproductive success. For some long-term studies, multiple studies have been performed using slightly different methods and/or data from different years which might include the same set of individuals leading to very similar effect size estimates. For studies of the same species from different sites, we expect similarities because many aspects of the life-history and social system that will shape the relationship between rank and reproductive success will be conserved.

*P1.4: Closely related species will show similar effects of dominance rank on reproductive success.*

We predict that effect sizes of the relationship between dominance rank and reproductive success will be more similar among closely related species (@chamberlain2012does) because methodological approaches can be specific to specific Orders (e.g. ungulates are studied differently than primates) and because closely related species share life history, social and ecological traits that might shape the influence of rank on reproductive success.

*P1.5: Effect sizes depend on the approach used.*

We expect that some of the variation in effect size across studies arises from methodological differences: 

(i) we predict lower effect sizes for studies of captive populations compared to wild populations: while the absence of stochastic events in captivity might mean that dominance is more consistently associated with certain benefits, the effects of high dominance rank on reproductive success will be reduced because of lower competition over resources; 
(ii) we predict lower effect sizes for studies where rank was measured based on agonistic interactions rather than on size or age because size and age are frequently directly associated with differences in female reproduction and clear differences between dominants and subordinates may indicate the existence of castes that tend to be associated with strong reproductive monopolization (@lukas2018social); and 
(iii) we predict different effect sizes for studies classifying individuals into two or three rank categories compared to linear ranking depending on the social system. In cases where there is usually a single dominant female (singular cooperative breeders, such as meerkats), using a linear regression between each individuals' rank and its reproductive success will likely estimate a lower effect size because such an approach assumes differences in rank or reproductive success among the subordinates when there are none. In contrast, grouping individuals into categories to compare dominants to subordinates will capture actual differences more accurately. In cases where several females breed (plural breeders, such as hyenas) and are ordered in a linear hierarchy, a linear regression will exploit the full information available on individual differences in rank and reproductive success, whereas grouping individuals will lead to a loss of resolution, at a risk of underestimating the differences between highest and lowest ranking individuals. We performed simulations to determine the extent to which this choice of approach skews the effect sizes and found that it can lead to differences of more than 35% between the true and the estimated effect sizes. For illustration, we include this simulation in our code.  

&nbsp; 
    

#### **2) What are the life history traits that mediate the benefits of rank on reproductive success?**
\ 

*P2.1: High dominance rank will benefit females more than their offspring.*

We predict that high rank is more likely to be associated with higher reproductive success in studies that measured female age at first reproduction, number of offspring born per year or across a lifetime, or female survival rather than the survival of their offspring. While in cooperatively breeding species reproductive suppression might impact offspring survival, in plural breeders offspring survival is more likely to be influenced by factors that are outside of the control of females, such as infanticide by new males (@cheney2004factors). 

*P2.2: Dominance will have stronger effects on immediate reproductive success in species in which females produce many offspring over a short time period.*

One key mechanism that has been proposed is that females with high dominance rank have priority of access to resources during periods when these resources are limited, which in turn can increase their reproductive success. Accordingly, we predict stronger effects of rank on measures of immediate reproductive success (offspring production, offspring survival) in species in which females have higher energetic investment into reproduction, with larger litter sizes and shorter interbirth intervals (@lukas2019evolution). In contrast, in long-lived species in which females produce only single offspring at long intervals, high-ranking females are expected to have less opportunity to translate short-term resource access into immediate reproductive success but might store energy to potentially increase their own survival or lifetime reproductive success. 

&nbsp; 
  

#### **3) What are the ecological conditions that mediate the benefits of rank on reproductive success?**

*P3.1: Positive effects of high dominance rank on reproductive success will be stronger in populations in which females feed on resources that are more monopolizable.*

We predict that high rank will have stronger effects on reproductive success in fruit- and meat-eaters compared to herbivores or omnivores. One of the main expected benefits of high rank is priority of access to resources, which should be more relevant in populations in which resources can be monopolized (@fedigan1983dominance).

*P3.2: Effects of dominance rank on reproductive success will be more pronounced in populations living in harsh environments.*

We predict that the effect of rank on reproductive success will be stronger in populations in which resources are limited because they live in harsh and unpredictable environments. Previous studies have shown that cooperatively breeding species are more likely to occur in such environments (@lukas2017climate), but we also expect stronger effects among plural breeding populations living in harsh environments. 

*P3.3: Effects of dominance rank on reproductive success will be more pronounced in populations with high densities of individuals.*

We predict that the effect of rank on reproductive success will be stronger in populations in which more individuals share a limited amount of space. At higher population densities, social groupings and interactions are more likely and competition over resources is expected to be stronger.

&nbsp; 
  

#### **4) What are the social circumstances that mediate the benefits of rank?**
\ 

*P4.1: Benefits of rank will be most pronounced in cooperatively breeding species.*

We predict that rank effects on reproduction will be higher in cooperative breeders, where the dominant female is often the only breeding female because she suppresses the reproduction of subordinate females (@digby2006role), compared to plural breeders, where aggressive behaviour is more targeted and limited to access over specific resources. 

*P4.2: For plural-breeders, the time-scales at which the reproductive benefits of dominance accrue depend on how individuals achieve high rank.*

We predict that in populations of plural breeders in which groups contain multiple breeding females, the way in which these females compete over dominance will influence the potential benefits of high rank. In populations in which female rank depends primarily on age, high ranking females will have higher reproductive success for short periods of time because changes in rank are expected to occur regularly, and because high rank may only be reached towards the end of their reproductive life (@thouless1986conflict). In societies in which female rank depends primarily on size or condition, rank effects on reproductive success are expected to be expressed on intermediate time frames, as individuals may not be able to maintain a larger relative size or condition over lifetime but they are expected to acquire rank relatively early in their reproductive life   (@giles2015dominance, @huchard2016competitive). In societies in which female rank primarily depends on nepotism, and ranks are often inherited and stable across a female’s lifetime, we predict that effects of rank on reproductive success will be strongest when measured over long periods because small benefits might add up to substantial differences among females (@frank1986social) whereas stochastic events might reduce differences between females on shorter time scales (@cheney2004factors). 

*P4.3: Dominance rank will have stronger effects on reproductive success in populations in which females are philopatric in comparison to populations where females disperse to breed.*

We predict that effects of rank on reproductive success will be lower in populations in which adult females are able to leave their group and join other groups compared to populations in which females cannot breed outside their natal group. In populations in which females are philopatric, they are likely to have support from female kin which can strengthen dominance differences (@lukas2018social). In addition, in species where females can change group membership easily, females are expected to join those groups where they have the best breeding option available to them (@vehrencamp1983model). 

*P4.4: In plural breeding species, dominance will have stronger effects on reproductive success when the number of females in the group is smaller.*

We predict that the effect of rank on reproductive success will be stronger in plural breeding populations in which there are fewer females per group, because dominant females will be more likely to interfere in reproductive attempts when there are fewer subordinates (@clutton2010adaptive and because increased competition in larger groups is expected to reduce reproductive success even among dominants (@van1988scramble). 

*P4.5 Dominance rank will be more strongly associated with reproductive success in populations in which average relatedness among female group members is high.*

We predict that the relationship between dominance rank and reproductive success will be more pronounced in species in which social groups primarily consist of close kin compared to groups composed of unrelated females. Groups with high levels of average kinship among females are those where groups are small, females remain philopatric (@lukas2005extent), and females have support to establish their positions (@lukas2018social), which all are expected to lead to higher benefits of high rank.

*P4.6 Dominance rank will be more strongly associated with reproductive success in populations in which variance in relatedness among female group members is high.*

In addition to levels of average relatedness among group females, we also predict that the relationship between dominance rank and reproductive success will be more pronounced in species in which there is high variance in relatedness, with females being closely related to some group members but not to others, as compared to species in which group females are either all related or all unrelated. In several species with female philopatry, groups are structured into matrilines (@fortunato2019lineal). Members of the same matriline tend to support each other in interactions with unrelated females, likely reinforcing differences among females. 

*P4.7 The effect of dominance on reproductive success will be less pronounced in populations in which females regularly form coalitions.*

We predict that high ranking females will have less pronounced reproductive benefits in species in which females form strategic coalitions with others (@bercovitch1991social). Individuals have been suggested to form strategic coalitions to level the reproduction of others (@pandit2003model) and these coalitions are less likely in cooperatively breeding species (@lukas2018social). 

*P4.8 Dominance rank will have less effect on reproductive success in populations in which there is intense inter-sexual conflict.*

We predict that the association between high dominance rank and increased reproductive success of females will be lower in populations in which males compete intensively over reproductive opportunites because this leads to intersexual conflict that harms female fitness (@swedell2014sexual). In such populations, males tend to be aggressive towards females and males taking up tenure in a group tend to kill offspring indiscriminately or might even target offspring of high-ranking females (@fedigan2013sexual), reducing any potential differences between high- and low-ranking females. We will assess whether high ranking females benefit less from their positions in populations in which groups show strong female-biased sex composition, or in which males regularly commit infanticide, or with strong sexual size dimorphism with males being much larger than females.

  
  &nbsp; 


#### **5) Potential interactions among predictor variables**
\ 

We expect potential interactions among the predictor variables because some of them might influence each other while others might potentially modulate the influence of another predictor variable on the dominance effects. The following six predictions were those we added in the preregistration. We added further analyses based on the outcome of the single-factor analyses. These are listed in the changes from the preregistration section.
  
  &nbsp; 

*Studies performed on wild versus captive individuals and using different measures of reproductive success might not only differ in the overall strength of the effect of rank on reproductive success, but also in how other variables influence this effect.*

*Higher population density [predicted to lead to larger effect sizes] might be associated with larger group sizes [smaller effect sizes predicted], leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Smaller group sizes [larger effect sizes predicted) might be associated with more intense intersexual conflict [smaller effect sizes predicted], leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Monopolizable resources [larger effect sizes predicted] might be associated with reduced population density [smaller effect sizes predicted]), leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Environmental harshness [larger effect sizes predicted] might be associated with reduced population density [smaller effect sizes predicted]), leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*

*Female philopatry [larger effect sizes predicted] might be associated with increased group sizes [smaller effect sizes predicted]), leading to an interactive influence on the strength of the effect sizes of dominance rank on reproductive success.*



  
  &nbsp; 
    
    
## Methods

#### **Literature search**

The literature search was performed by S & DL. We started with the references in the previous major reviews and meta-analyses on the association between dominance and reproduction in female mammals (see below for inclusion criteria): @fedigan1983dominance (8 studies on female primates entered), @ellis1995dominance (16 studies entered / 5 studies not entered on female non-primates, 38 studies entered / 22 studies not entered on female primates), @brown2002reconsidering (28 studies entered / 7 studies not entered on female primates), @stockley2011female (12 studies entered / 2 studies not entered on female non-primates, 11 studies entered / 1 study not entered on female primates), @majolo2012fitness (26 studies entered / 2 studies not entered on female primates), @pusey2012magnitude (45 studies entered / 2 studies not entered on female primates), and @clutton2013social (8 studies entered / 1 study not entered on female primates, 6 studies entered / 1 study not entered on female non-primates). Next, we performed database searches in Google Scholar and Pubmed, first by identifying articles citing these major reviews and next by searching with the terms “dominance, reproductive success/reproduction, female, mammal”, and “rank, reproductive success/reproduction, female, mammal”, “sex ratio, dominance, female, mammal” (searches performed July 2019-January 2020). We limited our checks to the first 1000 results for all searches. 

We checked the titles and abstracts to identify studies that observed dominance interactions and reproductive success in social groups of interacting female non-human mammals. We selected studies that measured the association between dominance rank and at least one aspect of female reproductive success and reported the data or a test-statistic. For both dominance and reproductive success, we only included studies that had direct measures, not secondary indicators. For dominance, we excluded studies where authors did not explicitly determine dominance relationships and only assumed that traits such as size, presence in core areas, or reproductive success itself indicate dominance. We did however include studies where authors established dominance hierarchies, found that they are associated with some other trait such as size or condition, and subsequently used the other trait to measure dominance. For reproductive success, we excluded studies that measured traits such as mating frequency or access to food resources which were assumed but not known to influence reproductive success (excluding studies that: measured the size of individuals to argue about dominance; assumed that females in core areas are dominant; assigned dominance to females based on how successful they are; recorded mating success not reproductive success; linked dominance to behaviour assumed to potentially link to reproductive success). We included all kinds of academic publications, from primary articles published in peer-reviewed journals through reviews, books and book chapters, and unpublished PhD theses.


#### **Variables, their definitions, and their sources**
\
**Variables coded directly from the relevant publications:**

All data from the literature search on publications reporting the effect of dominance rank on reproductive success was entered prior to the first submission of the preregistration. S and DL performed the data extraction. We initially coded eight papers independently, for which we both extracted the same values and classified the approaches in the same way. We extracted the relevant information to calculate the effect size and its associated variance. In addition, we coded a set of variables to characterize the methodological approach. The dataset contains 444 effect sizes from 187 studies on 86 mammalian species.

**Z-transformed effect size**: we converted all effect sizes to Z-transformed correlation coefficients (Zr). In cases where articles reported a pairwise correlation coefficient, we directly use this value. In cases where authors had used alternative statistical approaches (e.g. t-test comparison between two groups of individuals), the test statistics were converted to the statistic ‘r’ using formulas provided by @lakens2013calculating, @lajeunesse2013recovering, and @wilson2019calculator. In cases where authors reported individual-level data reflecting dominance rank and reproductive success (for example in the form of a table that listed for groups of dominants and subordinates their mean and deviation of reproductive success or for every individual their rank and reproductive success), we calculated correlation coefficients directly from a 2-by-2 frequency table (when comparing classes of high- to low-ranking individuals) or from linear regressions (when individuals had continuous ranks). In cases where studies simply stated that “all dominants bred but none of the subordinates” we assumed an error of 0.5% for both dominants not breeding and subordinates breeding to obtain the sampling variance estimates. We extracted separate effect sizes for each reported analysis: for example, if authors reported separately associations between dominance rank and mortality of offspring to 1 year and to independence, we obtained two effect sizes from this population reflecting infant survival. We Z-transformed all correlation coefficients to control for the asymptotic distribution of these values. We changed the sign of the effect sizes to make them consistent across studies. This was necessary because dominance rank was coded differently across studies, for example sometimes studies assigned dominant individuals the lowest value by starting a count from 1, whereas in other cases they were assigned the highest value to reflect the proportion of other females they are dominant over. We set the sign of effect sizes such that positive values mean that higher ranking individuals have shorter interbirth intervals, higher survival as adults and of their infants, higher infant production (e.g. larger litter sizes, higher probability of breeding), and higher lifetime reproductive success (e.g. higher total number of offspring weaned).

**Sample size**: we recorded the sample size for the relevant statistical comparison (number of females, number of offspring, number of matrilines etc.).

**Sampling variance**: we calculated the sampling variance of the effect sizes based on the correlation coefficient r and the sample size, using the formulas provided by @wilson2019calculator. The standard error, which is alternatively used in some approaches, is the square root of the sampling variance (@viechtbauer2010conducting).

**Species identity**: we recorded the common name and the latin species name as listed by the authors. We referred to the Mammal Diversity Database (@burgin2018many) to resolve instances where species attributions had been changed since the publication of the original study.  

**Study site**: we recorded the name of the study site as listed by the authors in the method section. The focus of this variable is to determine whether multiple observations are from the same species from the same study population, and we accordingly assigned different names for the study site label in case two or more different species had been studied at the same site. 
 
**Measure of reproductive success**: we recorded which aspect of reproduction dominance rank was associated with. We classified reproductive traits into six classes: 
- age at first reproduction (includes age at first birth, age at first conception, age at first menstrual cycle); 
- infant survival (includes rates of mortality of offspring prior to their independence; proportion of pregnancies carried to birth);
- survival (includes rates of mortality of females per year, age at death); 
- infant production (includes litter size, offspring weight, litter mass, number of offspring per year, probability of birth in a given year, number of surviving infants per year); 
- interbirth interval (includes time between life births, number of cycles to conception, number of litters per year); 
- lifetime reproductive success (includes total number of offspring born or surviving to independence for females who had been observed from first reproduction to death).

**Classification of rank**: we recorded the approach the authors had used to assign dominance positions to individuals, distinguishing between those based on aggressive/submissive interactions between pairs of individuals and those based on other traits such as age, size, or which female was the first to reproduce.

**Scoring of rank**: we recorded whether in the analyses individuals were assigned a specific, continuous rank position or whether individuals were classified into rank categories (dominant versus subordinates, high- versus middle- versus low-ranking).

**Duration of study**: we recorded the number of years that authors had observed the individuals (anything less than one year was assigned a value of 1).

**Population type**: we recorded whether the population was free-living, provisioned, or captive based on the authors descriptions.

**Social group size**: we recorded the average number of adult females per group in the study population, based on the information provided in the manuscripts. We relied on the definition of a social group as used by the respective authors, which might include associations of females in: singular-breeder cooperative groups (as in wolves or meerkats); stable groups of multiple breeding females (as in baboons or hyenas); or breeding associations defined by physical proximity (as in bighorn sheep or antelopes). We will have a separate coding of the social system (see below). Where available, we also coded the average number of adult males associated with each group of females to determine the sex ratio in social groups as a proxy for intersexual conflict.


**Variables extracted from the broader literature for each species/population:**

The following data were added prior to the analyses. For most of these, we extracted information from the relevant papers or publications reporting on the same population. For some of these, we used previously published species’ averages, because records from each population for each specific period during which the effect of dominance rank on reproductive success were measured were not available for a large enough sample. We list sources we used to obtain these data.

**Litter size**: the number of offspring per birth; data available for each population, we used the average as reported by the authors (based on the data in @jones2009pantheria).

**Interbirth interval**: the time in months between consecutive births; data available for a limited set of populations, we used the average as reported by the authors. Given that population specific data was available for only a very limited subset, we added species-level averages (based on the data in @jones2009pantheria).

**Maximum lifespan**: the maximum time in months that an individual of that species has been recorded to live for (based on the data in @jones2009pantheria).

**Cooperative breeding group**: whether social groups usually contain a single breeding female and additional non-breeding adult females that help to raise the offspring of the breeding female. Group membership for females is usually closed and changes occur through birth and death or fissioning of existing groups. This classification is in contrast to plural breeding groups and breeding associations (see below); data available for each population, we used the description of the social system in the population as reported by the authors.

**Plural breeding group**: whether social groups usually contain multiple breeding females that remain together for extended periods of time. It includes both groups in which females are philopatric or disperse. Females form differentiated relationships with other group members. This classification is in contrast to cooperative breeding groups and breeding associations (see above/below); data available for each population, we used the description of the social system in the population as reported by the authors.

**Breeding association**: whether social groups consist of multiple breeding females that associate either in space or by mutual attraction. Group membership is fluid and associations among individuals can rapidly change. This classification is in contrast to cooperative breeding groups and plural breeding groups (see above); data available for each population, we will use the description of the social system in the population as reported by the authors.

**Dominance system**: whether dominance rank of females appears to depend primarily on (i) their age, (ii) their physical attributes such as body size, (iii) support from their mother, or (iv) coalitionary support from same-aged group members. Data available from a subset of populations, to which we added data from primary reports of species-level classifications from other populations assuming that this trait is usually stable across populations within species (references listed in the data file).

**Philopatry**: whether females have the majority of their offspring in the same social groups or in the same location in which they have been born or whether females disperse to other groups or locations to reproduce; data from species-level descriptions of female behaviour (based on the data in @barsbai2021local).

**Monopolizable resources**: whether the gross dietary category of a species is based on monopolizable resources (carnivory, frugivory), or non-monopolizable resources (herbivory, or omnivory) (based on the data in @wilman2014eltontraits). 

**Environmental harshness**: whether the average climatic conditions experienced by the species are characterized by cold temperatures, low rainfall, and unpredictability (based on the data and principal components summarizing climate data in @botero2014environmental).

**Population density**: the average number of individuals per square kilometer for the species (based on the data in @jones2009pantheria).

**Average and variance in relatedness among group females**: the average and variance in relatedness measured using genetic approaches among adult females within the same group as reported for this species; data available from a subset of the populations (references listed in the data file).

**Coalition formation**: whether adult females form coalitions with other female group members to support each other during within-group aggressive interactions; data from species-level descriptions of female behaviour (based on the data in @lukas2018social).

**Sexual dimorphism in body weight**: we calculated sexual dimorphism following the two step approach of @smith1999statistics as the average weight of males divided by average weight of females if males are heavier than females and as 2 minus the average weight of females divided by the average weight of males otherwise (based on data in:@jarman1983mating, @loison1999factors, @smith2002scaling, @isaac2005potential, and @kappeler2019evolutionary)

**Male infanticide**: whether adult males in that species kill offspring (based on the data in @lukas2014evolution).

**Adult sex ratio**: the ratio of the average number of adult males divided by the sum of the average number of females and males per social group of that species. We took species' averages to reflect adaptation to likely levels of potential sexual conflict because several of the studies from which we extracted effect sizes had captive or experimental settings or only reported the number of females that were included in the study (based on the data in @barsbai2021local).



#### **Phylogeny**
We generated a single consensus phylogeny for the mammalian species in our sample from the most recent complete mammalian time-calibrated phylogeny (@upham2019inferring). We downloaded a credible set of 1000 trees of mammalian phylogenetic history from vertlife.org/phylosubsets/ (July 2020) and used TreeAnnotator (version 1.8.2 in BEAST: @drummond2012bayesian) to generate a maximum clade credibility (MCC) tree (median node heights and a burn in of 250 trees). We trimmed the tree to match the species in our sample (in one instance using a close relative, /Canis lupus/ instead of /Canis familiaris/ ) and converted branch lengths using functions of the package ape (@paradis2019ape).

    
#### **Analyses**

We performed all analyses in the statistical software R (R Software Consortium 2019). We built separate models for each prediction. To assess the robustness of the findings and whether modeling decisions might have an influence on our results, we used a frequentist and a Bayesian approach to build the statistical models. We first estimated all models using functions in the package metafor (@viechtbauer2010conducting). We fit meta-analytic multilevel mixed-effects models with moderators via linear models, including models that account for the potential correlations among effect sizes due to shared phylogenetic history among species (@nakagawa2012methodological). Second, we estimated relationships with Bayesian approaches as implemented in the package rethinking (@mcelreath2020statistical). For the Bayesian models, we fit multilevel models that include the sampling variance as measurement error (@kurz2019rethinking) and the shared phylogenetic history as a covariance matrix. Weakly regularizing priors are used for all parameters. The models are implemented in Stan. We drew 8000 samples from four chains, checking that for each the Gelman-Rubin convergence diagnostic 'R-hat' values are less than 1.01 indicating that the Markov chains have converged towards the final estimates. Visual inspection of trace plots and rank histograms were performed to ensure that they indicated no evidence of divergent transitions or biased posterior exploration. Posteriors from the model were used to generate estimates of the overall effect size and the influence of potential moderators. We detail model construction in the following: we first assess whether species and population identity create dependencies amongst the measured effect sizes. If so, we include these factors through covariance matrices reflecting the dependence across measurements. We determined whether a variable had a relationship with the variation in the effect of dominance rank on reproductive success when the interval (for metafor the 95% confidence interval of the estimate; for rethinking the 89% compatibility estimate of the posterior sample) of the estimated association did not cross zero (continuous variable) or the contrast between levels does not cross zero (categorical variable), indicating that the model estimates that our data shows a consistent positive/negative association.
We provide all code showing the setup of the various models and the plots, the input files containing the data and phylogeny, as well as a simulated dataset with the same structure as the actual data on which we assessed our models in the preregistration [in the linked github repository](https://github.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis)

&nbsp; 



## **Preregistration**
\ 
We preregistered our hypotheses, methods, and analysis plans: https://dieterlukas.github.io/Preregistration_MetaAnalysis_RankSuccess.html

The literature search was completed before the first submission of the preregistration. All variables that were coded directly from the source publications (Z transformed effect size, variance, sample size, species identity, aspect of reproductive success, classification of rank, duration of study, population type, and social group size) were also entered prior to the first submission. In July 2019, S worked with a preliminary subset of the data (143 effect sizes), and investigated publication bias, the overall mean and variance in effect sizes, and whether effect sizes differed according to which reproductive output was measured. We added the data on the explanatory variables and started analyses in July 2020 after the preregistration passed pre-study peer review at *Peer Community In Ecology*: Paquet (2020) Peer Community in Ecology, 100056. [10.24072/pci.ecology.100056] (https://doi.org/10.24072/pci.ecology.100056)

We collected data on the additional explanatory variables:
  * litter size, litters per year, and population density for the respective species
  * cooperative vs plural vs associate breeding from the descriptions in the respective population from the articles from which we obtained the effect sizes 
  * dominance system from additional references on the species 
  * philopatry of the respective species
  * diet category of the respective species
  * environmental harshness across the range of the respective species
  * coalition formation in the respective species
  * sexual dimorphism in body weight
  * male infanticide
  * sex ratio among adult group members
  * average relatedness from the articles from which we obtained the effect sizes or additional references matching the exact population 
  * we did not collect data on variance in relatedness because it was not possible to extract this information from most studies reporting relatedness levels 


## **Changes from preregistration**
\ 

**Additional variables:**
We added data on the maximum lifespan of species to address Prediction 4.2. We realized that, whether a study should be considered short- or long-term, depends on the lifespan of the species. We used the information on the number of years a study had been conducted together with the maximum lifespan data to calculate the relative duration of a study.

We added data on the dominance style of macaque species after noting that a large proportion of our sample reflects these species. Across macaque species, dominance interactions among females in a group have been assigned into one of four grades, ranging from egalitarian species in Grade 1 to highly despotic species in Grade 4. We predicted that effect sizes of dominance rank on reproductive success would be larger in species characterized as more despotic, with steeper dominance hierarchies and more asymmetries in social interactions (Prediction 4.9). We extracted the data for the species in our sample from @balasubramaniam2012hierarchical

We changed how we calculated sexual dimorphism in body weight. We had previously taken the ratio of male weight divided by female weight. A collaborator on a different project, in which we also use sexual dimorphism in body weight as a variable, alerted us to the article by @smith1999statistics which shows that this simply ratio is biased because it is non-linear and asymmetric when females are the larger sex. We therefore switched to the calculation of sex ratio as recommended in this article by calculating sexual dimorpiism as the average weight of males divided by average weight of females if males are heavier than females and as 2 minus the average weight of females divided by the average weight of males otherwise.

**Outlier check:**
Before running the analyses, we made a funnel plot of the standard error over the effect size, where we noticed three outlier data points. We realized that for these three entries (EffectRefs 425, 427, and 428) we had used the wrong formula to calculate the effect size and variance. All of these are studies of multiple groups of Callithrix jacchus, each with a small number of females. For these three studies, we had erroneously used the 2-by-2 frequency tables to calculate the standardized mean difference, not the correlation coefficient. We corrected the values for these three entries before performing any of the analyses.

**Sampling bias:**
The funnel plot of the complete dataset showed a strong asymmetry, indicating that our sample is biased towards including many studies with low precision and high positive effect sizes. To better illustrate this sample bias, we used a different way to plot the data (@nakagawa2021orchard) that was suggested after we had written our preregistration. We added further analyses to investigate the potential causes of the bias in our sample, both based on functions in the packages 'metafor' (following @nakagawa2021methods) and 'rethinking' (following @mcelreath2020statistical), to determine the potential causes of the bias in our sample and the influence on what effects should be expected in new samples. 

**Multivariate analyses:**
We constructed the multivariate analyses after completing the univariate analyses. We did not perform the multivariate analyses we had listed in the preregistration where the univariate analyses indicated no influence/interaction (group size + intersexual conflict; diet + population density; harshness + population density). We added a set of multivariate analyses after finding that cooperative breeders have very different effect sizes of dominance rank on female reproductive success than plural/associated breeders to determine how this difference between breeding systems might relate to the influence of some of the additional social variables we included.


&nbsp; 
  
## Results

We extracted 444 effect sizes of the relationship between dominance rank and reproductive success of female mammals from 187 studies on 86 species during our literature search. More than half of the effect sizes are from primate species (253 effect sizes), with macaques (109) and baboons (76) a particular focus for this research. About two thirds (283) of the reports are from wild populations; rank was predominantly determined on the basis of aggressive interactions (407) rather than on other measures such as age or size (37); and it was about equally frequent that researchers classified rank categorically as dominant versus subordinant (251) than continuously from highest to lowest (193). Most of the reported effects link dominance rank to infant production (198) followed by infant survival (113), with fewer effects reported on interbirth intervals (46), lifetime reproductive success (34), survival (30), or age at first reproduction (23).

```{r ranksuccess_loaddata, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

# Meta analysis of effect of rank on reproductive success in female social mammals

# Load necessary libraries. Some of these libraries have specific installation requirements (orchaRd and rethinking), please check their respective websites.

library(metafor)
library(ape)
library(geiger)
library(dplyr)
library(readr)
library(orchaRd)
library(patchwork)
library(ggplot2)
library(rethinking)


# Loading the data
# all data are obtained from online sources

# Load input data from GitHub
inputdata<-read_csv(url("https://raw.githubusercontent.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/trunk/Inputfiles/InputData_MetaAnalysis_FemaleDominanceReproduction.csv"))
inputdata<-data.frame(inputdata)
dat<-inputdata

# The following variables are part of the dataset
# [1] "EffectRef"                   "StudyRef"                    "Latin"                      
# [4] "SpeciesRef"                  "MeasureType_Category"        "SampleSize"                 
# [7] "R_value"                     "Fishers_Z_r"                 "Variance"                   
#[10] "No_of_years"                 "Populationtype"              "GroupSize"                  
#[13] "StudyPopulation"             "Rank_Cont_Cat"               "RankDetermined"             
#[16] "LitterSize"                  "LittersPerYear"              "CooperativeBreeding"        
#[19] "PluralBreeding"              "AssociatedBreeding"          "DominanceSystem"            
#[22] "Philopatry"                  "DietCategory"                "EnvironmentalHarshness"     
#[25] "PopulationDensity"           "AverageRelatedness"          "CoalitionFormation"         
#[28] "maleinfanticide"             "sexratio_socialgroup"        "SexualDimorphism_Weight"
#[31] "BreedingSystem"              "SpeciesIncluded"             "Reference_DominanceSucccess" 
#[34] "Reference_DominanceSystem"   "Reference_Relatedness" 

# Load the consensus tree for the 86 species in the actual dataset
mammaltree<-read.nexus(url("https://raw.githubusercontent.com/dieterlukas/FemaleDominanceReproduction_MetaAnalysis/trunk/Inputfiles/CombinedTree_MetaAnalysis_RankSuccess.nex"))

# For linking the phylogeny to the data, we create covariance matrices reflecting the shared phylogenetic history of pairs of species in a distance matrix
phylo_branch <- compute.brlen(mammaltree, method = "Grafen", power = 1)
phylo_cor <- vcv(phylo_branch, cor = T)
Dmat<-cophenetic(mammaltree)

# Setting up the data for the phylogenetic models in rethinking
spp_obs<-unique(dat$Latin)
spp_obs<-matrix(nrow=length(spp_obs))
rownames(spp_obs)<-unique(dat$Latin)
dat$SpeciesIncluded<-dat$Latin



h# How many effect sizes are there for macaques and baboons?
table(dat$Latin)[grep("Macaca",names(table(dat$Latin)))]
table(dat$Latin)[grep("Papio",names(table(dat$Latin)))]
table(dat$Latin)[grep("Theropithecus",names(table(dat$Latin)))]

# How many effect sizes are there for each of the different methodological approaches?
table(dat$Populationtype)
table(dat$RankDetermined)
table(dat$Rank_Cont_Cat)
table(dat$MeasureType_Category)

```


  &nbsp;

#### **1) Does high rank generally lead to higher reproductive success for females in social mammals?**

  &nbsp;
**R1.1 Sample bias**: 
A visual inspection of the range of effect sizes at different sample sizes in a funnel plot (Figure 8a) showed that there might be an underrepresentation of studies with small or negative effect sizes and small sample sizes (@egger1997bias). This sample bias is clearer to see in an orchard plot, which shows that extreme effect sizes tend to be of low precision and that there is an overrepresentation of positive effect sizes (Figure 1). 

---

![](ranksuccess_Fig1_orchard.png)
**Figure 1.** Orchard plot displaying the spread of the 444 effect sizes in our sample (each dot represents a single effect size, the size of the dot indicates the precision). Overall, most studies report a positive association between dominance rank and reproductive success (darker circle in the center indicates the mean). Our sample does show bias, with effect sizes not distributed symmetrical around the center but showing an overrepresentation of highly positive values.

---


```{r ranksuccess_publicationbias, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

# We build the funnel plot based on the estimation of the overall effect size from the base model in metafor
meta_simple <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat)
funnel(meta_simple, level=c(90, 95, 99), shade=c("white", "gray", "darkgray"), 
       yaxis="seinv",xlab="effect size (Zr)",ylab="precision (1/SE)",digits=c(1,0),xlim=c(-2,2),ylim=c(1,30))

#We buid the orchard plot based on the same base model
orchard_plot_basic <- function(object, mod = "Int", xlab, N = "none", alpha = 0.5, angle = 90, cb = TRUE, k = TRUE, transfm = c("none", "tanh")) {
  
  ## evaluate choices
  transfm <- match.arg(transfm) # if not sepcificed it takes the first choice
  
  if(any(class(object) %in% c("rma.mv", "rma.uni", "rma"))){
    if(mod != "Int"){
      object <- mod_results(object, mod)
    } else{
      object <- mod_results(object, mod = "Int")
    }
  }
  
  mod_table <- object$mod_table
  levels(mod_table$name)<-c("Intrcpt","Spread of effect sizes")
  mod_table[mod_table$name %in% "Intrcpt"]$name<-factor("Spread of effect sizes")
  
  data <- object$data
  
  data[data$moderator %in% "Intrcpt",]$moderator<-"Spread of effect sizes"
  
  data$moderator <- factor(data$moderator, levels = mod_table$name, labels = mod_table$name)
  
  data$scale <- (1/sqrt(data[,"vi"]))
  legend <- "Precision (1/SE)"
  
  if(any(N != "none")){
    data$scale <- N
    legend <- "Sample Size (N)"
  }
  
  if(transfm == "tanh"){
    cols <- sapply(mod_table, is.numeric)
    mod_table[,cols] <- Zr_to_r(mod_table[,cols])
    data$yi <- Zr_to_r(data$yi)
    label <- xlab
  }else{
    label <- xlab
  }
  
  mod_table$K <- as.vector(by(data, data[,"moderator"], function(x) length(x[,"yi"])))
  
  # the number of groups in a moderator & data points
  group_no <- nrow(mod_table)
  #data_no <- nrow(data)
  
  # colour blind friendly colours with grey
  cbpl <- c("#E69F00","#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#56B4E9", "#999999")
  
  # Make the orchard plot
  plot <- ggplot2::ggplot(data = mod_table, aes(x = estimate, y = name)) +
    # pieces of fruit (bee-swarm and bubbles)
    ggbeeswarm::geom_quasirandom(data = data, aes(x = yi, y = moderator, size = scale, colour = moderator), groupOnX = FALSE, alpha=alpha) +
    # 95 %prediction interval (PI): twigs
    ggplot2::geom_errorbarh(aes(xmin = lowerPR, xmax = upperPR),  height = 0, show.legend = FALSE, size = 0.5, alpha = 0.6) +
    # 95 %CI: branches
    ggplot2::geom_errorbarh(aes(xmin = lowerCL, xmax = upperCL),  height = 0, show.legend = FALSE, size = 1.2) +
    ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "black", alpha = alpha) +
    # creating dots for truncks
    ggplot2::geom_point(aes(fill = name), size = 3, shape = 21) +
    # putting labels
    #ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
    #                 label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5) +
    ggplot2::theme_bw() +
    ggplot2::guides(fill = "none", colour = "none") +
    ggplot2::theme(legend.position= c(1, 0), legend.justification = c(1, 0)) +
    ggplot2::theme(legend.title = element_text(size = 11)) +
    ggplot2::theme(legend.direction="horizontal") +
    ggplot2::theme(legend.background = element_blank()) +
    ggplot2::labs(x = label, y = "", size = legend) +
    ggplot2::theme(axis.text.y = element_text(size = 14, colour ="black",
                                              hjust = 0.5,
                                              angle = angle)) +
    ggplot2::theme(axis.text.x = element_text(size = 14, colour ="black",
                                              hjust = 0.5,
                                              angle = 0)) + 
    ggplot2::theme(axis.title.x = element_text(size = 18, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 0))
  # putting colours in
  if(cb == TRUE){
    plot <- plot +
      scale_fill_manual(values=cbpl) +
      scale_colour_manual(values=cbpl)
  }
  
  # putting k in
  if(k == TRUE){
    plot <- plot +
      ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
                        label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 4.5)
  }
  
  return(plot)
}

orchard_plot_basic(meta_simple, mod="Int", xlab = "Effect size (Fisher's Z r)", 
             transfm = "none") +
        theme(axis.text = element_text(size = 24, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 90))+
        theme(axis.text.y = element_text(size = 15, colour ="black",
                                              hjust = 0.5,
                                              vjust = 1.5,
                                              angle = 90))
```

  &nbsp;
  
There are potentially (at least) three sources of sample bias, the first being 'publication bias' with studies with low effect sizes (not reaching traditional levels of significance) not ending up in the published literature, the second being 'study system bias' with research focusing on populations where it is easy to detect effects (e.g. cooperative breeders), and the third being 'study time bias' with studies performed over shorter time frames generally being more imprecise. We added further post-hoc analyses to investigate these patterns individually here, and in combined models after identifying which study systems might show different effect sizes (section R5.1).

We applied tests for 'publication bias' that expect a standard distribution of p-values (@preston2004adjusting) to our data, which suggest that effect sizes with a p-value smaller than 0.05 are about four times more likely to be reported than effect sizes with a p-value larger than 0.50. 

```{r ranksuccess_effectsizeselection, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

# The estimation of whether non-significant effect sizes are missing from our sample is based on the full dataset.
meta_basic <- rma(yi=Fishers_Z_r, vi=Variance, data=dat)

# We use two different selection processes to reflect whether studies with specific p-values are more or less likely to be represented in our sample - a halfnormal curve and a stepwise function
plot(selmodel(meta_basic,type="halfnorm"))
plot(selmodel(meta_basic,type="stepfun",steps=c(0.005,0.01,0.025,0.05,0.1,0.9,0.95,1)))


```

As a further indication of 'publication bias', we find that studies with small sample sizes and small effect sizes (those that presumably did not reach statistical significance) are missing in our dataset such that the average effect sizes at smaller sample sizes are more extreme than those at larger sample sizes (metafor estimate 95% confidence interval lower -0.03 to upper -0.02, rethinking estimate 89% compatibility estimate of posterior sample lower -0.09 to upper -0.04) (Figure 2). Nevertheless, the estimated overall effect size in this model remains consistently larger than zero, indicating that even after including any missing studies with small or negative effect sizes there would still be on average a positive relationship between dominance rank and female reproductive success across studies.

  &nbsp;
  
---

![](ranksuccess_Fig2_effectsize_samplesize.png)

**Figure 2.** Relationship between the measured size of the effect of dominance rank on female reproductive success and the sample size of the study. Studies with smaller sample sizes show more extreme effect sizes, and also indications of potential publication bias as there are more extremely positive values than what would be expected based on the average effect sizes of studies with larger sample sizes.

---

```{r ranksuccess_samplesize, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

dat$sei <- sqrt(dat$Variance)


publication.bias.model.sei <- rma.mv(Fishers_Z_r, Variance,
                            mod=~MeasureType_Category+LittersPerYear+CooperativeBreeding+CooperativeBreeding*GroupSize+No_of_years+sei,
                                      random=list(~ 1 | SpeciesIncluded, # phylo effect
                                                  ~ 1 | Latin, # non-phylo effect
                                                  ~ 1 | StudyRef), 
                                      R = list(SpeciesIncluded = phylo_cor), #phylogenetic relatedness
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model.sei



publication.bias.model_simple <- rma.mv(Fishers_Z_r, Variance,
                            mod=~standardize(SampleSize),
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model_simple




# Plot to show how extreme effect sizes are only observed with small sample sizes
plot(abs(dat$Fishers_Z_r)~log(dat$SampleSize))


# Set up the dataframe to look at the influence of the sample size on the observed effect sizes
dat_list_samplesize <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  SampleSize = standardize(dat$SampleSize)
 )
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_samplesize <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+y*SampleSize,
        a~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1)
    ) , data=dat_list_samplesize , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)

precis(rethinking_samplesize)





#Plot for effect size vs sample size
meta_samplesize <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ standardize(SampleSize))

samplesize.plotting<- predict(meta_samplesize)

newdat <- data.frame(N.final = dat$SampleSize,
                                           ES = dat$Fishers_Z_r,
                                           ESVar = dat$Variance,
                                           fit = samplesize.plotting$pred,
                                           upper = samplesize.plotting$ci.ub,
                                           lower = samplesize.plotting$ci.lb,
                                           stringsAsFactors = FALSE)
newdat$precision <- sqrt(1/(newdat$ESVar))
newdat$N.final <- as.numeric(newdat$N.final)
newdat <- newdat[order(newdat$N.final),]
figure_samplesize <- ggplot(newdat, aes(x = N.final, y = ES)) + 
  theme(axis.text.y = element_text(size = 11.5, colour = "black"), 
        axis.text.x = element_text(size = 12.5, colour = "black",face="bold"), 
        panel.background = element_rect(fill = "white"),
        axis.title.y  = element_text(size=16, vjust = 0.5,face="bold"),
        axis.title.x  = element_text(size=20, vjust = 0.5,face="bold"),
        panel.border = element_rect(colour = "black", fill=NA, size = 0.5)) +
  scale_x_continuous(limits = c(0, 1000)) +
  scale_y_continuous(limits = c(-1.1,1.5), expand = c(0, 0), breaks=c(-1.0, -0.5, 0, 0.5, 1)) +
  geom_hline(yintercept = 0, linetype = 1, colour = "black", alpha = 0.4, size = 0.25) +
  geom_hline(yintercept = 0, linetype = 2, colour = "black", alpha = 0.6, size = 0.25) +
  geom_hline(yintercept = 0.5, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_hline(yintercept = -0.5, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_hline(yintercept = 1, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_hline(yintercept = -1, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_point(shape = 21, color = "goldenrod3", fill = "#e6be78", alpha = 0.8, cex = 0.35*(newdat$precision)) +
  geom_ribbon(aes(ymin = lower, ymax = upper, x = N.final), fill = "black", alpha=0.1) +
  geom_smooth(aes(y = fit, x = N.final), color = "black", size = 0.5) +
  labs(x = "Sample size",
       y = "Effect size (Fisher's Z r)") +
  annotate("text", x = 900, y = 1.35, size = 4, label = "italic(k) == 444", parse = TRUE)+ geom_point(aes(x=905, y=-0.8), shape = 21, color = "goldenrod3", fill = "#e6be78", cex=0.35*15) +
  geom_point(aes(x=850, y=-0.8), shape = 21, color = "goldenrod3", fill = "#e6be78", cex = 0.35*5) +
  annotate("text", x = 750, y = -0.8, size = 4, label = "Precision (1/SE)") +
  annotate("text", x = 875, y = -0.8, size = 4, label = "5") +
  annotate("text", x = 935, y = -0.8, size = 4, label = "15")

figure_samplesize



```



  &nbsp;
 
Our data also shows indication that the sample bias might result from 'study system bias', because these base analyses indicate high heterogeneity in our sample (total heterogeneity / total variability: 73.37%). Given the diversity of studies in our sample, we did not expect that the effect sizes represent a sample from a single distribution: for example, studies of offspring mortality tend to have larger sample sizes (because each mother can have multiple offspring) and we predict different effect sizes for these studies. Sections R2 - R4 present the specific analyses for each prediction to assess each of the factors potentially leading to differences between effect size estimates, and we combine them in section R5.1.
  
  &nbsp;
 
Finally, including the number of years a study had been conducted for as a predictor of the effect sizes also indicates that our sample shows 'study time bias'. Effect sizes are lower when studies have been conducted for longer (metafor estimate 95% confidence interval lower -0.01 to upper 0.00, rethinking estimate 89% compatibility estimate of posterior sample lower -0.05 to upper 0.00), but in particular the variance is reduced once a study has been running for 10 ore more years (Figure 3). 


---

![](ranksuccess_Fig3_effectsize_noyears.png)
**Figure 3.** Relationship between the measured size of the effect of dominance rank on female reproductive success and the length a study was conducted for. Studies that have been conducted for 10 or more years tend to have higher precision (larger circle) and tend to be closer to the overall mean.

---


```{r ranksuccess_numberofyears, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

#Determine whether the duration of the study population influences effect sizes, assuming that measurements from the same population and the same species are not independent and that each measurement might have a unique approach (confound with same study means that model does not converge when including 1|StudyRef as additional random variable).
meta_numberofyears <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ No_of_years, random=list(~Populationtype|SpeciesRef))
meta_numberofyears


# Setting up the data for the stan model
dat_list_noyears <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  NoYears = standardize(dat$No_of_years)
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_noyears <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+y*NoYears + p[Pop] + b[Species] + c[Study],
        a~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_noyears , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_noyears,depth=2)[445:447,]



#Plot for effect size vs number of years
meta_numberofyears <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ No_of_years, random=list(~Populationtype|SpeciesRef))
meta_numberofyears

years.plotting<- predict(meta_numberofyears)
years.plotting
newdat <- data.frame(N.final = dat$No_of_years,
                                           ES = dat$Fishers_Z_r,
                                           ESVar = dat$Variance,
                                           fit = years.plotting$pred,
                                           upper = years.plotting$ci.ub,
                                           lower = years.plotting$ci.lb,
                                           stringsAsFactors = FALSE)
newdat$precision <- sqrt(1/(newdat$ESVar))
newdat$N.final <- as.numeric(newdat$N.final)
newdat <- newdat[order(newdat$N.final),]
figure_no_of_years <- ggplot(newdat, aes(x = N.final, y = ES)) + 
  theme(axis.text.y = element_text(size = 12.5, colour = "black"), 
        axis.text.x = element_text(size = 12.5, colour = "black"), 
        panel.background = element_rect(fill = "white"),
        axis.title.y  = element_text(size=16, vjust = 0.5,face="bold"),
        axis.title.x  = element_text(size=20, vjust = 0.5,face="bold"),
        panel.border = element_rect(colour = "black", fill=NA, size = 0.5)) +
  scale_x_continuous(limits = c(0, 45)) +
  scale_y_continuous(limits = c(-1.5,1.5), expand = c(0, 0), breaks=c(-1.0, -0.5, 0, 0.5, 1)) +
  geom_hline(yintercept = 0, linetype = 1, colour = "black", alpha = 0.4, size = 0.25) +
  geom_hline(yintercept = 0, linetype = 2, colour = "black", alpha = 0.6, size = 0.25) +
  geom_hline(yintercept = 0.5, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_hline(yintercept = -0.5, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_hline(yintercept = 1, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_hline(yintercept = -1, linetype = 1, colour = "black", alpha = 0.25, size = 0.25) +
  geom_point(shape = 21, color = "goldenrod3", fill = "#e6be78", alpha = 0.8, cex = 0.35*(newdat$precision)) +
  geom_ribbon(aes(ymin = lower, ymax = upper, x = N.final), fill = "black", alpha=0.1) +
  geom_smooth(aes(y = fit, x = N.final), color = "black", size = 0.5) +
  labs(x = "Number of years study was performed",
       y = "Effect size (Fisher's Z r)") +
  annotate("text", x = 44, y = 1.35, size = 4, label = "italic(k) == 444", parse = TRUE)+ geom_point(aes(x=43, y=-1.35), shape = 21, color = "grey36", fill = "grey50", cex=0.35*15) +
  geom_point(aes(x=40, y=-1.35), shape = 21, color = "grey36", fill = "grey50", cex = 0.35*5) +
  annotate("text", x = 35, y = -1.35, size = 4, label = "Precision (1/SE)") +
  annotate("text", x = 41, y = -1.35, size = 4, label = "5") +
  annotate("text", x = 45, y = -1.35, size = 4, label = "15")

figure_no_of_years


```



  &nbsp;
  
**R1.2 Overall effect**: 
We constructed an intercept-only meta-analytic base model to test for a general effect of dominance rank on reproductive success. Across our sample, there is consistent evidence that females with higher dominance rank have higher reproductive success (metafor estimate of overall effect size +0.22 - +0.27, rethinking estimate +0.26 - +0.30; the metafor estimate here and in the additional models is lower than the rethinking estimate because the statistical approach of the former expects the data to be more symmetrical than they are (see Figure 1 for the bias) while the rethinking approach pools information from the available data, with the metafor estimate being closer to the median of the raw data of 0.23 and the rethinking estimate closer to the mean of 0.29). This overall effect means, for example, that in groups with two individuals dominants would have between 0-6 offspring while subordinates have between 0 to 4 offspring. There is large variation though in our sample, with effect sizes ranging from -0.89 to +1.33 (Figure 1).

```{r ranksuccess_overalleffect, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

#base model in metafor: determine the overall effect size, accounting for the measurement error as reflected by the sampling variance
meta_simple <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat)
meta_simple



#base model in rethinking: determine the overall effect size
#We create the structured data file for the model 
dat_list_simple <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance
)

#We run the model assuming that the sampling variance (Z_sd) reflects an error in the measurements of the true effect sizes (Z_true) giving the effect sizes in the sample (Z_obs). The inferred values for mu reflect the overall estimates for the effect size and the values for sigma the associated variance in the sample.
rethinking_simple <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu ~ normal(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list_simple)
precis(rethinking_simple)

```


  &nbsp;
  
**R1.3 Influence of locality/species**: 
To the base model, we added random effects to account for non-independence due to effect sizes originating from within the same study, from studies performed on the same population and on the same species. The estimate of the overall effect size did not change in this model accounting for non-independence (metafor estimate of overall effect size when accounting for non-independence +0.22 - +0.31, rethinking estimate +0.26 - +0.35) from the overall effect estimated in the base model. Effect sizes from the same species and the same study, but not the same population, tend to be similar to each other. The absence of a population effect could be because there are only very few observations in our dataset of the same population taken in different studies where there are also observations from multiple additional populations of the same species. Alternatively, it could be that effects do not vary across populations of the same species, which is also indicated by the absence of differences between wild and captive populations (see below).

```{r ranksuccess_samesource, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#Determine the overall effect size in a model that assumes that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_randomfactors <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, method="REML", random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_randomfactors

#Check potential dependence from each of the random factors separately
#model with species as random term
meta_species <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, slab=StudyRef, random=~1|SpeciesRef)
meta_species 

#model with study as random term
meta_study <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, slab=EffectRef, random=~ 1|StudyRef)
meta_study 

#model with population as random term
meta_population <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, slab=EffectRef, random=~ 1|StudyPopulation)
meta_population 


# Setting up the data for the stan model
dat_list_moderators <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_moderators_hyperprior <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + p[Pop] + b[Species] + c[Study],
        a~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_moderators , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_moderators_hyperprior)

```


  &nbsp;
  
**R1.4 Influence of phylogeny**: 
To the random effects model, we added a covariance structure to reflect potential similarities in effect sizes arising from closely related species showing similar effects due to their shared phylogenetic history. Both statistical approaches indicate that closely related species tend to have effect sizes that are more similar than those of distantly related species. The metafor approach suggests that about 20% of the variation in effect sizes is associated with covariation among species. The rethinking approach shows high uncertainty in the estimates (Figure 4), reflecting the high heterogeneity in the underlying data with high variation within species and different measures taken among closely related species. It suggests that species of the same genus tend to have similar effect sizes and that shared phylogenetic history might also explain similarities in effect sizes among species in the same Order, but covariance estimates are close to zero for species pairs that are more distantly related (Figure 4; the hightest standardized distance between any pair of species in the same Order is 0.40).

---

![](ranksuccess_Fig4_covariation_phylogeny.png)
**Figure 4.** Relationship between the phylogenetic distance between pairs of species and the similarity of their effect sizes (solid black line represents mean estimate of rethinking model, grey lines represent variation in the estimate). Species that are closely related and share most of their phylogenetic history (standardized phylogenetic distance close to zero) show intermediate levels of covariance in their effect sizes of dominance rank on female reproductive success. The covariance drops to low values at a standardized phylogenetic distance of around 0.4, the level separating species that are part of the same Order.

---


```{r ranksuccess_phylogeny, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#Determine whether how rank was classified (continuous or categorical) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.

metafor_phylogenetic <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~1,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic




#Next, we convert the phylogeny into a covariance matrix that reflects the shared phylogenetic history among all pairs of species in the sample
#There are two approaches: first assuming a Brownian Motion model of evolution, and next a model that includes the parameter Pagel's lambda to account for potential changes in the rate of evolution

dat_list_phylogenetic <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  G = runif(n=nrow(dat),0,1)
)

Rbm<-corBrownian( phy = mammaltree )
Rlambda<-corPagel(0.75,phy=mammaltree,fixed=FALSE)
VCV_bm <- vcv(Rbm)
VCV_pagel<-vcv(Rlambda)
dat_list_phylogenetic$V <- VCV_bm[ dat$Latin,dat$Latin ]
dat_list_phylogenetic$R <-dat_list_phylogenetic$V / max(VCV_bm)
dat_list_phylogenetic$R<-dat_list_phylogenetic$R*0.99
diag(dat_list_phylogenetic$R)<-1
dat_list_phylogenetic$V_pagel <- VCV_pagel[ dat$Latin,dat$Latin ]
dat_list_phylogenetic$R_pagel <-dat_list_phylogenetic$V_pagel / max(VCV_pagel)
dat_list_phylogenetic$R_pagel <-dat_list_phylogenetic$R_pagel*0.99
diag(dat_list_phylogenetic$R_pagel)<-1

rethinking_phylogenetic_brownian <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- R * sigma_sq,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~exponential(1)
  ),data=dat_list_phylogenetic,cmdstan=T)
precis(rethinking_phylogenetic_brownian)


rethinking_phylogenetic_pagel <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- R_pagel * sigma_sq,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~exponential(1)
  ),data=dat_list_phylogenetic,cmdstan=T)
precis(rethinking_phylogenetic_pagel)


Dmat<-cophenetic(mammaltree)
dat_list_phylogenetic$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bG~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic,chains=4,cores=4)
precis(rethinking_phylogenetic_gaussian)


#To check the phylogenetic signal, we plot the estimate covariance(similarity) in effect sizes as species are more distantly related
#A phylogenetic signal in the plot would be shown by high covariances among species that have small phylogenetic distances and declining covariances as phylogenetic distance increases
#For the simulated dataset, most of the estimates show a covariance of 0, and no change as phylogenetic distance increases
post<-extract.samples(rethinking_phylogenetic_gaussian)

originalpar<-par()

op <- par(oma=c(0,2.5,0,0), mar=c(4.5,4.5,3.2,4.2), mfrow=c(1,1))
plot(NULL,xlim=c(0,max(dat_list_phylogenetic$Dmat)),ylim=c(0,3.5),xlab="Standardized phylogenetic distance between species",ylab="Covariance in effect sizes between species",bty="n",cex.lab=1.5)
for (i in 1:50) curve(post$etasq[i]*exp(-post$rhosq[i]*x^2),add=TRUE,col="grey75")
valuesacross<-rep(NA,101)
for (x in 0:100) {
  valueshere<-rep(NA,500)
  for ( i in 1:500 ) {
  
    valueshere[i]<-post$etasq[i]*exp(-post$rhosq[i]*(x/100)^2) 
  } 
  valuesacross[x+1]<-mean(valueshere)
  }
lines(x=seq(from = 0, to =1, by=0.01), y= valuesacross, lwd=7)
par<-originalpar

```

  &nbsp;
  
**R1.5 Influence of approach**:
To the base model, we add random effects reflecting the differences in approaches across studies (dominance ranks classified continuous/categorical; dominance determined through agonism/correlate; population type wild/provisioned/captive; number of years of the study).

Studies which measured dominance rank categorically by classifying individuals as either dominants or subordinates report higher effect sizes (metafor estimate +0.29 - +0.35, rethinking estimate +0.31 - +0.41; n=251 effect sizes) than studies assigning individuals continuous ranks (metafor estimate 0.16-0.22, rethinking estimate +0.17 - +0.28; n=193 effect sizes). In essentially all studies of cooperative breeders (31 of 32 effect sizes), comparisons were between the single dominant female and a class of the remaining subordinate females, which may contribute to higher effect sizes for studies using categorical measures of rank (see section R5.2.1).

Studies which determined the rank of females based on agonistic interactions have lower effect sizes (metafor estimate +0.22 - +0.26, rethinking estimate +0.24 - +0.32; n=407 effect sizes) than studies which used other correlates (body size, age, etc.) to assign dominance ranks (metafor estimate 0.43-0.55, rethinking estimate +0.41 - +0.63; n=37 effect sizes). These 37 effect sizes where rank was assigned based on correlates are from cooperative breeders and/or studies in which groups consisted of mothers and their daughters.

Effect sizes did not vary between studies conducted with captive (metafor estimate +0.24 - +0.30, rethinking estimate +0.27 - +0.37; n=183 effect sizes), provisioned (metafor estimate +0.21 - +0.33, rethinking estimate +0.14 - +0.41; n=23 effect sizes), or wild (metafor estimate +0.22 - +0.34; n=283 effect sizes) individuals, and this does not change when we nest the population type within species (indicating that effect sizes do not differ between captive, provisioned, and wild populations of the same species).



```{r ranksuccess_approach, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#Determine whether how rank was classified (continuous or categorical) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_rankmeasurement <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ Rank_Cont_Cat, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_rankmeasurement

#Determine whether how rank was determined (agonism or another correlate) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_rankdetermined <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ RankDetermined, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_rankdetermined

#Determine whether the type of study population (wild, provisioned, captive) influences effect sizes, assuming that measurements from the same population and the same species are not independent and that each measurement might have a unique approach (confound with same study means that model does not converge when including 1|StudyRef as additional random variable).
meta_populationtype <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ Populationtype, random=list(~1|StudyPopulation,~1|SpeciesRef))
meta_populationtype



#Determine whether the type of study population (wild, provisioned, captive) influences effect sizes, assuming that measurements from the same population and the same species are not independent and that each measurement might have a unique approach (confound with same study means that model does not converge when including 1|StudyRef as additional random variable).
meta_populationtype <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ Populationtype, random=list(~Populationtype|SpeciesRef))
meta_populationtype


# Setting up the data for the stan model
dat_list_rankmeasured <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Rankmeasured = as.integer(as.factor(dat$Rank_Cont_Cat))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_rankmeasured <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Rankmeasured] + p[Pop] + b[Species] + c[Study],
        a[Rankmeasured]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_rankmeasured , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_rankmeasured,depth=2)[445:447,]


# Setting up the data for the stan model
dat_list_rankdetermined <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Rankdetermined = as.integer(as.factor(dat$RankDetermined))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_rankdetermined <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Rankdetermined] + p[Pop] + b[Species] + c[Study],
        a[Rankdetermined]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_rankdetermined , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_rankdetermined,depth=2)[445:447,]



# Setting up the data for the stan model
dat_list_populationtype <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Populationtype = as.integer(as.factor(dat$Populationtype))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_populationtype <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Populationtype] + p[Pop] + b[Species] + c[Study],
        a[Populationtype]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_populationtype , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_populationtype,depth=2)[445:447,]


rethinking_populationtype_nested <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- g[Populationtype] + alpha[Species,Populationtype],
        transpars> matrix[Species,3]:alpha <-
            compose_noncentered( sigma_species , L_Rho_species , z_species ),
        matrix[3,Species]:z_species~normal(0,1),
        g[Populationtype]~normal(0,1),
        vector[3]:sigma_species~dexp(1),
        cholesky_factor_corr[3]:L_Rho_species ~ lkj_corr_cholesky( 2 ),
        gq> matrix[3,3]:Rho_species <<- Chol_to_Corr(L_Rho_species),
        sigma_sq~dexp(1)
    ) , data=dat_list_populationtype , chains=4 , cores=4 , log_lik=TRUE ,iter=18000)
precis(rethinking_populationtype_nested,depth=2)[445:451,]


# Setting up the data for the stan model
dat_list_noyears <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  NoYears = standardize(dat$No_of_years)
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_noyears <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+y*NoYears + p[Pop] + b[Species] + c[Study],
        a~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        p[Pop] ~ dnorm( 0 , sigma_pop ),
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_pop ~ dexp(1),
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_noyears , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_noyears,depth=2)[445:447,]


```



  &nbsp;
  
#### **2) What are the life history traits that mediate the benefits of rank on reproductive success?**

  &nbsp;
  
**R2.1 Influence of measure of reproductive success**:
To the base model, we add a predictor variable reflecting the six classes of measures of reproductive success.

Dominance rank appears to have the highest effect on age at first conception (metafor estimate +0.32 - +0.43, rethinking estimate +0.33 - +0.52; n=23 effect sizes), life time reproductive success (metafor estimate +0.27 - +0.40, rethinking estimate +0.31 - +0.47; n=34 effect sizes), interbirth interval (metafor estimate +0.25 - +0.37, rethinking estimate +0.28 - +0.37; n=46 effect sizes), infant production (metafor estimate +0.21 - +0.33, rethinking estimate +0.23 - +0.38; n=198 effect sizes), adult survival (metafor estimate +0.18 - +0.31, rethinking estimate +0.18 - +0.34; n=30 effect sizes), infant survival (metafor estimate +0.14 - +0.25, rethinking estimate +0.15 - +0.26; n=113 effect sizes). Effects of dominance rank on survival are lower than on other measures of female fitness (contrasts between infant survival and age at first conception/life time reproductive success/interbirth interval/infant production do not cross zero; contrasts between adult survival and age at first conception/life time reproductive success/interbirth interval do not cross zero). While effect sizes for life time reproductive success are slightly higher (but contrasts overlap zero) than those for the values from which it is usually calculated (adult survival, interbirth interval, infant production), there does not appear to be a straightforward additive (or multiplicative) combination of the individual effects (Figure 5)

---

![](ranksuccess_Fig5_effectsize_lifehistorymeasure.png) 
**Figure 5.** Raw effect sizes of dominance rank on reproductive success are generally higher for cooperative breeders (a) than for plural breeders (b), and differ according to the measure of reproductive success. In general, dominance appears to have stronger effects on reproductive output (lifetime reproductive success, age at first conception, infant production, inter-birth intervals) than on survival (both of the adult females themselves and of their infants). The differences between measures of reproductive success change slightly when accounting for similarity among observations from the same and related species, but the ordering remains the same.

---


```{r ranksuccess_measure, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#Determine whether how rank was classified (continuous or categorical) influences effect sizes, assuming that measurements from the same study, the same population, and the same species are not independent and that each measurement might have a unique approach.
meta_measuretype <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat, mods=~ MeasureType_Category, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))
meta_measuretype



# Setting up the data for the stan model
dat_list_measuretype <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance,
  Pop = as.integer(as.factor((dat$StudyPopulation))),
  Species = as.integer(dat$SpeciesRef),
  Study = as.integer(as.factor(dat$StudyRef)),
  Measuretype = as.integer(as.factor(dat$MeasureType_Category))
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_rankmeasured <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a[Measuretype] + b[Species] + c[Study],
        a[Measuretype]~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        b[Species] ~ dnorm( 0 , sigma_spec ),
        c[Study] ~dnorm(0, sigma_study),
      ## hyper-priors
        sigma_spec ~ dexp(1),
        sigma_study ~ dexp(1)
    ) , data=dat_list_measuretype , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)
precis(rethinking_rankmeasured,depth=2)[445:451,]

plot(precis( rethinking_rankmeasured , depth=2 , pars="a" ))

# a[1]: age at first conception, a[2]: interbirth interval, a[3]: infant survival, a[4]: infant production, a[5]: lifetime reproductive success, a[6]: adult survival
posterior<-extract.samples(rethinking_rankmeasured)
difference_rankmeasured<-posterior$a[,2]-posterior$a[,1]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,3]-posterior$a[,1]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,4]-posterior$a[,1]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,5]-posterior$a[,1]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,6]-posterior$a[,1]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,3]-posterior$a[,2]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,4]-posterior$a[,2]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,5]-posterior$a[,2]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,6]-posterior$a[,2]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,4]-posterior$a[,3]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,5]-posterior$a[,3]
precis(as.numeric(difference_rankmeasured))
# does *not* overlap zero

difference_rankmeasured<-posterior$a[,6]-posterior$a[,3]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,5]-posterior$a[,4]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,6]-posterior$a[,4]
precis(as.numeric(difference_rankmeasured))
# does overlap zero

difference_rankmeasured<-posterior$a[,6]-posterior$a[,5]
precis(as.numeric(difference_rankmeasured))
# does overlap zero


meta_measuretype_cooperative <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat[dat$BreedingSystem=="1",], mods=~ -1+ MeasureType_Category, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))


orchard_plot_cooperative <- function(object, mod = "Int", N = "none", alpha = 0.5, angle = 90, cb = TRUE, k = TRUE, transfm = c("none", "tanh")) {
  
  ## evaluate choices
  transfm <- match.arg(transfm) # if not sepcificed it takes the first choice
  
  if(any(class(object) %in% c("rma.mv", "rma.uni", "rma"))){
    if(mod != "Int"){
      object <- mod_results(object, mod)
    } else{
      object <- mod_results(object, mod = "Int")
    }
  }
  
  mod_table <- object$mod_table
  
  data <- object$data
  data$moderator <- factor(data$moderator, levels = mod_table$name, labels = mod_table$name)
  
  data$scale <- (1/sqrt(data[,"vi"]))
  legend <- "Precision (1/SE)"
  
  if(any(N != "none")){
    data$scale <- N
    legend <- "Sample Size (N)"
  }
  
  if(transfm == "tanh"){
    cols <- sapply(mod_table, is.numeric)
    mod_table[,cols] <- Zr_to_r(mod_table[,cols])
    data$yi <- Zr_to_r(data$yi)
    label <- xlab
  }else{
    label <- xlab
  }
  
  mod_table$K <- as.vector(by(data, data[,"moderator"], function(x) length(x[,"yi"])))
  
  # the number of groups in a moderator & data points
  group_no <- nrow(mod_table)
  #data_no <- nrow(data)
  
  # colour blind friendly colours with grey
  cbpl <- c("#E69F00","#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#56B4E9", "#999999")
  
  # Make the orchard plot
  plot <- ggplot2::ggplot(data = mod_table, aes(x = estimate, y = name)) +
    # pieces of fruit (bee-swarm and bubbles)
    ggbeeswarm::geom_quasirandom(data = data, aes(x = yi, y = moderator, size = scale, colour = moderator), groupOnX = FALSE, alpha=alpha) +
    # 95 %prediction interval (PI): twigs
    ggplot2::geom_errorbarh(aes(xmin = lowerPR, xmax = upperPR),  height = 0, show.legend = FALSE, size = 0.5, alpha = 0.6) +
    # 95 %CI: branches
    ggplot2::geom_errorbarh(aes(xmin = lowerCL, xmax = upperCL),  height = 0, show.legend = FALSE, size = 1.2) +
    ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "black", alpha = alpha) +
    # creating dots for truncks
    ggplot2::geom_point(aes(fill = name), size = 3, shape = 21) +
    # putting labels
    #ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
    #                 label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5) +
    ggplot2::theme_bw() +
    ggplot2::guides(fill = "none", colour = "none") +
    ggplot2::theme(legend.position= c(1, 0), legend.justification = c(1, 0)) +
    ggplot2::theme(legend.title = element_text(size = 11)) +
    ggplot2::theme(legend.direction="horizontal") +
    ggplot2::theme(legend.background = element_blank())  +
    ggplot2::labs(x = label, y = "", size = legend)
  # putting colours in
  if(cb == TRUE){
    plot <- plot +
      scale_fill_manual(values=cbpl) +
      scale_colour_manual(values=cbpl)
  }
  
  # putting k in
  if(k == TRUE){
    plot <- plot +
      ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
                        label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5)
  }
  
  return(plot)
}


plot1<-orchard_plot_cooperative(meta_measuretype_cooperative)+xlim(-3.0,1.5)+theme(axis.line=element_blank(),axis.text.x=element_blank(),axis.text.y = element_blank(),axis.title.x = element_blank(),axis.title.y=element_blank())+ theme(plot.margin = unit(c(1,1,0,15), "lines"))+annotate('text', x = -2, y = 1:3, label = c("Infant production","Infant survival","Adult survival"),fontface="bold",size=5,col=c("#E69F00", "#009E73","#F0E442"))+coord_cartesian(ylim = c(0.5, 3),xlim=c(-1.0,1.5), clip = "off")


#For plural and associative breeders
meta_measuretype_social<- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat[dat$BreedingSystem!="1",], mods=~ -1+ MeasureType_Category, random=list(~1|StudyRef,~1|StudyPopulation,~1|SpeciesRef,~1|EffectRef))

orchard_plot_plural <- function(object, mod = "Int", N = "none", alpha = 0.5, angle = 90, cb = TRUE, k = TRUE, transfm = c("none", "tanh")) {
  ## evaluate choices
  transfm <- match.arg(transfm) # if not sepcificed it takes the first choice
  if(any(class(object) %in% c("rma.mv", "rma.uni", "rma"))){
    if(mod != "Int"){
      object <- mod_results(object, mod)
    } else{
      object <- mod_results(object, mod = "Int")
    }
  }
  mod_table <- object$mod_table
  data <- object$data
  data$moderator <- factor(data$moderator, levels = mod_table$name, labels = mod_table$name)
  data$scale <- (1/sqrt(data[,"vi"]))
  legend <- "Precision (1/SE)"
  if(any(N != "none")){
    data$scale <- N
    legend <- "Sample Size (N)"
  }
  if(transfm == "tanh"){
    cols <- sapply(mod_table, is.numeric)
    mod_table[,cols] <- Zr_to_r(mod_table[,cols])
    data$yi <- Zr_to_r(data$yi)
    label <- xlab
  }else{
    label <- xlab
  }
  mod_table$K <- as.vector(by(data, data[,"moderator"], function(x) length(x[,"yi"])))
  # the number of groups in a moderator & data points
  group_no <- nrow(mod_table)
  #data_no <- nrow(data)
  
  # colour blind friendly colours with grey
  cbpl <- c("#D55E00","#E69F00","#009E73",   "#CC79A7", "#56B4E9", "#F0E442", "#999999")
  
  # Make the orchard plot
  plot <- ggplot2::ggplot(data = mod_table, aes(x = estimate, y = name)) +
    # pieces of fruit (bee-swarm and bubbles)
    ggbeeswarm::geom_quasirandom(data = data, aes(x = yi, y = moderator, size = scale, colour = moderator), groupOnX = FALSE, alpha=alpha) +
    # 95 %prediction interval (PI): twigs
    ggplot2::geom_errorbarh(aes(xmin = lowerPR, xmax = upperPR),  height = 0, show.legend = FALSE, size = 0.5, alpha = 0.6) +
    # 95 %CI: branches
    ggplot2::geom_errorbarh(aes(xmin = lowerCL, xmax = upperCL),  height = 0, show.legend = FALSE, size = 1.2) +
    ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "black", alpha = alpha) +
    # creating dots for truncks
    ggplot2::geom_point(aes(fill = name), size = 3, shape = 21) +
    # putting labels
    #ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
    #                 label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5) +
    ggplot2::theme_bw() +
    ggplot2::guides(fill = "none", colour = "none") +
    ggplot2::theme(legend.position= c(1, 0), legend.justification = c(1, 0)) +
    ggplot2::theme(legend.title = element_text(size = 11)) +
    ggplot2::theme(legend.direction="horizontal") +
    ggplot2::theme(legend.background = element_blank()) +
    ggplot2::labs(x = label, y = "", size = legend) +
    ggplot2::theme(axis.text.y = element_text(size = 14, colour ="black",
                                              hjust = 0.5,
                                              angle = angle)) +
    ggplot2::theme(axis.text.x = element_text(size = 14, colour ="black",
                                              hjust = 0.5,
                                              angle = 0)) + 
    ggplot2::theme(axis.title.x = element_text(size = 18, colour ="black", face = "bold",
                                               hjust = 0.5,
                                               vjust = -0.5,
                                               angle = 0))
  # putting colours in
  if(cb == TRUE){
    plot <- plot +
      scale_fill_manual(values=cbpl) +
      scale_colour_manual(values=cbpl)
  }
  # putting k in
  if(k == TRUE){
    plot <- plot +
      ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
                        label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5)
  }
  
  return(plot)
}



plot2<-orchard_plot_plural(meta_measuretype_social)+xlim(-3.0,1.5)+theme(axis.line=element_blank(),axis.text.x=element_blank(),axis.text.y = element_blank(),axis.title.x = element_blank(),axis.title.y=element_blank())+ theme(plot.margin = unit(c(0,1,5,15), "lines"))+annotate('text', x = 1, y = -0.4, label = "1.0",fontface="bold",size=4)+annotate('text', x = 2, y = -0.4, label = "2.0",fontface="bold",size=4) +annotate('text', x = 0.0, y = -0.4, label = "0.0",fontface="bold",size=4)+annotate('text', x = 0.5, y = -0.4, label = "0.5",fontface="bold",size=4)+annotate('text', x = 1.5, y = -0.4, label = "1.5",fontface="bold",size=4)+annotate('text', x = -0.5, y = -0.4, label = "-0.5",fontface="bold",size=4)+annotate('text', x = -1.0, y = -0.4, label = "-1.0",fontface="bold",size=4)+annotate('text', x = 0.25, y = -1.0, label = "Effect size (Fisher's Z r)",fontface="bold",size=6)+annotate('text', x = -2, y = 1:7, label = c("Age at first conception","Infant production","Infant survival","Inter-birth interval","Lifetime success","Adult survival",""),fontface="bold",size=5,col=c("#D55E00","#E69F00","#009E73",   "#CC79A7", "#56B4E9", "#F0E442", "#999999"))+coord_cartesian(ylim = c(0.5, 6.5), xlim=c(-1,1.5),clip = "off")



plot_grid(plot1,
          plot2,
          labels = c('Fig A) Cooperative breeders','Fig B) Plural breeders'),
          label_x = 0.0,
          hjust = -0.05,
          ncol = 1,
          rel_heights = c(1,2))

```


  &nbsp;
  
**R2.2 Litter Size and Litters Per Year**
Effects of dominance on reproductive success are higher in species with larger litter sizes (metafor estimate of litter size +0.03 - +0.05, rethinking estimate +0.05 - +0.09; n=444 effect sizes) and with more litters per year (metafor estimate of litters per year +0.04 - +0.08, rethinking estimate +0.06 - +0.11; n=444 effect sizes). Effect sizes in species where females produce single offspring are on average 0.25 while effect sizes in species where females produce litters are on average 0.34, and effect sizes in species where females produce one or fewer litters per year are on average 0.25 while effect sizes in species where females produce multiple litters each year are on average 0.45. The association of the effect sizes with the number of litters per year remained when accounting for the phylogenetic relatedness among species, but the association with litter size did not, suggesting that it might be influenced by other characteristics that differ among species with variable litter sizes.



```{r ranksuccess_litters, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_littersize <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ LitterSize, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_littersize

metafor_phylogenetic_littersize <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~LitterSize,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_littersize



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_groupsize <- list(
  N_spp = nrow(dat),
  Fishers_Z_r = dat$Fishers_Z_r,
  Variance = dat$Variance, 
  LitterSize_s = standardize(dat$LitterSize)
)

dat$LitterSize_s<-standardize(dat$LitterSize)

#We run the model
rethinking_groupsize <- ulam(
  alist(
    Fishers_Z_r ~dnorm ( Z_true , Variance),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+bG*LitterSize_s,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_groupsize)
precis(rethinking_groupsize)


#calculate and plot values at the minimum group size, 2,10,50,100 females, and the maximum group size
groupsize.seq <-  c(-1,-0.84895,-0.415,1.753,4.4635,8)
pred_dat <- list( LitterSize_s = groupsize.seq)
mu <- link( rethinking_groupsize , data=pred_dat )
mu.mean <- apply( mu , 2 , mean )
mu.PI <- apply( mu , 2 , PI , prob=0.89 )
plot( Fishers_Z_r ~ G , dat , col=col.alpha(rangi2,0.5) ,xaxt="n")
at <- c(-0.84895,-0.415,1.753,4.4635)
labels <- at*sd(dat$LitterSize) + mean(dat$LitterSize)
axis( side=1 , at=at , labels=round(labels,1) )
lines( groupsize.seq , mu.mean )
shade( mu.PI , groupsize.seq )


dat_list_phylogenetic_littersize <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  L = standardize(standardize(log(dat$LitterSize)))
)

dat_list_phylogenetic_littersize$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_littersize <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bL*L,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bL~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_littersize)
precis(rethinking_phylogenetic_gaussian_littersize)




#model assessing the influence of different litters per year on the measured effect sizes, with study reference as random term


meta_littersperyear <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ LittersPerYear, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_littersperyear

metafor_phylogenetic_littersperyear <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~LittersPerYear,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_littersperyear



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_littersperyear <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  L = standardize(dat$LittersPerYear)
)

#We run the model
rethinking_littersperyear <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+bL*L,
    a~normal(0,1),
    bL~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_littersperyear)
precis(rethinking_littersperyear)




dat_list_phylogenetic_littersperyear <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  L = standardize(standardize(log(dat$LittersPerYear)))
)

dat_list_phylogenetic_littersperyear$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_littersperyear <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bL*L,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bL~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_littersperyear)
precis(rethinking_phylogenetic_gaussian_littersperyear)


```







  &nbsp;
  

#### **3) What are the ecological conditions that mediate the benefits of rank on reproductive success?**
  
  &nbsp;
  
**R3.1 Diet Category**

Effect sizes are larger in carnivores (0.35; n=72 effect sizes) than in omnivores (0.28; n=227 effect sizes),  herbivores (0.25; n=117 effect sizes), or frugivores (0.21; n=28 effect sizes) (estimated difference carnivores versus omnivores rethinking -0.14 - -0.01, difference carnivores versus herbivores rethinking -0.16 - -0.03, difference carnivores versus frugivores rethinking -0.24 - -0.02; estimates for all other comparisons cross 0). Carnivores are no longer estimated to have different effect sizes when the phylogenetic relatedness among species is taken into account, potentially due to the higher prevalence of cooperative breeding in carnivores.



```{r ranksuccess_diet, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_diet <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ DietCategory, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_diet

metafor_phylogenetic_diet <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~DietCategory,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_diet



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

dietdat<-dat[is.na(dat$DietCategory)==F,]

dat_list_diet <- list(
  N_spp = nrow(dietdat),
  Z_obs = dietdat$Fishers_Z_r,
  Z_sd = dietdat$Variance, 
  D = as.integer(as.factor(dietdat$DietCategory))
)

#We run the model
rethinking_diet <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_diet)
precis(rethinking_diet,depth=2)[444:450,]
posterior<-extract.samples(rethinking_diet)

# b[1]: carnivores 0.35
precis(rethinking_diet,depth=2)[445,1]+precis(rethinking_diet,depth=2)[446,1]

# b[2]: frugivore 0.21
precis(rethinking_diet,depth=2)[445,1]+precis(rethinking_diet,depth=2)[447,1]

# b[3]: herbivore 0.25
precis(rethinking_diet,depth=2)[445,1]+precis(rethinking_diet,depth=2)[448,1]

# b[4]: omnivore 0.28
precis(rethinking_diet,depth=2)[445,1]+precis(rethinking_diet,depth=2)[449,1]

difference_diet<-posterior$b[,2]-posterior$b[,1]
precis(difference_diet)

difference_diet<-posterior$b[,3]-posterior$b[,1]
precis(difference_diet)

difference_diet<-posterior$b[,4]-posterior$b[,1]
precis(difference_diet)


dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


```




  &nbsp;
  
**R3.2 Environmental Harshness**

With our data, we find no evidence for an association between environmental harshness and the effect of dominance rank on reproductive success (metafor estimate -0.3 - +0.4, rethinking -0.6 - +0.1; no change when accounting for shared phylogenetic history; n=259 effect sizes).

```{r ranksuccess_harshness, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_harshness <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ EnvironmentalHarshness, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_harshness

metafor_phylogenetic_harshness <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~EnvironmentalHarshness,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_harshness



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

harshnessdat<-dat[is.na(dat$EnvironmentalHarshness)==F,]

dat_list_harshness <- list(
  N_spp = nrow(harshnessdat),
  Z_obs = harshnessdat$Fishers_Z_r,
  Z_sd = harshnessdat$Variance, 
  H = standardize(harshnessdat$EnvironmentalHarshness)
)

#We run the model
rethinking_harshness <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*H,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_harshness)
precis(rethinking_harshness,depth=2)[260:262,]



dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


```



  &nbsp;
  
**R3.3 Population Density**

Effect sizes are larger in species with higher population densities (metafor +0.04 - +0.08, rethinking +0.05 - +0.10; n=346 effect sizes), even when including phylogenetic relatedness.


```{r ranksuccess_density, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

densitydat<-dat[is.na(dat$PopulationDensity)==F,]
densitydat$PopulationDensity<-standardize(densitydat$PopulationDensity)


meta_density <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ PopulationDensity, data=densitydat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_density

metafor_phylogenetic_density <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~PopulationDensity,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=densitydat)
metafor_phylogenetic_density



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

densitydat<-dat[is.na(dat$PopulationDensity)==F,]

dat_list_density <- list(
  N_spp = nrow(densitydat),
  Z_obs = densitydat$Fishers_Z_r,
  Z_sd = densitydat$Variance, 
  P = standardize(densitydat$PopulationDensity)
)

#We run the model
rethinking_density <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*P,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_density)
precis(rethinking_density,depth=2)[346:348,]



dat_list_phylogenetic_density <- list(
  N_spp = nrow(densitydat),
  Z_obs = densitydat$Fishers_Z_r,
  Z_sd = densitydat$Variance, 
  P = standardize(densitydat$PopulationDensity)
)

dat_list_phylogenetic_density$Dmat<-Dmat[ densitydat$Latin,densitydat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_density <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b*P,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_density)
precis(rethinking_phylogenetic_gaussian_density)


```




  &nbsp;

#### **4) What are the social circumstances that mediate the benefits of rank?**

  &nbsp;
  
**R4.1 Breeding system**

Effect sizes of cooperative breeders (average 0.58; n=52 effect sizes) are higher than those observed in plural (average 0.25; n=324 effect sizes) or associated breeders (average 0.23; n=68 effect sizes) (estimates for difference cooperative breeder vs plural breeder metafor -0.40 - -0.30, rethinking -0.41 - -0.27; cooperative breeder vs associated breeder metafor -0.47 - -0.35, rethinking -0.45 - -0.26; plural breeder vs associated breeder metafor -0.07 - +0.05, rethinking -0.07 - +0.05). Cooperative breeders are still estimated to have higher effect sizes than species with other breeding systems when accounting for phylogenetic relatedness, but the differences are slightly reduced (Figure 5).


```{r ranksuccess_breedingsystem, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_breedingsystem <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ as.factor(BreedingSystem), data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_breedingsystem

metafor_phylogenetic_breedingsystem <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~BreedingSystem,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_breedingsystem



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_breedingsystem <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  B = dat$BreedingSystem
)

#We run the model
rethinking_breedingsystem <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[B],
    a~normal(0,1),
    b[B]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_breedingsystem)
precis(rethinking_breedingsystem,depth=2)[445:448,]
posterior<-extract.samples(rethinking_breedingsystem)
difference_breedingsystem<-posterior$b[,2]-posterior$b[,1]
precis(difference_breedingsystem)


dat_list_phylogenetic_breedingsystem <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  B = dat$BreedingSystem
)

dat_list_phylogenetic_breedingsystem$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_breedingsystem <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[B],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[B]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_breedingsystem)
precis(rethinking_phylogenetic_gaussian_breedingsystem,depth=2)[445:448,]
posterior<-extract.samples(rethinking_phylogenetic_gaussian_breedingsystem)
difference_breedingsystem<-posterior$b[,2]-posterior$b[,1]
precis(difference_breedingsystem)


```

  &nbsp;

**R4.2 Dominance System**

Effect sizes are higher in species in which condition plays a major role in determining which females are dominant rather than subordinate (average effect size 0.38; n=94 effect sizes), compared to species in which age (average effect size 0.31; n=100 effect sizes) or nepotism (average effect size 0.24; n=243 effect sizes) influence dominance rank (estimates for difference condition vs age: metafor +0.05 - +0.17, rethinking +0.01 - +0.16; condition vs nepotism: metafor +0.07 - +0.20, rethinking +0.08 - +0.20; age vs nepotism: metafor -0.07 - +0.03, rethinking -0.01 - +0.12). Species with different dominance system are no longer estimated to be different when including the phylogenetic similarity.

We had initially planned to assess whether dominance effect appear across different time scales depending on how dominant females acquire their position. However, this turned out to be more difficult. The species in our dataset have vastly varying lifespans, so simply assessing the number of years a study had been conducted for skews the observation towards short-lived species. The values for the relative duration (number of years studied divided by the maximum lifespan of the species) show that 90% of effect sizes are from studies that lasted less than 10% of the lifespan of the species (median 3%). In all of the 19 species in which studies spanned more than 10% of the lifespan, females acquire rank by nepotism. We did not find any consistent pattern of relationship between effect size and study duration dependent on the system of dominance acquisition.  


```{r ranksuccess_dominancesystem, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_associatedbreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ DominanceSystem, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_associatedbreeding

metafor_phylogenetic_associatedbreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~DominanceSystem,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_associatedbreeding



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

dominancedat<-dat[is.na(dat$DominanceSystem)==F,]

dat_list_dominance <- list(
  N_spp = nrow(dominancedat),
  Z_obs = dominancedat$Fishers_Z_r,
  Z_sd = dominancedat$Variance, 
  D = as.integer(as.factor(dominancedat$DominanceSystem))
)

#We run the model
rethinking_dominance <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_dominance)
precis(rethinking_dominance,depth=2)[438:442,]
posterior<-extract.samples(rethinking_dominance)
difference_dominance<-posterior$b[,2]-posterior$b[,1]
precis(difference_dominance)


dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)


dominancedat<-dat[is.na(dat$DominanceSystem)==F,]
dominancedat_years<-dominancedat[dominancedat$CooperativeBreeding==0,]
dominancedat_years<-dominancedat_years[is.na(dominancedat_years$MaximumLifespan)==F,]

dominancedat_years$relativeduration<-dominancedat_years$No_of_years/(10^(dominancedat_years$MaximumLifespan))

dat_list_dominance <- list(
  N_spp = nrow(dominancedat_years),
  Z_obs = dominancedat_years$Fishers_Z_r,
  Z_sd = dominancedat_years$Variance, 
  D = as.integer(as.factor(dominancedat_years$DominanceSystem)),
  Y = standardize(dominancedat_years$relativeduration)
)

rethinking_dominance_years <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D]*Y,
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_dominance)
precis(rethinking_dominance_years,depth=2)[304:308,]

```

  &nbsp;

**R4.3 Philopatry**

The effects of dominance rank on reproductive success are higher in species in which females disperse and join new groups (average effect size 0.46; n=55 effect sizes) compared to species in which most females were born in the same group they breed (average effect size 0.26; n=360 effect sizes) (metafor estimate of difference -0.24 - -0.12, rethinking estimate -0.25 - -0.11), also when accounting for phylogenetic covariance (Figure 6).

---

![](ranksuccess_Fig6_effectsize_philopatry.png)
**Figure 6.** Effect sizes of dominance rank on female reproductive success are lower in species in which which females are philopatric and remain in the group/area where they have been born (top, blue dots) than in species in which females disperse to breed (bottom, grey dots).

---


```{r ranksuccess_philopatry, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_philopatry <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ Philopatry, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_philopatry

metafor_phylogenetic_philopatry <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~Philopatry,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_philopatry



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

philopatrydat<-dat[is.na(dat$Philopatry)==F,]

dat_list_philopatry <- list(
  N_spp = nrow(philopatrydat),
  Z_obs = philopatrydat$Fishers_Z_r,
  Z_sd = philopatrydat$Variance, 
  D = as.integer(as.factor(philopatrydat$Philopatry))
)

#We run the model
rethinking_philopatry <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_philopatry)
precis(rethinking_philopatry,depth=2)[416:419,]
posterior<-extract.samples(rethinking_philopatry)
difference_philopatry<-posterior$b[,2]-posterior$b[,1]
precis(difference_philopatry)


dat_list_phylogenetic_associatedbreeding <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  P = dat$AssociatedBreeding+1
)

dat_list_phylogenetic_associatedbreeding$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_associatedbreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[P],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[P]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_associatedbreeding)
precis(rethinking_phylogenetic_gaussian_associatedbreeding)



meta_philopatry <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ factor(Philopatry)-1, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))


orchard_plot_philopatry <- function(object, mod = "Int", xlab, N = "none", alpha = 0.5, angle = 90, cb = TRUE, k = TRUE, transfm = c("none", "tanh")) {
 ## evaluate choices
  transfm <- match.arg(transfm) # if not sepcificed it takes the first choice
	if(any(class(object) %in% c("rma.mv", "rma.uni", "rma"))){
		if(mod != "Int"){
			object <- mod_results(object, mod)
		} else{
			object <- mod_results(object, mod = "Int")
			}
	}
	mod_table <- object$mod_table
  data <- object$data
  data$moderator <- factor(data$moderator, levels = mod_table$name, labels = mod_table$name)
	data$scale <- (1/sqrt(data[,"vi"]))
	legend <- "Precision (1/SE)"
	if(any(N != "none")){
		  data$scale <- N
		  legend <- "Sample Size (N)"
	}
	if(transfm == "tanh"){
		                   cols <- sapply(mod_table, is.numeric)
		mod_table[,cols] <- Zr_to_r(mod_table[,cols])
		                data$yi <- Zr_to_r(data$yi)
		                  label <- xlab
	}else{
		label <- xlab
	}
	 mod_table$K <- as.vector(by(data, data[,"moderator"], function(x) length(x[,"yi"])))
	 # the number of groups in a moderator & data points
	 group_no <- nrow(mod_table)
	 #data_no <- nrow(data)

	# colour blind friendly colours with grey
cbpl <- c("#D55E00","#E69F00","#009E73",   "#CC79A7", "#56B4E9", "#F0E442", "#999999")

	# Make the orchard plot
  plot <- ggplot2::ggplot(data = mod_table, aes(x = estimate, y = name)) +
    # pieces of fruit (bee-swarm and bubbles)
    ggbeeswarm::geom_quasirandom(data = data, aes(x = yi, y = moderator, size = scale, colour = moderator), groupOnX = FALSE, alpha=alpha) +
    # 95 %prediction interval (PI): twigs
    ggplot2::geom_errorbarh(aes(xmin = lowerPR, xmax = upperPR),  height = 0, show.legend = FALSE, size = 0.5, alpha = 0.6) +
    # 95 %CI: branches
    ggplot2::geom_errorbarh(aes(xmin = lowerCL, xmax = upperCL),  height = 0, show.legend = FALSE, size = 1.2) +
    ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "black", alpha = alpha) +
    # creating dots for truncks
    ggplot2::geom_point(aes(fill = name), size = 3, shape = 21) +
    # putting labels
    #ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
    #                 label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5) +
    ggplot2::theme_bw() +
    ggplot2::guides(fill = "none", colour = "none") +
    ggplot2::theme(legend.position= c(1, 0), legend.justification = c(1, 0)) +
    ggplot2::theme(legend.title = element_text(size = 11)) +
    ggplot2::theme(legend.direction="horizontal") +
    ggplot2::theme(legend.background = element_blank()) +
    ggplot2::labs(x = label, y = "", size = legend) +
    ggplot2::theme(axis.text.y = element_text(size = 18, colour ="black",
                                              hjust = 0.5,
                                              angle = angle)) +
    ggplot2::theme(axis.text.x = element_text(size = 14, colour ="black",
                                              hjust = 0.5,
                                              angle = 0)) + 
    ggplot2::theme(axis.title.x = element_text(size = 18, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 0)) +
    ggplot2::theme(axis.title.y = element_text(size = 18, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = angle)) 
	  # putting colours in
	  if(cb == TRUE){
	    plot <- plot +
	      scale_fill_manual(values=cbpl) +
	      scale_colour_manual(values=cbpl)
	  }
				     # putting k in
          if(k == TRUE){
                plot <- plot +
                  ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
                  label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5)
          }
	  return(plot)
}

s



orchard_plot_philopatry(meta_philopatry,mod = "FemalePhilopatry", xlab="Effect size (Fisher's Z r)",cb=FALSE)+ theme(axis.text.y = element_text(size=8))+scale_y_discrete(labels=c("Factor(Philopatry)FemaleDispersal"="Female dispersal","Factor(Philopatry)"="Female philopatry"))+
	      scale_fill_manual(values=c("grey20","blue")) +
	      scale_colour_manual(values=c("grey20","blue"))+
        theme(axis.text = element_text(size = 24, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 90))+
        theme(axis.text.y = element_text(size = 15, colour ="black",
                                              hjust = -0.5,
                                              vjust = 0.5,
                                              angle = 0))

```

  &nbsp;

**R4.4 Group size**

Both approaches detect a negative association between the effect sizes and group sizes (metafor estimate of log group size -0.099 - -0.678, rethinking estimate of standardized group size -0.10 - -0.05; n=444 effect sizes). Compared to groups of 2 females, groups of 10 females show ~10% lower effect sizes and groups of ~50 females show 50% lower effect sizes. The negative association between group size and the effect sizes remains when accounting for similarity among closely related species.


```{r ranksuccess_groupsize, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_groupsize <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ GroupSize, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_groupsize

metafor_phylogenetic_groupsize <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~GroupSize,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_groupsize



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 
dat_list_groupsize <- list(
  N_spp = nrow(dat),
  Fishers_Z_r = dat$Fishers_Z_r,
  Variance = dat$Variance, 
  GroupSize_s = standardize(dat$GroupSize)
)

dat$GroupSize_s<-standardize(dat$GroupSize)

#We run the model
rethinking_groupsize <- ulam(
  alist(
    Fishers_Z_r ~dnorm ( Z_true , Variance),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+bG*GroupSize_s,
    a~normal(0,1),
    bG~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_groupsize)
precis(rethinking_groupsize)


#calculate and plot values at the minimum group size, 2,10,50,100 females, and the maximum group size
groupsize.seq <-  c(-1,-0.84895,-0.415,1.753,4.4635,8)
pred_dat <- list( GroupSize_s = groupsize.seq)
mu <- link( rethinking_groupsize , data=pred_dat )
mu.mean <- apply( mu , 2 , mean )
mu.PI <- apply( mu , 2 , PI , prob=0.89 )
plot( Fishers_Z_r ~ G , dat , col=col.alpha(rangi2,0.5) ,xaxt="n")
at <- c(-0.84895,-0.415,1.753,4.4635)
labels <- at*sd(dat$GroupSize) + mean(dat$GroupSize)
axis( side=1 , at=at , labels=round(labels,1) )
lines( groupsize.seq , mu.mean )
shade( mu.PI , groupsize.seq )







dat_list_phylogenetic_groupsize <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  G = standardize(standardize(log(dat$GroupSize)))
)

dat_list_phylogenetic_groupsize$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_groupsize <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+bG*G,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bG~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_groupsize)
precis(rethinking_phylogenetic_gaussian_groupsize)

#To check the phylogenetic signal, we plot the estimate covariance(similarity) in effect sizes as species are more distantly related
#A phylogenetic signal in the plot would be shown by high covariances among species that have small phylogenetic distances and declining covariances as phylogenetic distance increases
#For the simulated dataset, most of the estimates show a covariance of 0, and no change as phylogenetic distance increases
post<-extract.samples(rethinking_phylogenetic_gaussian)
plot(NULL,xlim=c(0,max(dat_list$Dmat)),ylim=c(0,1.5),xlab="phylogenetic distance",ylab="covariance")
for (i in 1:50) curve(post$etasq[i]*exp(-post$rhosq[i]*x^2),add=TRUE,col=grau())


```

  &nbsp;

**R4.5 Average Relatedness**

Effect sizes of dominance rank on reproductive success increase with increasing levels of average relatedness among female group members (metafor estimate +0.31 - +0.59, rethinking estimate +0.31 - +0.71; n=288 effect sizes), though the association is no longer detected when including the shared phylogenetic history among species (metafor estimate -0.01 - +0.56; rethinking estimate -0.02 - +0.65).


```{r ranksuccess_relatedness, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_relatedness <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ AverageRelatedness, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_relatedness

metafor_phylogenetic_relatedness <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~AverageRelatedness,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_relatedness



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

relatednessdat<-dat[is.na(dat$AverageRelatedness)==F,]

dat_list_relatedness <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness)
)

#We run the model
rethinking_relatedness <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*R,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_relatedness)
precis(rethinking_relatedness)


dat_list_phylogenetic_relatedness <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness)
)

dat_list_phylogenetic_relatedness$Dmat<-Dmat[relatednessdat$Latin,relatednessdat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_relatedness <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b*R,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_relatedness)
precis(rethinking_phylogenetic_gaussian_relatedness)


```

  &nbsp;

**R4.6 Variance in relatedness**

We could not assess this prediction because sufficient data was not available.

  &nbsp;

**R4.7 Coalition formation**

Species in which females form coalitions show only slightly lower effects of dominance rank on reproductive success (average 0.27; n=246 effect sizes) than species in which females do not have support during aggressive interactions (average 0.32; n=180 effect sizes) (estimate of difference metafor: -0.11 - -0.01, rethinking -0.09 - +0.01), with no difference in models accounting for similarity due to phylogenetic relatedness (metafor -0.10 - +0.07; rethinking -0.09 - +0.03).


```{r ranksuccess_coalition, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_coalition <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CoalitionFormation, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_coalition

metafor_phylogenetic_coalition <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CoalitionFormation,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_coalition



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

coalitiondat<-dat[is.na(dat$CoalitionFormation)==F,]

dat_list_coalition <- list(
  N_spp = nrow(coalitiondat),
  Z_obs = coalitiondat$Fishers_Z_r,
  Z_sd = coalitiondat$Variance, 
  C = as.integer(as.factor(coalitiondat$CoalitionFormation))
)

#We run the model
rethinking_coalition <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[C],
    a~normal(0,1),
    b[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_coalition)
precis(rethinking_coalition,depth=2)[427:430,]
posterior<-extract.samples(rethinking_coalition)
difference_coalition<-posterior$b[,2]-posterior$b[,1]
precis(difference_coalition)

dat_list_phylogenetic_coalition <- list(
  N_spp = nrow(coalitiondat),
  Z_obs = coalitiondat$Fishers_Z_r,
  Z_sd = coalitiondat$Variance, 
  C = as.integer(as.factor(coalitiondat$CoalitionFormation))
)

dat_list_phylogenetic_coalition$Dmat<-Dmat[coalitiondat$Latin,coalitiondat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_coalition <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[C],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_coalition)
precis(rethinking_phylogenetic_gaussian_coalition)


```

  &nbsp;

**R4.8 Intersexual conflict**

Effect sizes are larger in species in which sex ratios in social groups are more balanced and lower when there are fewer males per female (metafor estimate +0.55 - +1.25, rethinking estimate +0.07 - +0.11; n=328 effect sizes), and the association remains the same when accounting for shared phylogenetic history.

Effect sizes are lower in species in which males commit infanticide (metafor estimate -0.20 - 0.00; rethinking estimate -0.15 - -0.04; n=332 effect sizes), but the relationship does not hold when accounting for phylogenetic relatedness (metafor -0.13 - +0.07, rethinking -0.07 - +0.06).

Differences in effect sizes are not associated with the extent of sexual dimorphism in body size across species (metafor estimate -0.17 - 0.11; rethinking -0.05 - +0.01; similar estimates when accounting for sharerd phylogenetic history; n=334 effect sizes).


```{r ranksuccess_sexualconflict, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_sexratio <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ sexratio_socialgroup, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_sexratio

metafor_phylogenetic_sexratio <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~sexratio_socialgroup,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_sexratio



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

sexratiodat<-dat[is.na(dat$sexratio_socialgroup)==F,]

dat_list_sexratio <- list(
  N_spp = nrow(sexratiodat),
  Z_obs = sexratiodat$Fishers_Z_r,
  Z_sd = sexratiodat$Variance, 
  S = standardize(sexratiodat$sexratio_socialgroup)
)

#We run the model
rethinking_sexratio <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*S,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_sexratio)
precis(rethinking_sexratio)


dat_list_phylogenetic_sexratio <- list(
  N_spp = nrow(sexratiodat),
  Z_obs = sexratiodat$Fishers_Z_r,
  Z_sd = sexratiodat$Variance, 
  S = standardize(sexratiodat$sexratio_socialgroup)
)

dat_list_phylogenetic_sexratio$Dmat<-Dmat[sexratiodat$Latin,sexratiodat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_sexratio <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b*S,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_sexratio)
precis(rethinking_phylogenetic_gaussian_sexratio)



################################################################################################

# Infanticide

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_infanticide <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ maleinfanticide, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_infanticide

metafor_phylogenetic_infanticide <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~maleinfanticide,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_infanticide



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

infanticidedat<-dat[is.na(dat$maleinfanticide)==F,]

dat_list_infanticide <- list(
  N_spp = nrow(infanticidedat),
  Z_obs = infanticidedat$Fishers_Z_r,
  Z_sd = infanticidedat$Variance, 
  M = as.integer(as.factor(infanticidedat$maleinfanticide))
)

#We run the model
rethinking_infanticide <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[M],
    a~normal(0,1),
    b[M]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_infanticide)
precis(rethinking_infanticide,depth=2)[427:430,]
posterior<-extract.samples(rethinking_infanticide)
difference_infanticide<-posterior$b[,2]-posterior$b[,1]
precis(difference_infanticide)

dat_list_phylogenetic_infanticide <- list(
  N_spp = nrow(infanticidedat),
  Z_obs = infanticidedat$Fishers_Z_r,
  Z_sd = infanticidedat$Variance, 
  M = as.integer(as.factor(infanticidedat$maleinfanticide))
)

dat_list_phylogenetic_infanticide$Dmat<-Dmat[infanticidedat$Latin,infanticidedat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_infanticide <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b[M],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[M]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_infanticide)
precis(rethinking_phylogenetic_gaussian_infanticide)

posterior<-extract.samples(rethinking_phylogenetic_gaussian_infanticide)
difference_phylo_infanticide<-posterior$b[,2]-posterior$b[,1]
precis(difference_phylo_infanticide)

################################################################################################

# Sexual dimorphism

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_sexualdimorphism <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ SexualDimorphism_Weight, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_sexualdimorphism

metafor_phylogenetic_sexualdimorphism <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~SexualDimorphism_Weight,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_sexualdimorphism



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

sexualdimorphismdat<-dat[is.na(dat$SexualDimorphism_Weight)==F,]

dat_list_sexualdimorphism <- list(
  N_spp = nrow(sexualdimorphismdat),
  Z_obs = sexualdimorphismdat$Fishers_Z_r,
  Z_sd = sexualdimorphismdat$Variance, 
  S = standardize(sexualdimorphismdat$SexualDimorphism_Weight)
)

#We run the model
rethinking_sexualdimorphism <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b*S,
    a~normal(0,1),
    b~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_sexualdimorphism)
precis(rethinking_sexualdimorphism)


dat_list_phylogenetic_sexualdimorphism <- list(
  N_spp = nrow(sexualdimorphismdat),
  Z_obs = sexualdimorphismdat$Fishers_Z_r,
  Z_sd = sexualdimorphismdat$Variance, 
  S = standardize(sexualdimorphismdat$SexualDimorphism_Weight)
)

dat_list_phylogenetic_sexualdimorphism$Dmat<-Dmat[sexualdimorphismdat$Latin,sexualdimorphismdat$Latin ]/max(Dmat)
rethinking_phylogenetic_gaussian_sexualdimorphism <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a+b*S,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list_phylogenetic_sexualdimorphism)
precis(rethinking_phylogenetic_gaussian_sexualdimorphism)





```


**R4.9 Macaque dominance styles**

Differences in dominance styles among macaques are not associated with the effect of dominance rank on reproductive success (metafor estimates effect sizes of species in Grade 1 to be different from species in Grade 2 +0.05 - +0.12 but no differences for the five other pairwise Grade comparisons; rethinking estimates for all comparisons overlap zero; n = 109 effect sizes from 9 species). Egalitarian species do not show lower effects of dominance rank on reproductive success than other species and the sample size is too small to determine whether despotic species systematically differ from other species (Figure 7). 

---

![](ranksuccess_Fig9_effectsizes_macaquedominancestyles.png)
**Figure 7.** The effect of dominance rank on female reproductive success is similar across macaque species with different dominance styles. Relationships among female group members in species of grade 1 (bottom dark grey) are generally considered egalitarian, while grade 4 (top light grey) is assigned to species in which relationships are deemed highly despotic. Species with different dominance styles are not estimated to be different (all posterior contrasts overlap zero).

---

```{r ranksuccess_macaquedominance, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}


macaquespecies<-unique(dat$Latin)[grep("Macaca",unique(dat$Latin))]
macaquedominancestyles<-as.data.frame(c("Grade3","Grade1","Grade1","Grade3","Grade2","Grade3","Grade3","Grade2","Grade4") )
colnames(macaquedominancestyles)<-"dominancestyle"
macaquedominancestyles$Latin<-macaquespecies
macaquedata<-dat[dat$Latin %in% macaquespecies,]
macaquedata<-left_join(macaquedata,macaquedominancestyles,by="Latin")


dat_list_macaques <- list(
  N_spp = nrow(macaquedata),
  Z_obs = macaquedata$Fishers_Z_r,
  Z_sd = macaquedata$Variance, 
  D = as.integer(as.factor(macaquedata$dominancestyle))
)

#We run the model
rethinking_macaques <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[D],
    a~normal(0,1),
    b[D]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_macaques)
precis(rethinking_macaques,depth=2)[110:115,]
posterior<-extract.samples(rethinking_macaques)
difference_macaques<-posterior$b[,2]-posterior$b[,1]
precis(difference_macaques)
difference_macaques<-posterior$b[,3]-posterior$b[,1]
precis(difference_macaques)
difference_macaques<-posterior$b[,4]-posterior$b[,1]
precis(difference_macaques)
difference_macaques<-posterior$b[,3]-posterior$b[,2]
precis(difference_macaques)
difference_macaques<-posterior$b[,4]-posterior$b[,2]
precis(difference_macaques)
difference_macaques<-posterior$b[,4]-posterior$b[,3]
precis(difference_macaques)

meta_macaques <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ factor(dominancestyle)-1, data=macaquedata, method="REML")

orchard_plot_macaques <- function(object, mod = "Int", xlab, N = "none", alpha = 0.5, angle = 90, cb = TRUE, k = TRUE, transfm = c("none", "tanh")) {
 ## evaluate choices
  transfm <- match.arg(transfm) # if not sepcificed it takes the first choice
	if(any(class(object) %in% c("rma.mv", "rma.uni", "rma"))){
		if(mod != "Int"){
			object <- mod_results(object, mod)
		} else{
			object <- mod_results(object, mod = "Int")
			}
	}
	mod_table <- object$mod_table
  data <- object$data
  data$moderator <- factor(data$moderator, levels = mod_table$name, labels = mod_table$name)
	data$scale <- (1/sqrt(data[,"vi"]))
	legend <- "Precision (1/SE)"
	if(any(N != "none")){
		  data$scale <- N
		  legend <- "Sample Size (N)"
	}
	if(transfm == "tanh"){
		                   cols <- sapply(mod_table, is.numeric)
		mod_table[,cols] <- Zr_to_r(mod_table[,cols])
		                data$yi <- Zr_to_r(data$yi)
		                  label <- xlab
	}else{
		label <- xlab
	}
	 mod_table$K <- as.vector(by(data, data[,"moderator"], function(x) length(x[,"yi"])))
	 # the number of groups in a moderator & data points
	 group_no <- nrow(mod_table)
	 #data_no <- nrow(data)

	# colour blind friendly colours with grey
cbpl <- c("#D55E00","#E69F00","#009E73",   "#CC79A7", "#56B4E9", "#F0E442", "#999999")

	# Make the orchard plot
  plot <- ggplot2::ggplot(data = mod_table, aes(x = estimate, y = name)) +
    # pieces of fruit (bee-swarm and bubbles)
    ggbeeswarm::geom_quasirandom(data = data, aes(x = yi, y = moderator, size = scale, colour = moderator), groupOnX = FALSE, alpha=alpha) +
    # 95 %prediction interval (PI): twigs
    ggplot2::geom_errorbarh(aes(xmin = lowerPR, xmax = upperPR),  height = 0, show.legend = FALSE, size = 0.5, alpha = 0.6) +
    # 95 %CI: branches
    ggplot2::geom_errorbarh(aes(xmin = lowerCL, xmax = upperCL),  height = 0, show.legend = FALSE, size = 1.2) +
    ggplot2::geom_vline(xintercept = 0, linetype = 2, colour = "black", alpha = alpha) +
    # creating dots for truncks
    ggplot2::geom_point(aes(fill = name), size = 3, shape = 21) +
    # putting labels
    #ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
    #                 label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5) +
    ggplot2::theme_bw() +
    ggplot2::guides(fill = "none", colour = "none") +
    ggplot2::theme(legend.position= c(1, 0), legend.justification = c(1, 0)) +
    ggplot2::theme(legend.title = element_text(size = 11)) +
    ggplot2::theme(legend.direction="horizontal") +
    ggplot2::theme(legend.background = element_blank()) +
    ggplot2::labs(x = label, y = "", size = legend) +
    ggplot2::theme(axis.text.y = element_text(size = 18, colour ="black",
                                              hjust = 0.5,
                                              angle = angle)) +
    ggplot2::theme(axis.text.x = element_text(size = 14, colour ="black",
                                              hjust = 0.5,
                                              angle = 0)) + 
    ggplot2::theme(axis.title.x = element_text(size = 18, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 0)) 
	  # putting colours in
	  if(cb == TRUE){
	    plot <- plot +
	      scale_fill_manual(values=cbpl) +
	      scale_colour_manual(values=cbpl)
	  }
				     # putting k in
          if(k == TRUE){
                plot <- plot +
                  ggplot2::annotate('text', x = (max(data$yi) + (max(data$yi)*0.10)), y = (seq(1, group_no, 1)+0.3),
                  label= paste("italic(k)==", mod_table$K), parse = TRUE, hjust = "right", size = 3.5)
          }
	  return(plot)
}



orchard_plot_macaques(meta_macaques,mod = "dominancestyle", xlab="Effect size (Fisher's r)",cb=FALSE)+ theme(axis.text.y = element_text(size=8))+scale_y_discrete(labels=c("Grade1","Grade2","Grade3","Grade4"))+
	      scale_fill_manual(values=c("grey10","grey35","grey60","grey90")) +
	      scale_colour_manual(values=c("grey10","grey35","grey60","grey90"))+
        theme(axis.text = element_text(size = 24, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 90))+
        theme(axis.text = element_text(size = 24, colour ="black", face = "bold",
                                              hjust = 0.5,
                                              vjust = -0.5,
                                              angle = 90))+
        theme(axis.text.y = element_text(size = 15, colour ="black",
                                              hjust = -0.5, 
                                              vjust = 0.5,
                                              angle = 0))


```


  &nbsp;

  &nbsp;


#### **Summary of univariate analyses**
\
Overall, our data indicate that females of higher rank generally have higher reproductive success than females of lower rank. In terms of the approach, effect sizes of dominance rank on reproductive success were higher (i) when individuals were assigned a rank category rather than a continuous position, (ii) when rank was determined using indirect measures rather than aggressive interactions, and (iii) in some studies, species, and families of species than in others. We found no differences in effect sizes when studies were conducted in a captive rather than a wild setting. Effect sizes of dominance rank were higher for measures of reproductive output than for measures of survival, and higher for measures of maternal than offspring fitness.

We found that effect sizes of dominance rank on reproductive success are associated with six of our single predictor variables, whereas we did not find an association with another eight of the single predictor variables (Table 1). Five of the six associated predictor variables reflect variation in the social environment, while we did not find any association with any of the predictor variables reflecting the ecological environment.

```{r table1, eval=TRUE, warning=FALSE, results='asis', echo=FALSE}
options(width=60)

predictorvariable_associated<-c("litters per year","population density","group size","cooperative breeding","philopatry","sex ratio")
metaforresults_associated<-c("+0.03 - +0.05","+0.04 - +0.08","-0.07 - -0.01","+0.30 - +0.40","-0.24 - -0.12","+0.44 - +1.25")
rethinkingresults_associated<-c("+0.05 - +0.09","+0.05 - +0.10","-0.10 - -0.05","+0.27 - +0.41","-0.25 - -0.11","+0.07 - +0.11")

d_associated <- data.frame(predictorvariable_associated,metaforresults_associated,rethinkingresults_associated)

colnames(d_associated)<-c("Predictor variable","Metafor 95% confidence interval of estimate of association","Rethinking 89% posterior compatibility estimate of association")


predictorvariable_notassociated<-c("litter size","dominance acquisition","diet","environmental harshness","average relatedness","female coalitions","male infanticide","sexual dimorphism")
metaforresults_notassociated<-c("-0.01 - +0.03","-0.07 - +0.03","-0.04 - +0.03","-0.30 - +0.40","-0.01 - +0.56","-0.10 - +0.07","-0.13 - +0.07","-0.17 - +0.11")
rethinkingresults_notassociated<-c("-0.04 - +0.09","-0.01 - +0.12","-0.10 - +0.06","-0.60 - +0.10","-0.01 - +0.12","-0.09 - +0.07","-0.07 - +0.06","-0.05 - +0.01")

d_notassociated <- data.frame(predictorvariable_notassociated,metaforresults_notassociated,rethinkingresults_notassociated)

colnames(d_notassociated)<-c("Predictor variable","Metafor 95% confidence interval of estimate of association","Rethinking 89% posterior compatibility estimate of association")

```

---

**Table 1.** Overview of **variables for which we found an association with variation in effect sizes of dominance rank on female reproductive success** in univariate analyses. The following six variables (of the fourteen we assessed) are estimated to explain variation in the effect sizes with both approaches when accounting for shared phylogenetic history among the species in our sample.
```{r table_associated, eval=TRUE, warning=FALSE, results='asis', echo=FALSE, include=TRUE}
library(kableExtra)
knitr::kable(d_associated) %>%
kable_styling(full_width = T, position = "left")
```


**Table 2.** Overview of **variables for which we did not find an association with variation in effect sizes of dominance rank on female reproductive success** in univariate analyses. The following eight variables (of the fourteen we assessed) are estimated to not be linked with variation in the effect sizes when accounting for shared phylogenetic history among the species in our sample.  
```{r table_notassociated, eval=TRUE, warning=FALSE, results='asis', echo=FALSE, include=TRUE}
library(kableExtra)
knitr::kable(d_notassociated) %>%
kable_styling(full_width = T, position = "left")
```


  &nbsp;
  

  &nbsp;
  
#### **5) Combined analyses**

  &nbsp;
  
**R5.1 Heterogeneity and sample bias**

The sample bias, namely the over-representation of extreme effect sizes, in our data likely results from all three influences of (i) publication bias, (ii) study system bias, and (iii) study time bias. In addition to the direct indications of publication and study system bias in our sample, our univariate analyses identified many factors that could lead to study system bias. For example, while less than 5% of all mammalian species are cooperative breeders, 12% of all effect sizes in our sample come from cooperative breeders which have high positive effect sizes. 

To identify the potential interplay between the three biases, we built combined models. If biases occur because study systems with different effect sizes also have particular sample sizes and study duration (e.g. cooperative breeders tend to live in smaller groups), we should no longer detect an association between sample size and study duration with the effect sizes when controlling for the different study systems. The combined models indicate that the study system factors identified in the uni-variate analyses are directly associated with variation in effect sizes (all their estimates do not overlap zero), as is sample size, but not the number of years a study had been conducted for. This indicates that our sample has both publication and study system bias. The lack of a direct influence of study time bias presumably occurs because sample size is associated with the number of years a study has been conducted for, indicating that large samples both in terms of time period or breadth might reduce noise. 

The reduction in publication bias when accounting for the study system bias is visible when comparing the funnel plot of the raw effect sizes in relation to their precision (Figure 8a), which shows a clear asymmetry, to the funnel plot of the effect sizes adjusted for known predictors (Figure 8b), which only indicates some large effect sizes at small precision that are not balanced.

---

![](ranksuccess_Fig7_effectsize_funnelplot.png)
**Figure 8.** Funnel plots based on raw effect sizes (a) and effect sizes adjusted for known predictors (b). When accounting for the influence of which reproductive trait was measured, whether the species is a cooperative breeder or not, the number of litters per year the species produces, and the phylogenetic covariance among species, the distribution of the 444 effect sizes in our sample appears much less imbalanced (b) than the raw effect sizes (a). The mean effect size (grey dotted line in the center going upwards) is shifted close to zero when adjusting for known predictors because these predictors explain why some studies have positive effect sizes. Precision decreases for most estimates because they no longer represent the measured values but the values inferred from the interaction of the predictors.

---


```{r ranksuccess_metapublicationbias, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

dat$sei <- sqrt(dat$Variance)


publication.bias.model.sei <- rma.mv(Fishers_Z_r, Variance,
                            mod=~MeasureType_Category+LittersPerYear+CooperativeBreeding+CooperativeBreeding*GroupSize+No_of_years+sei,
                                      random=list(~ 1 | SpeciesIncluded, # phylo effect
                                                  ~ 1 | Latin, # non-phylo effect
                                                  ~ 1 | StudyRef), 
                                      R = list(SpeciesIncluded = phylo_cor), #phylogenetic relatedness
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model.sei



publication.bias.model_simple <- rma.mv(Fishers_Z_r, Variance,
                            mod=~SampleSize,
                                      random=list(~ 1 | SpeciesIncluded, # phylo effect
                                                  ~ 1 | Latin, # non-phylo effect
                                                  ~ 1 | StudyRef), 
                                      R = list(SpeciesIncluded = phylo_cor), #phylogenetic relatedness
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model_simple



publication.bias.model <- rma.mv(Fishers_Z_r, Variance,
                            mod=~MeasureType_Category+LittersPerYear+CooperativeBreeding+No_of_years+SampleSize,
                                      R = list(SpeciesIncluded = phylo_cor), #phylogenetic relatedness
                                      method="REML",
                                      test="t", # using t dist rather than z 
                                      data=dat)
publication.bias.model

metafor_phylogenetic_publication_bias <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~MeasureType_Category+LittersPerYear+CooperativeBreeding+No_of_years,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)






# Set up the dataframe to look at the influence of the sample size on the observed effect sizes
dat_list_samplesize <- list(
  N_spp = nrow(dat),
  Z_obs = abs(dat$Fishers_Z_r),
  Z_sd = dat$Variance,
  Study = as.integer(as.factor(dat$StudyRef)),
  SampleSize = standardize(dat$SampleSize),
  Y = standardize(dat$No_of_years),
  C = dat$CooperativeBreeding+1,
  M = as.integer(as.factor(dat$MeasureType_Category)),
  L = standardize(dat$LittersPerYear)
)

#We run the model assuming that the sampling variance reflects an error in the measurements of the true effect sizes

rethinking_samplesize <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+s*SampleSize,
        a~dnorm(0,1),
        s~dnorm(0,1),
        sigma_sq~dexp(1)
    ) , data=dat_list_samplesize , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)

precis(rethinking_samplesize)



rethinking_samplesize_full <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+s*SampleSize+y*Y + c[C]+m[M]+l*L,
        a~dnorm(0,1),
        s~dnorm(0,1),
        l~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1),
      ## adaptive priors
        c[C]~dnorm(0, sigma_coop),
        m[M]~dnorm(0, sigma_measure),
      ## hyper-priors
        sigma_coop ~ dexp(1),
       sigma_measure ~ dexp(1)
    ) , data=dat_list_samplesize , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)

precis(rethinking_samplesize_full)


b[B]~normal(0,0.5),

rethinking_samplesize_full <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a+s*SampleSize+y*Y + c[C]+m[M]+l*L,
        a~dnorm(0,1),
        s~dnorm(0,1),
        l~dnorm(0,1),
        y~dnorm(0,1),
        sigma_sq~dexp(1),
        c[C]~normal(0,0.5),
        m[M]~normal(0,0.5)
    ) , data=dat_list_samplesize , chains=4 , cores=4 , log_lik=TRUE ,iter=8000)


meta_simple <- rma.mv(yi=Fishers_Z_r, V=Variance, data=dat)

originalpar<-par()

op <- par(oma=c(0,2.5,0,0), mar=c(4.5,4.5,3.2,4.2), mfrow=c(1,2))
funnel(meta_simple, level=c(90, 95, 99), shade=c("white", "gray", "darkgray"), 
       yaxis="seinv",xlab="Effect size (Fisher's Zr)",ylab="precision (1/SE)",digits=c(1,0),xlim=c(-2,2),ylim=c(1,30))
mtext("a) Raw data",side=3,cex=1.5,line=1.0)
funnel(metafor_phylogenetic_publication_bias, level=c(90, 95, 99), shade=c("white", "gray", "darkgray"),yaxis="seinv",xlab="Effect size (Fisher's Zr)",ylab="precision (1/SE)",digits=c(1,0),xlim=c(-2,2),ylim=c(1,30))
mtext("b) Adjusted for known predictors",side=3,cex=1.5,line=1.0)


```

  &nbsp;
  


**R5.2 Differences between cooperative and plural/associated breeders**

In our preregistration, we had decided to first construct univariate models as reported above, testing the influence of a single variable at a time to assess support for the specific predictions. One of the main factors that we found to be associated with higher effect sizes is cooperative breeding. Cooperative breeders differ in many additional aspects, so we first checked whether any of the other associations we detect occur because they covary with cooperative breeding.

**R5.2.1 Differences in approach to study cooperative breeders**

Approaches of assigning rank depend on the breeding system of the study species, with many studies of cooperative breeders assigning rank into categories (98% categorical, 2% continuous) based on other measures (50% agonism, 50% other) while studies of plural and associated breeders often assign continuous ranks (51% categorical, 49% continuous) based on agonistic interactions (97% agonism, 3% other). Combining the variables representing the different study approaches with the variable representing the classification as cooperative breeder or not into single models indicates that the difference in effect sizes is primarily due to the stronger dominance effects in cooperative breeders (estimate of difference metafor +0.23 - +0.34, rethinking +0.23 - +0.37, n=444 effect sizes) and only very little due to the approaches the authors chose (other measure vs agonisms estimate of difference metafor +0.02 - +0.15, rethinking -0.02 - +0.16; rank categorical vs continuous estimate of difference metafor -0.02 - -0.09, rethinking -0.07 - +0.03, n=444 effect sizes). 


```{r ranksuccess_rankdetermined_cooperativebreeding, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

# Percentage of plural/associated breeders in which rank is classified categorical rather than continuous
(dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] / ( (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] + (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [2,2] )
# Percentage of cooperative breeders in which rank is classified categorical rather than continuous
(dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(CooperativeBreeding)) ) [1,2] / ( (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(CooperativeBreeding)) ) [1,2] + (dat %>% group_by(Rank_Cont_Cat) %>% summarize(sum(CooperativeBreeding)) ) [2,2] )

# Percentage of plural/associated breeders in which rank is classified through agonism rather than another measure
(dat %>% group_by(RankDetermined) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] / ( (dat %>% group_by(RankDetermined) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [1,2] + (dat %>% group_by(RankDetermined) %>% summarize(sum(AssociatedBreeding,PluralBreeding)) ) [2,2] )
# Percentage of cooperative breeders in which rank is classified through agonism rather than another measure
(dat %>% group_by(RankDetermined) %>% summarize(sum(CooperativeBreeding)) ) [1,2] / ( (dat %>% group_by(RankDetermined) %>% summarize(sum(CooperativeBreeding)) ) [1,2] + (dat %>% group_by(RankDetermined) %>% summarize(sum(CooperativeBreeding)) ) [2,2] )


# Assessing whether how rank is determined (agonism vs other) remains associated with different
# effect sizes after accounting that rank is determined differently in cooperative breeders

meta_rankdetermined_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding+RankDetermined, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_rankdetermined_cooperativebreeding

metafor_phylogenetic_rankdetermined_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+RankDetermined,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_rankdetermined_cooperativebreeding


#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  C = dat$CooperativeBreeding+1,
  M = as.integer(as.factor(dat$RankDetermined))
)


rethinking_rankdetermined_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + c[C]+m[M],
    m[M] ~ dnorm(0,1),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_rankdetermined_cooperativebreeding,depth=2)[445:450,]
posterior<-extract.samples(rethinking_rankdetermined_cooperativebreeding)
difference_rankdetermined_cooperativebreeding<-posterior$m[,2]-posterior$m[,1]
precis(difference_rankdetermined_cooperativebreeding)


dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+m[M],
    m[M] ~ dnorm(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding)


# Assessing whether how rank is assigned (categorical vs continuous) remains associated with different
# effect sizes after accounting that rank is assigned categorically in cooperative breeders


meta_rankcategory_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding+Rank_Cont_Cat, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_rankcategory_cooperativebreeding

metafor_phylogenetic_rankcategory_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+Rank_Cont_Cat,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_rankcategory_cooperativebreeding


#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  C = dat$CooperativeBreeding+1,
  R = as.integer(as.factor(dat$Rank_Cont_Cat))
)

rethinking_rankcategory_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + c[C]+r[R],
    r[R] ~ dnorm(0,1),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_rankcategory_cooperativebreeding,depth=2)[445:450,]
posterior<-extract.samples(rethinking_rankcategory_cooperativebreeding)
difference_rankcategory_cooperativebreeding<-posterior$r[,2]-posterior$r[,1]
precis(difference_rankcategory_cooperativebreeding)



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+m[M],
    m[M] ~ dnorm(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_rankdetermined_cooperativebreeding)


```



**R5.2.2 Different life history measures and cooperative breeding**

In cooperative breeders, effects of dominance rank were only assessed on three of the six life history traits. We therefore performed separate analyses for cooperative and for plural/associated breeders to identify the life history traits showing specific increases in higher ranking females compared to others.

In cooperative breeders, effect sizes are higher for infant production (metafor estimate +0.49 - +0.72, rethinking estimate +0.55 - +0.69, n=43 effect sizes), and lower for infant survival (metafor +0.13 - +0.54, rethinking +0.20 - +0.61, n=7 effect sizes) and adult survival (metafor estimate +0.02 - +0.59, +0.12 - +0.73, n=2 effect sizes) (Figure 5).

In plural/associated breeders, effect sizes are (depending on the approach) highest for lifetime reproductive success (metafor estimate +0.19 - +0.29, rethinking estimate +0.33 - +0.47, n=34 effect sizes), age at first conception (metafor +0.27 - +0.36, rethinking +0.25 - +0.43, n=23 effect sizes) and interbirth interval (metafor +0.23 - +0.34, rethinking +0.25 - +0.38, n=46 effect sizes), followed by infant production (metafor +0.13 - +0.22, rethinking +0.19 - +0.27, n=155 effect sizes) and adult survival (metafor +0.14 - +0.24, rethinking +0.15 - +0.30, n=28 effect sizes), and are lowest for infant survival (metafor +0.11 - +0.20, rethinking +0.11 - +0.20, n=106 effect sizes) (Figure 5). The two methods give slightly different estimates because there is large variation among the effect sizes within each life history trait. In particular, effect sizes of dominance rank on lifetime reproductive success can be either low or high, often for the same population. For example, an experiment with house mice reported effect sizes ranging from 0.08 to 0.80, depending on the relatedness among the group members (König 1994). For mountain gorillas living in the Virungas, one study reported no effect of dominance rank on lifetime reproductive success (0.00) (Robbins et al. 2007) while another reported the highest effect size in our sample (1.33) after excluding major sources of environmental variability on reproductive success (Robbins et al. 2011). 


```{r ranksuccess_measure_interactions, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

cooperative<-dat[dat$CooperativeBreeding==1,]

meta_MeasureType_Category_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ MeasureType_Category, data=cooperative, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_MeasureType_Category_cooperativebreeding

meta_MeasureType_Category_cooperativebreeding_phylogenetic <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~MeasureType_Category,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=cooperative)
meta_MeasureType_Category_cooperativebreeding_phylogenetic


dat_list <- list(
  N_spp = nrow(cooperative),
  Z_obs = cooperative$Fishers_Z_r,
  Z_sd = cooperative$Variance, 
  M = as.integer(as.factor(cooperative$MeasureType_Category))
)

rethinking_cooperation_measures <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <-  m[M],
    m[M] ~ dnorm(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_cooperation_measures,depth=2)[53:57,]

plot(precis( rethinking_cooperation_measures , depth=2 , pars="m" ))



notcooperative<-dat[dat$CooperativeBreeding==0,]

meta_MeasureType_Category_notcooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ MeasureType_Category, data=notcooperative, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_MeasureType_Category_notcooperativebreeding

meta_MeasureType_Category_notcooperativebreeding_phylogenetic <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~MeasureType_Category,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=notcooperative)
meta_MeasureType_Category_notcooperativebreeding_phylogenetic


dat_list <- list(
  N_spp = nrow(notcooperative),
  Z_obs = notcooperative$Fishers_Z_r,
  Z_sd = notcooperative$Variance, 
  M = as.integer(as.factor(notcooperative$MeasureType_Category))
)

rethinking_notcooperation_measures <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <-  m[M],
    m[M] ~ dnorm(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_notcooperation_measures,depth=2)[393:399,]


plot(precis( rethinking_cooperation_measures , depth=2 , pars="m" ),xlim=c(0,1))

plot(precis( rethinking_notcooperation_measures , depth=2 , pars="m" ),xlim=c(0,1))


dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_groupsize <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + bG*G*r[M],
    r[M] ~ dnorm(0,1),
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    bG~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_groupsize)
```



**R5.2.3 Litters per year and cooperative breeding**

Cooperative breeders tend to have higher reproductive rates than species with other breeding systems. However, the association between reproductive rate and effect sizes of dominance rank on reproductive success remains across all breeding systems (metafor estimate of cooperative breeding +0.22 - +0.58, litters per year 0.00 - +0.07, interaction -0.10 - +0.04), with larger effect sizes in species producing more litters per year in cooperative (rethinking estimate +0.02 - +0.20; n=52 effect sizes) and plural (rethinking +0.13 - +0.33; n=324 effect sizes), but not associated breeders (rethinking -0.08 - +0.23; n=68 effect sizes) (estimates take into account phylogenetic relatedness).


```{r ranksuccess_littersperyear_cooperativebreeding, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

# Assessing whether how rank is determined (agonism vs other) remains associated with different
# effect sizes after accounting that rank is determined differently in cooperative breeders


meta_littersperyear_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding*LittersPerYear, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_littersperyear_cooperativebreeding

metafor_phylogenetic_littersperyear_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding*LittersPerYear,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_littersperyear_cooperativebreeding






#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term

dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  B = dat$BreedingSystem,
  L = standardize(dat$LittersPerYear)
)


rethinking_littersperyear_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + b[B]*L,
    a~normal(0,1),
    b[B]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_littersperyear_cooperativebreeding,depth=2)[445:450,]



dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_littersperyear_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + b[B]*L,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    b[B]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_littersperyear_cooperativebreeding)



```


**R5.2.4 Group size and cooperative breeding**

In mammals, groups of cooperative breeders never grow to the same size (in our data, median 2 females per group, n=52) as groups of plural/associated breeders (in our data, median 14 females per group, n=392), potentially introducing an interaction effect. In our data, both group size and cooperative breeding remain independently associated with the effect sizes of dominance rank on reproductive success. The analyses suggest an interaction (metafor estimate for cooperative breeding +0.16 - +0.39, for group size -0.01 - 0.00, interaction 0.00 - +0.03, n=444 effect sizes), with effect sizes increasing with group size in cooperative breeders (rethinking estimate +0.01 - +0.02), where a single dominant continues to monopolize reproduction as groups get larger, and declining with group sizes in other breeding systems (rethinking estimate -0.01 - 0.00), where dominants might be less able to control reproduction of other group members as groups grow larger (Figure 9).

---

![](ranksuccess_Fig8_effectsize_interaction_groupsize.png)
**Figure 9.** The relationship between the number of females in the group and the effect of dominance on reproductive success depends on whether the species is a cooperative (olive dots show data and olive line with shading shows estimate from rethinking model) or a plural breeder (red dots show data and red line with shading shows estimate from rethinking model). In cooperative breeders, effect sizes increase with increasing group size as a single female continues to monopolize reproduction in the group, whereas effect sizes decrease with increasing group size as dominants can potentially no longer control other females in the group.

---


**R5.2.5 Average relatedness and cooperative breeding**

Similarly, there appears to be an interaction between average relatedness and breeding systems (metafor estimate for cooperative breeding -0.06 - +0.44, for average relatedness -0.75 - +0.03, for interaction +0.10 - +1.51, n=288 effect sizes), with effect sizes increasing with higher levels of average relatedness in cooperative breeders (rethinking estimate 0.00 - +0.12, n=36 effect sizes) and decreasing with higher levels of average relatedness in plural/associate breeders (rethinking estimate -0.06 - 0.00, n=252 effect sizes)

**R5.2.6 Philopatry and cooperative breeding**

Female dispersal is more common in cooperative breeders (46%) than in plural/associated breeders (9%). However, effect sizes are larger in species with female dispersal also just among the plural/associated breeders (rethinking estimate -0.19 - -0.02, n=363 effect sizes), though differences between philopatry and dispersal are not associated with effect sizes in cooperative breeders (rethinking estimate -0.10 - +0.12, n=52 effect sizes) (metafor estimate for cooperative breeding +0.15 - +0.49, for philopatry -0.18 - +0.06, for interaction -0.18 - +0.26). 

**R5.2.7 Coalition formation and cooperative breeding**

Coalition formation does not occur in cooperative breeders, leading to a potential confound. Restricting the analyses to plural/associated breeders, we find that effect sizes are higher in species in which females do form coalitions than in species where they do not (metafor estimate 0.00 - +0.14, rethinking estimate +0.01 - +0.11, n=374 effect sizes). This likely reflects the benefits of nepotism in matrilineal groups. For our analysis, we did not differentiate between stabilizing coalitions, which usually occur among kin to maintain matrilineal rank differences, and revolutionary coalitions, which usually occur among unrelated individuals to limit the power of others in the group.


```{r ranksuccess_social_cooperativebreeding, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

# Assessing whether there is an interaction between group size and cooperative breeding on the effect sizes

meta_groupsize_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CooperativeBreeding*GroupSize, data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_groupsize_cooperativebreeding

metafor_phylogenetic_groupsize_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding+GroupSize,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_groupsize_cooperativebreeding







dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  C = dat$CooperativeBreeding+1,
  G = standardize(dat$GroupSize)
)


rethinking_groupsize_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a + c[C]+g*G+cg[C]*G,
    a~normal(0,1),
    c[C]~normal(0,0.5),
    g~normal(0,1),
    cg[C]~normal(0,1),
    sigma_sq~dexp(1)
  ),data=dat_list)
precis(rethinking_groupsize_cooperativebreeding,depth=2)[445:450,]
posterior<-extract.samples(rethinking_groupsize_cooperativebreeding)


#calculate and plot values at the minimum group size, 2,10,50,100 females, and the maximum group size
# Do a panel plot with cooperative breeders versus plural/associated breeders
groupsize.seq <-  c(-1,-0.84895,-0.415,1.753,4.4635,8)
pred_dat <- list( G = groupsize.seq)
mu <- link( rethinking_groupsize_cooperativebreeding , data=data.frame(C = 1, G = pred_dat) )
mu.mean <- apply( mu , 2 , mean )
mu.PI <- apply( mu , 2 , PI , prob=0.89 )
standardized_groupsize<-standardize(dat$GroupSize)
plot( dat[dat$CooperativeBreeding==0,]$Fishers_Z_r ~ standardized_groupsize[dat$CooperativeBreeding==0] , col="#dd4444" ,xaxt="n", ann=F,bty="n",ylim=c(-1,1.5))
at <- c(-0.84895,-0.415,1.753,4.4635,7.715)
labels <- at*sd(dat$GroupSize) + mean(dat$GroupSize)
axis( side=1 , at=at , labels=round(labels,1) )
lines( groupsize.seq , mu.mean ,col="#dd4444")
shade( mu.PI , groupsize.seq, col=col.alpha("#dd4444",0.1) )


groupsize.seq_short <-  c(-1,-0.84895,-0.415,1.753,4.4635)
short_pred_dat <- list( G = groupsize.seq_short)
mu_2 <- link( rethinking_groupsize_cooperativebreeding , data=data.frame(C = 2, G = short_pred_dat) )
mu_2.mean <- apply( mu_2 , 2 , mean )
mu_2.PI <- apply( mu_2 , 2 , PI , prob=0.89 )
points( dat[dat$CooperativeBreeding==1,]$Fishers_Z_r ~ standardized_groupsize[dat$CooperativeBreeding==1] , dat , col="#2d676f" )
lines( groupsize.seq_short , mu_2.mean,col="#2d676f" )
shade( mu_2.PI , groupsize.seq_short, col=col.alpha("#2d676f",0.1) )

legend(x="topright",legend=c("Cooperative breeder","Plural breeder"),lwd=4,col=c("#2d676f","#dd4444"),bty="n")

mtext("Group size",side=1,cex=1.8,line=3.0)
mtext("Effect size (Fisher's Z r)",side=2,cex=1.5,line=2.5,las=3)


dat_list$Dmat<-Dmat[ dat$Latin,dat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_groupsize_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + c[C]+g*G+cg[C]*G,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    c[C]~normal(0,0.5),
    g~normal(0,1),
    cg[C]~normal(0,1),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_groupsize_cooperativebreeding)



# Assessing whether female dispersal is independently associated with higher effect sizes in addition to cooperative breeding


meta_dispersal_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~Philopatry*CooperativeBreeding , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_dispersal_cooperativebreeding

metafor_phylogenetic_dispersal_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~Philopatry*CooperativeBreeding,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_dispersal_cooperativebreeding



philopatry<-dat[is.na(dat$Philopatry)==F,]

dat_list <- list(
  N_spp = nrow(philopatry),
  Z_obs = philopatry$Fishers_Z_r,
  Z_sd = philopatry$Variance, 
  P = as.integer(as.factor(philopatry$Philopatry)),
  C = philopatry$CooperativeBreeding+1
)


rethinking_philopatry_cooperativebreeding <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + p[C]*P + c[C],
        a~normal(0,1),
        p[C]~normal(0,0.5),
        c[C]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_cooperativebreeding,depth=2)[416:421,]



dat_list$Dmat<-Dmat[ philopatry$Latin,philopatry$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_philoptray_cooperativebreeding <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + p[C]*P+c[C],
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    p[C]~normal(0,0.5),
    c[C]~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4)
precis(rethinking_phylogenetic_gaussian_philoptray_cooperativebreeding,depth=2)[416:421,]




# Assessing whether there is an interaction between average relatedness and cooperative breeding


meta_relatedness_cooperativebreeding <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~AverageRelatedness*CooperativeBreeding , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_relatedness_cooperativebreeding

metafor_phylogenetic_relatedness_cooperativebreeding <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~AverageRelatedness*CooperativeBreeding,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_relatedness_cooperativebreeding



relatednessdat<-dat[is.na(dat$AverageRelatedness)==F,]

dat_list <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness),
  C = relatednessdat$CooperativeBreeding+1
)


rethinking_philopatry_cooperativebreeding <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + r[C]*R + c[C],
        a~normal(0,1),
        r[C]~normal(0,0.5),
        c[C]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_cooperativebreeding,depth=2)[289:294,]



#model assessing the influence of difference on group sizes on the measured effect sizes, with study reference as random term


meta_coalition <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~ CoalitionFormation, data=dat[dat$CooperativeBreeding==0,], method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_coalition

metafor_phylogenetic_coalition <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CoalitionFormation,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat[dat$CooperativeBreeding==0,])
metafor_phylogenetic_coalition



#A non-phylogenetic model to determine the influence of group size on the variation in effect sizes
#We create the structured data file for the model 

coalitiondat<-dat[is.na(dat$CoalitionFormation)==F,]
coalitiondat<-coalitiondat[coalitiondat$CooperativeBreeding==0,]


dat_list_coalition <- list(
  N_spp = nrow(coalitiondat),
  Z_obs = coalitiondat$Fishers_Z_r,
  Z_sd = coalitiondat$Variance, 
  C = as.integer(as.factor(coalitiondat$CoalitionFormation))
)

#We run the model
rethinking_coalition <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
    mu <- a+b[C],
    a~normal(0,1),
    b[C]~normal(0,0.5),
    sigma_sq~dexp(1)
  ),data=dat_list_coalition)
precis(rethinking_coalition,depth=2)[374:378,]
posterior<-extract.samples(rethinking_coalition)
difference_coalition<-posterior$b[,2]-posterior$b[,1]
precis(difference_coalition)


```

  &nbsp;

**R5.3 Philopatry and group size**

Group sizes of species in which females disperse tend to be smaller than group sizes of species in which females are philopatric. Both philopatry and increasing group size appear however to independently lead to lower effect sizes (metafor estimate philopatry -0.09 - -0.01 group size -0.07 - -0.01, rethinking estimate philopatry -0.16 - 0.00 group size -0.07 - -0.03, n=415 effect sizes).

  &nbsp;

**R5.4 Philopatry and average relatedness**

Among plural/associated breeders, average relatedness is lower in species in which females disperse (mean r 0.03, n=16) than in species in which females are philopatric (mean r 0.10, n=228), and among these species, differences in effect sizes are mainly associated with whether females disperse or are philopatric (metafor estimate -0.11 - -0.03, rethinking estimate -0.22 - -0.02) rather than levels of average relatedness (metafor estimate +0.03 - +0.10, rethinking estimate -0.04 - +0.01, n=242 effect sizes).


  &nbsp;

**R5.5 Population density and group size**

Population density and group size have independent influences on effect sizes (population density estimate metafor 0.00 - +0.01, rethinking 0.00 - +0.01; group size estimate metafor -0.03 - 0.01, n=346 effect sizes).



```{r ranksuccess_socialinteractions, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}


# Dispersal & group size
meta_groupsize_dispersal <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~standardize(GroupSize)+standardize(as.integer(as.factor(Philopatry))) , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_groupsize_dispersal

metafor_phylogenetic_groupsize_philopatry <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~GroupSize+Philopatry,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_groupsize_philopatry


groupsizedat<-dat[is.na(dat$GroupSize)==F,]
groupsizedat<-groupsizedat[is.na(groupsizedat$Philopatry)==F,]


dat_list <- list(
  N_spp = nrow(groupsizedat),
  Z_obs = groupsizedat$Fishers_Z_r,
  Z_sd = groupsizedat$Variance, 
  G = standardize(groupsizedat$GroupSize),
  P = as.integer(as.factor(groupsizedat$Philopatry))
)


rethinking_groupsize_relatedness <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + r*G + p[P],
        a~normal(0,1),
        r~normal(0,0.5),
        p[P]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_groupsize_relatedness,depth=2)[364:369,]
posterior<-extract.samples(rethinking_groupsize_relatedness)
difference_groupsize_relatedness<-posterior$p[,2]-posterior$p[,1]
precis(difference_groupsize_relatedness)






# Dispersal & relatedness
meta_relatedness_dispersal <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~standardize(AverageRelatedness)+standardize(as.integer(as.factor(Philopatry))) , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_relatedness_dispersal

metafor_phylogenetic_relatedness_philopatry <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~AverageRelatedness+Philopatry,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_relatedness_philopatry






relatednessdat<-dat[is.na(dat$AverageRelatedness)==F,]
relatednessdat<-relatednessdat[is.na(relatednessdat$Philopatry)==F,]


dat_list <- list(
  N_spp = nrow(relatednessdat),
  Z_obs = relatednessdat$Fishers_Z_r,
  Z_sd = relatednessdat$Variance, 
  R = standardize(relatednessdat$AverageRelatedness),
  P = as.integer(as.factor(relatednessdat$Philopatry))
)


rethinking_philopatry_relatedness <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + r*R + p[P],
        a~normal(0,1),
        r~normal(0,0.5),
        p[P]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_relatedness,depth=2)[281:285,]
posterior<-extract.samples(rethinking_philopatry_relatedness)
difference_philopatry_relatedness<-posterior$p[,2]-posterior$p[,1]
precis(difference_philopatry_relatedness)



# Population density & group size
meta_popdense_groupsize <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~standardize(GroupSize)+standardize(PopulationDensity) , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_popdense_groupsize

meta_phylogenetic_popdense_groupsize <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~standardize(GroupSize)+standardize(PopulationDensity),
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
meta_phylogenetic_popdense_groupsize






groupsizedat<-dat[is.na(dat$PopulationDensity)==F,]
groupsizedat<-groupsizedat[is.na(groupsizedat$GroupSize)==F,]

dat_list <- list(
  N_spp = nrow(groupsizedat),
  Z_obs = groupsizedat$Fishers_Z_r,
  Z_sd = groupsizedat$Variance, 
  G = standardize(groupsizedat$GroupSize),
  P = as.integer(as.factor(groupsizedat$PopulationDensity))
)


rethinking_philopatry_relatedness <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + r*G + p*P,
        a~normal(0,1),
        r~normal(0,0.5),
        p~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_relatedness,depth=2)[347:350,]




dat_list$Dmat<-Dmat[ groupsizedat$Latin,groupsizedat$Latin ]/max(Dmat)

rethinking_phylogenetic_gaussian_groupsize_popdens <- ulam(
  alist(
    Z_obs ~dnorm ( Z_true , Z_sd),
    vector[N_spp]:Z_true ~ multi_normal( mu , SIGMA ),
    mu <- a + r*G + p*P,
    matrix[N_spp,N_spp]: SIGMA <- cov_GPL2( Dmat, etasq, rhosq, 0.01),
    a~normal(0,1),
    r~normal(0,0.5),
    p~normal(0,0.5),
    etasq~exponential(1),
    rhosq~exponential(1)
  ),data=dat_list,chains=4, cores=4)
precis(rethinking_phylogenetic_gaussian_groupsize_popdens)



```




  &nbsp;

**R5.6 Different influences in captive and wild populations**

Models in which both the intercept and the slopes can vary according to whether studies were performed in the wild or in captivity also showed that there are no systematic differences of the effects of dominance rank on reproductive success between populations in these settings (for the different life history measurements and for cooperative breeding). 

```{r ranksuccess_captivity_interactions, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}


meta_captivity_measurement <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~MeasureType_Category*Populationtype , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_captivity_measurement

metafor_phylogenetic_captivity_measurement <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~MeasureType_Category*Populationtype,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_captivity_measurement




meta_captivity_cooperation <- rma.mv(yi=Fishers_Z_r, V=Variance, mods=~Populationtype*CooperativeBreeding , data=dat, method="REML", random=list(~1|StudyRef,~1|SpeciesRef))
meta_captivity_cooperation

metafor_phylogenetic_captivity_measurement <- rma.mv(Fishers_Z_r, Variance,
                                      mod =~CooperativeBreeding*Populationtype,
                                      random=list(~ 1 | SpeciesIncluded, # linking the species to the phylogeny
                                                  ~ 1 | Latin, # observations from the same species might be similar to each other, even if those from closely related species are not
                                                  ~ 1 | StudyRef),  # accounting for observations from the same publication
                                      R = list(SpeciesIncluded = phylo_cor), # reflecting the phylogenetic relatedness
                                      method="REML",
                                      test="t",  
                                      data=dat)
metafor_phylogenetic_captivity_measurement



dat_list <- list(
  N_spp = nrow(dat),
  Z_obs = dat$Fishers_Z_r,
  Z_sd = dat$Variance, 
  M = as.integer(as.factor(dat$CooperativeBreeding)),
  P = as.integer(as.factor(dat$Populationtype))
)


dat_list$P[dat_list$P==3]<-2

rethinking_philopatry_cooperativebreeding <- ulam(
    alist(
        Z_obs ~dnorm ( Z_true , Z_sd),
        vector[N_spp]:Z_true ~ dnorm( mu , sigma_sq ),
        mu <- a + p[M]*P + c[M],
        a~normal(0,1),
        p[M]~normal(0,0.5),
        c[M]~normal(0,0.5),
        sigma_sq~dexp(1)
    ),data=dat_list)
precis(rethinking_philopatry_cooperativebreeding,depth=2)[445:458,]

```
  &nbsp;

  &nbsp;


#### **Summary of combined analyses**
\
The analyses of combinations of predictors of the effect size of dominance on rank on reproductive success show that most predictors have a direct influence. However, we find that the approach authors used to measure the effect does not lead to different estimates of the effect size, it is rather that different approaches have been used in different study systems. We also find that average relatedness might not directly mitigate effect sizes, but that it is a co-variate of the breeding system and whether females are philopatric or disperse. In addition, we find some interactions, with group size having divergent influences depending on the breeding system; and coalitions among females reducing effect sizes among plural breeders.

  
  &nbsp; 
    


## Discussion

Our study finds that, in social mammals, dominant females have higher reproductive success than lower-ranking females. Positive effects of dominance rank are present for all our measures of reproductive success and among plural breeders, where data for all measures of reproductive success exist, are highest for life-time reproductive success. This suggests that even if dominants might face some trade-offs (e.g. higher stress levels @cavigelli2003female), obtaining a high ranking position in a social group generally leads to fitness benefits, though how females obtain these benefits (e.g. shorter interbirth intervals versus larger offspring) differs between populations. Our meta-analysis also highlights several factors associated with variation in the strength of the effect of dominance rank on reproductive success, where social factors in particular appear to have a modulating influence while variation in life history and ecological factors appears of less importance. Despite a consistent positive relationship between higher dominance rank and higher reproductive success, the data we were able to bring together for this study show some biases that suggest that further studies might detect lower effects. Our investigation of sample bias indicates a combination of publication bias, study system bias, and study time bias. Unlike often claimed for meta-analyses, the over-representation of positive findings in our case appears not to be primarily due to a file-drawer problem of unpublished negative findings but due to researchers targeting their efforts on feasible systems. Studies into the potential mechanisms of female competition and reproductive suppression have focused on species where there are clear differences in reproductive success between dominants and subordinates. In addition, obtaining reliable reproductive success data in long-lived mammals takes particular effort, again likely limiting the systems that have been studied to investigate the effects of dominance rank. We did find that studies conducted for longer time periods show less variance in their estimates, potentially because they also have larger sample sizes. Alternatively, or in addition, studies conducted across longer time frames might be less likely to show extreme effect size estimates because natural changes in dominance rank and events that affect all females equally (e.g. infanticide @cheney2004factors) occur relatively regularly across a multi-year study, while estimates derived over short time frames may over-estimate effect sizes.

Overall, we estimated an average effect of 0.28 of rank on reproductive success. What does this mean? First, it is important to highlight that this effect size reflects how well rank predicts reproductive success, but not directly indicates how different the reproductive success of high-ranking females is from that of low-ranking females. While the effect of dominance has to be zero in groups where all females have exactly the same reproductive success, an effect of zero is also found in a group where there are large differences in reproductive success across females which do not align with the females' dominance rank. Just by chance, we would expect differences in reproductive success among females in a social group and we could also expect that these differences are associated with traits that might be used to classify social rank. To assess whether the effects we detect are higher than such random variation, we performed simulations. For this, we simulated artificial groups of females reflecting macaques, the genus most common in our sample. We assumed that each female in each group might have between 0 to 8 offspring, with an average 2 (following a Poisson distribution, so most females have 1 or 2 offspring). We performed 10,000 simulations of six groups of twelve females each (the median group size in our data). When we set no association between rank and reproductive success, less than 0.1% of simulations showed an effect size as high or higher than the 0.28 we observe in the data (Figure 10). Effect sizes for a perfect association between each female's rank and her reproductive success ranged between 0.75-0.95 (mean 0.88). Simulations in which the two highest ranking females always have the highest reproductive success while rank among lower ranking females no longer is associated with success produces effect sizes close to what we observe (mean 0.32), whereas values tend to be slightly lower if only the highest ranking female consistently has the highest success (mean 0.18). These simulations cannot resolve whether high ranking females have higher reproductive success because they obtained this position or whether there are some traits that lead to both higher rank and higher reproductive success - or whether they are simply the lucky ones (@snyder2018pluck). However, the value of the overall effect size we observe compared to those under random expectations indicates that social rank has a particular association with reproductive success beyond the random variation we expect in social groups.

---

![](ranksuccess_Fig10_simulatedeffectsizes.png)
**Figure 10.** The average effect size of dominance rank on female reproductive success we observe in our sample (0.28; dotted vertical line) is in between the effect sizes expected for social groups in which there is either no (grey histogram) or a perfect association (black histogram) between each rank and the reproductive success of females. The observed value is close to a situation in which the two highest ranking females (red histogram) or only the highest ranking female (yellow histogram) always have the highest success in a group of twelve females.

```{r ranksuccess_expectationsimulations, eval=FALSE, warning=FALSE, results='asis', echo=FALSE}

# Perfect association
perfectassociation<-c()
for (i in 1:10000) {
success<-c(sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)),sort(rpois(12,2)))
dominants<-rep(c(1,2,3,4,5,6,7,8,9,10,11,12),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
perfectassociation<-c(perfectassociation,effectsize)
}
p1<-hist(perfectassociation)
# average 0.88

# Highest ranking one best, thereafter no association
highestone<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)))
dominants<-rep(c(1,sample(c(2,3,4,5,6,7,8,9,10,11,12),11)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
highestone<-c(highestone,effectsize)
}
p2<-hist(highestone)
# average 0.18

# Highest two ranking best, thereafter no association
highesttwo<-c()
for (i in 1:10000) {
success<-c(sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)),sort(rgampois(12,2,0.2)))
dominants<-rep(c(1,2,sample(c(3,4,5,6,7,8,9,10,11,12),10)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
highesttwo<-c(highesttwo,effectsize)
}
p4<-hist(highesttwo)
#Average 0.33


# No association
noassociation<-c()
for (i in 1:10000) {
success<-c((rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)),(rgampois(12,2,0.2)))
dominants<-rep(c(1,sample(c(2,3,4,5,6,7,8,9,10,11,12),11)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,-1*sqrt(summary(lm(success~dominants))$r.squared), sqrt(summary(lm(success~dominants))$r.squared))
noassociation<-c(noassociation,effectsize)
}
p3<-hist(noassociation)
# 84/10000 higher than 0.28


# Highest two ranking best, thereafter no association; normal distribution
highesttwonormal<-c()
for (i in 1:10000) {
success<-c(sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)),sort(round(rnorm(12,mean=2,sd=0.5),0)))
dominants<-rep(c(1,2,sample(c(3,4,5,6,7,8,9,10,11,12),10)),6)
effectsize<-ifelse(summary(lm(success~dominants))$coefficients[2,1]<0,(-1*sqrt(summary(lm(success~dominants))$r.squared)), sqrt(summary(lm(success~dominants))$r.squared))
highesttwonormal<-c(highesttwonormal,effectsize)
}
hist(highesttwonormal)



# plot the histograms in a single plot
# P1 - perfect association
plot( p1, col=rgb(0,0,0,1), xlim=c(-0.5,1),ann=F)  # first histogram
# P2   highest rank highest afterwards no link
plot( p2, col=rgb(1,1,0,1/2), xlim=c(-0.5,1), add=T)
# P3   no association
plot( p3, col=rgb(0,0,0,1/4), xlim=c(-0.5,1), add=T)
# P4  highest two ranking
plot( p4, col=rgb(1,0,0,1/2), xlim=c(-0.5,1), add=T)

abline(v=0.28,lwd=4,lty=2)

legend(x="topleft",legend=c("No association","Highest one best","Highest two best","Perfect association"),lwd=4,col=c(rgb(0,0,0,1/8),rgb(1,1,0,1/2),rgb(1,0,0,1/2),rgb(0,0,0,1)),bty="n")

legend(x=0.17,y=2800,legend=c("Observed effect size"),lwd=4,col=c("white"),bty="n")

mtext("Effect size of dominance rank on reproductive success",side=1,cex=1.8,line=3.0)
mtext("Number of independent simulation runs",side=2,cex=1.5,line=2.5,las=3)

```

---



Among the social traits we investigated, the highest difference in the effect of rank on reproductive success was between cooperative breeders and plural/associated breeders. This results was expected given the higher reproductive skew that has been found among females in cooperative breeders (@lukas2012cooperative). The contrast between breeding systems appears due to the degree of reproductive control that dominants in cooperative breeders have over their, mostly related, group members. The likely importance of reproductive control of dominant females in cooperative breeders compared to plural/associated breeders are also reflected in the different relationships of the effect sizes with group size in the different breeding systems. While among cooperative breeders there usually is only a single breeding dominant female and large groups occur when her reproductive output is higher, dominant females in plural/associated breeders likely face reduced opportunities to control reproduction in larger groups (@rubenstein2016discrete). In this context, it is again important to note that we only look at the association between rank and the variation in reproductive success within groups. Even though the relative difference between dominant and subordinate females might be lower in larger group sizes, in terms of overall fitness it might still be better to be the dominant in a group of the optimal size rather than a smaller group (e.g. small group where dominant has 3 versus subordinate has 2 offspring (50% higher fitness) compared to large group where dominant has 4 while all other females have 3 offspring (33% higher fitness)). While reproductive control appears important in explaining high reproductive success of dominant females, we did not find that associations between the effect sizes and how females acquire and maintain rank. Effect sizes were similar when dominant females acquire their position by kin support versus aggression or age, and among macaque species were not associated with dominance styles. 

Among plural and associated breeders, effects of dominance rank on female reproductive success are higher when (i) females disperse, (ii) groups are smaller, and (iii) females form coalitions. These observations are somewhat opposite to the processes presumably linked to reproductive suppression in cooperative breeders. In addition, these findings also do not support accounts that focus on nepotism as a primary factor in leading to social groups with large differences among females. It appears that in situations of strong nepotism females in a group might have more similar reproductive success, with patterns such as youngest sister ascendancy potentially reducing differences among kin (@datta1988acquisition, @bergstrom2010dominance, @lea2014complex). Instead, these findings suggest that competition among females might be highest in social groups in which females form complex relationships and rates of aggression are high (@lukas2018social). In our sample we for example observe relative strong effects of high dominance rank on reproductive success among equids and among gorillas, who have similar social systems with females benefiting from forming social bonds with unfamiliar/unrelated individuals they encounter when joining new small groups upon reaching maturity (e.g. @cameron2009social).

Of the ecological variables we investigated, only population density was associated with differences in effect sizes of dominance rank on reproductive success, again supporting the role of social interactions in shaping fitness outcomes of dominance interactions. The observation that other ecological factors do not mitigate the strength of the fitness benefit dominant females receive might suggests that dominants are consistently able to outcompete other females in the group rather than dominance only being important under challenging conditions. While local ecological conditions, rather than the species-level traits we used, might modulate fitness benefits of high dominance rank for females, it seems unlikely that there would be a strong directional influence given that effect sizes from the same species tend to be similar, even in captive conditions. In line with this, previous work has shown that subordinate females may not always be the first to suffer under limiting conditions (@fedigan1983dominance). Instead, a number of ecological challenges, such as for example predation (@cheney2004factors), can affect all females independent of their rank and thereby diminishing the relative benefits dominant females acquire (@altmann2003variability). 

The overall effect size of dominance rank on female reproductive success across the species in our sample is slightly higher than that reported in a previous study, though we find a similar value when we restrict our sample to primate species, the focus of the previous study (the average in our sample is 0.28, for only the primates in our sample 0.23, versus previously reported for primates 0.20 @majolo2012fitness). These estimates of the effects of female dominance rank are lower than those previously reported for males. The previous study on primates reports an effect of male dominance rank on fecundity of 0.71 (@majolo2012fitness), and estimates in a different study of the effect of dominance rank on males' mating success are ~0.6 (@cowlishaw1991dominance). Do these different estimates reflect that males benefit more from high dominance rank than females? We think that we cannot make such an inference at this stage. Measures of mating success might not necessarily translate in equally high skew in reproductive success and studies measuring male reproductive success tend to cover even shorter time periods than the studies that identify female reproductive success. Several of the factors we identified here to modulate the effect of dominance rank on reproductive success may also be linked to differences between females and males. However, it could be expected that males benefit more from rank than females, because female mammals are usually limited in the maximum reproductive success they can have at any given time. The benefits of rank are very different in nature between males and females and only additional symmetrical meta-analyses in males can answer such a question. 

Our findings highlight that social factors can have important influences on demography and genetic evolution by leading to systematic differences in reproductive success. The effect of high dominance rank on reproductive success influence the growth and composition of social groups across generations. In particular when social rank is heritable, strong long-term changes are visible in the few studies which have been able to track reproductive success across multiple generations. For example, among spotted hyenas, the highest ranking female in 1979 is the ancestor of more than half of the females in the clan in 2009 (@holekamp2012society). This perspective also highlights that even small differences in reproductive success can add up over long time frames. In particular, even if dominant females do not have much higher reproduction under average conditions, if they were the only ones to survive or reproduce under extreme conditions this could have important fitness consequences (@lewontin1969population). For future studies, detailed long-term investigations are not only relevant to understand the long-term consequences of the effect of dominance rank on reproduction, but also to infer the multiple mechanisms that link rank to reproductive output (e.g. @fedigan1983dominance, @pusey1997influence). 






  
### Ethics
Our study relies on previously published data and did not involve working directly with animals.


### Author contributions

**Shivani:** Hypothesis development, data collection, data analysis and interpretation, revising/editing.

**Huchard:** Hypothesis development, data analysis and interpretation, write up, revising/editing.

**Lukas:** Hypothesis development, data collection, data analysis and interpretation, write up, revising/editing, materials/funding.


### Data and code availability
The dataset has been published at KNB [doi:10.5063/F1RB7312.](https://knb.ecoinformatics.org/view/doi:10.5063/F1RB7312) 
The code of the current version is archived at Edmond [doi:10.17617/3.80](https://dx.doi.org/10.17617/3.80)


### Funding

Shivani received funding from the INSPIRE programme of the Department of Science & Technology of the Government of India. This research was supported by the Department of Human Behavior, Ecology and Culture at the Max Planck Institute for Evolutionary Anthropology.

### Conflict of interest disclosure

We, the authors, declare that we have no financial conflicts of interest with the content of this article. Elise Huchard and Dieter Lukas are Recommenders at PCI Ecology.
  
  &nbsp; 

### Acknowledgements

We thank our PCI Ecology Recommender, Matthieu Paquet, and our reviewers, Bonaventura Majolo and one anonymous reviewer, for their valuable feedback on our preregistration that greatly improved this piece of research. We are grateful to the members of the Department of Human Behavior, Ecology and Culture at the Max Planck Institute for Evolutionary Anthropology for feedback during the early stages of this project.
    
  &nbsp; 
    
### [References](MyLibrary.bib)
